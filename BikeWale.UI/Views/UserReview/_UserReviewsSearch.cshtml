@model Bikewale.Models.UserReviews.UserReviewsSearchVM
@using Bikewale.Entities.UserReviews;
@using Bikewale.Utility;
@if (Model.UserReviews != null && Model.ReviewsInfo != null && Model.ReviewsInfo.TotalReviews > 0)
{
    <section>
        <div id="modelReviewsListing" class="container card-bottom-margin">
            <div class="grid-12">
                <div class="content-box-shadow padding-top20">
                    <h2 class="h2-heading padding-left20">@Model.WidgetHeading</h2>
                    <div id="overallTabsWrapper" class="overall-tabs user-review-tabs position-rel">
                        <div id="overallSpecsTab" class="overall-specs-tabs-container">
                            <div class="overall-specs-tabs-wrapper">
                                <a href="javascript:void(0)" class="active" data-category="2" data-page-num="1" data-count="@Model.ReviewsInfo.MostHelpfulReviews" data-bind="click: function(d, e) { toggleReviewList(e); }" rel="nofollow">Most Helpful (@Model.ReviewsInfo.MostHelpfulReviews)</a>
                                <a href="javascript:void(0)" data-category="1" data-page-num="1" data-count="@Model.ReviewsInfo.MostRecentReviews" data-bind="click: function(d, e) { toggleReviewList(e); }" rel="nofollow">Most Recent (@Model.ReviewsInfo.MostRecentReviews)</a>
                                <a href="javascript:void(0)" data-cattypes="4,5" data-category="5" data-page-num="1" data-count="@Model.ReviewsInfo.PostiveReviews" data-bind="click: function(d, e) { toggleReviewList(e); }" rel="nofollow">Positive (@Model.ReviewsInfo.PostiveReviews)</a>
                                <a href="javascript:void(0)" data-cattypes="1,2" data-category="6" data-page-num="1" data-count="@Model.ReviewsInfo.NegativeReviews" data-bind="click: function(d, e) { toggleReviewList(e); }" rel="nofollow">Negative (@Model.ReviewsInfo.NegativeReviews)</a>
                                <a href="javascript:void(0)" data-cattypes="3" data-category="7" data-page-num="1" data-count="@Model.ReviewsInfo.NeutralReviews" data-bind="click: function(d, e) { toggleReviewList(e); }" rel="nofollow">Neutral (@Model.ReviewsInfo.NeutralReviews)</a>
                            </div>
                        </div>
                    </div>
                    <p style="display: none" class="padding-top15 padding-bottom15 margin-right20 margin-left20 border-grey-bottom" data-bind="visible: (activeReviewCategory() == 5 || activeReviewCategory() == 6 || activeReviewCategory() == 7) && reviewsAvailable()">
                            <span class="bwsprite info-sm margin-right5"></span>
                            <span class="font13 text-light-grey inline-block">Reviews are sorted on the basis of helpfulness</span>
                        </p>
                    <!-- ko if : activeReviewList() && activeReviewList().length > 0 -->
                    <div style="display: @(Model.Pager != null && Model.Pager.TotalResults > 0 ? "block" : "none")" data-bind="visible: reviewsAvailable()">
                        <ul class="user-review-list" data-bind="visible : (!noReviews() && TotalReviews() !== 0), css: IsLoading() ? 'loader-active' : ''">
                            @{ushort i = 0;}
                            @foreach (UserReviewSummary review in Model.UserReviews.ResultDesktop)
                            {
                                <!-- ko if : activeReviewList()[@i] -->
                                <li class="list-item">
                                    <div class="grid-9 alpha padding-right20 border-light-right">
                                        <div class="margin-bottom10">
                                            <span class="rating-badge" data-rate-bg="@review.OverallRating.Value" data-bind="css: 'rating-badge', attr: {'data-rate-bg' : activeReviewList()[@i].overallRating.value }, text: activeReviewList()[@i].overallRating.value ">
                                            <span class="bwsprite star-white"></span>@review.OverallRating.Value</span>
                                            <a href="@string.Format("/{0}-bikes/{1}/reviews/{2}/", Model.ReviewsInfo.Make.MaskingName, Model.ReviewsInfo.Model.MaskingName, review.ReviewId)" data-bind= "attr : {'title' : activeReviewList()[@i].title,'href' : '/' + '@Model.ReviewsInfo.Make.MaskingName' + '-bikes/' + '@Model.ReviewsInfo.Model.MaskingName' + '/reviews/' + activeReviewList()[@i].reviewId + '/'}, text: activeReviewList()[@i].title" class="list-item-title inline-block margin-right5"> @review.Title</a>
                                            <span class="font12 inline-block text-light-grey" data-bind="text: activeReviewList()[@i].reviewAge + ' ago by ' + activeReviewList()[@i].customerName">@review.ReviewAge ago by @review.CustomerName</span>
                                        </div>
                                        <div class="collapsible-content toggle-off main-content-off margin-bottom10 font14 text-slate-grey">
                                            <div class="main-content" data-bind="html: activeReviewList()[@i].shortDescription">                                               
                                                @Html.Raw((review.Description.TruncateHtml(200)))
                                            </div>
                                            <div class="more-content">
                                                <span data-bind="html: activeReviewList()[@i].description">
                                                    @Html.Raw(review.Description)
                                                </span>
                                                                                               
                                                <ul class="rating-circle-list" data-bind="visible:activeReviewList().length <  0">
                                                    
                                                    @foreach (UserReviewQuestion ques in review.Questions)
                                                    {
                                                        if (ques.Type == UserReviewQuestionType.Review)
                                                        {                                                             
                                                            <li>
                                                                <div class="rating-circle circle-rate-@ques.SelectedRatingId">
                                                                    <p class="circle-label">@ques.SelectedRatingId</p>
                                                                    <span class="rating-progress">
                                                                    </span>
                                                                </div>
                                                                <p class="list-item-label" >@ques.Heading</p>
                                                            </li>                                                            
                                                        }
                                                    }
                                                </ul>

                                                @*<!-- ko if : activeReviewList() && activeReviewList().length > 0 && activeReviewList()[@i] && activeReviewList()[@i].questions && activeReviewList()[@i].questions.length > 0 -->                                                
                                                @{ushort j = 0;}
                                                <ul class="rating-circle-list">
                                                    <!-- ko foreach: activeReviewList()[@i].questions -->
                                                    <!-- ko if : activeReviewList()[@i].questions[@j] && activeReviewList()[@i].questions[@j].qtype == 2 -->
                                                    <li>
                                                        <div data-bind="css: 'rating-circle circle-rate-' +  activeReviewList()[@i].questions[@j].selectedRatingId">
                                                            <p class="circle-label" data-bind="text: activeReviewList()[@i].questions[@j].selectedRatingId"></p>
                                                            <span class="rating-progress">
                                                            </span>
                                                        </div>
                                                        <p class="list-item-label" data-bind="text: activeReviewList()[@i].questions[@j].heading"></p>
                                                    </li>
                                                    <!-- /ko -->
                                                    <!-- /ko -->
                                                    @{j++;}
                                                </ul>
                                                <!-- /ko -->*@
                                                                                                

                                            </div>
                                            <a href="javascript:void(0)" class="read-more-target" data-bind="css: 'read-more-target', visible : activeReviewList()[@i].description" rel="nofollow">...Read more</a>
                                        </div>
                                        
                                        <button id="upvoteBtn-@review.ReviewId" data-reviewId="@review.ReviewId" type="button" onclick="upVoteListReview(event)" data-bind="attr: {id: 'upvoteBtn-' + activeReviewList()[@i].reviewId, 'data-reviewId': activeReviewList()[@i].reviewId }, click: function(d, e){ upVoteListReview(e)}" class="btn btn-inv-teal-group margin-right10 upvoteListButton ">
                                            <span class="btn-label-grid">
                                                <span class="bwsprite like-sm"></span>
                                            </span><span id="upvoteCount-@review.ReviewId" class="btn-count" data-bind="attr: { id: 'upvoteCount-' + activeReviewList()[@i].reviewId}, text : activeReviewList()[@i].upVotes">@review.UpVotes</span>                                           
                                        </button>

                                        <button id="downvoteBtn-@review.ReviewId" data-reviewId="@review.ReviewId" type="button" onclick="downVoteListReview(event)" data-bind="attr: { id: 'downvoteBtn-' + activeReviewList()[@i].reviewId, 'data-reviewId': activeReviewList()[@i].reviewId }, click: function(d, e){ downVoteListReview(e)}" class="btn btn-inv-teal-group downvoteListButton">
                                            <span class="btn-label-grid">
                                                <span class="bwsprite dislike-sm"></span>
                                            </span><span id="downvoteCount-@review.ReviewId" class="btn-count" data-bind="attr: { id: 'downvoteCount-' + activeReviewList()[@i].reviewId}, text : activeReviewList()[@i].downVotes">@review.DownVotes</span>                                           
                                        </button>

                                        <p class="report-abuse-label rightfloat line-height26" data-bind="attr: { id: 'pReport-' + activeReviewList()[@i].reviewId}" id="pReport-@review.ReviewId">Inappropriate review? <a href="javascript:void(0)" data-bind="attr: {'data-reviewId': activeReviewList()[@i].reviewId }, click: function(d, e){ reportReview(e)}" data-reviewId="@review.ReviewId"  onclick="reportReview(event)" rel="nofollow">Report Abuse</a></p>
                                        <div class="clear"></div>
                                       
                                    </div>
                                    @{ushort k = 0;}
                                    <div class="grid-3 omega padding-left20" data-bind="foreach: activeReviewList()[@i].questions">
                                        <ul>                                           
                                            @*@foreach (UserReviewQuestion ques in review.Questions)
                                            {
                                                <!-- ko if : activeReviewList()[@i].questions[@k] && activeReviewList()[@i].questions[@k].qtype == 1 -->
                                                if (ques.Type == UserReviewQuestionType.Rating)
                                                {
                                                    <li class="margin-bottom10">
                                                        <span class="bwsprite questionId-@ques.Id" data-bind="css: 'bwsprite questionId-' +  activeReviewList()[@i].questions[@k].qId"></span>
                                                        <div class="inline-block">
                                                            <p class="font10 text-xt-light" data-bind="text: activeReviewList()[@i].questions[@k].minHeading">@ques.MinHeading</p>
                                                            <p class="font14 text-slate-grey" data-bind="text: activeReviewList()[@i].questions[@k].selectedRatingText">@ques.SelectedRatingText</p>
                                                        </div>
                                                    </li>
                                                }
                                                <!-- /ko -->
                                                k++;
                                            }*@
                                           
                                            @*@foreach (UserReviewQuestion ques in review.Questions)
                                            {                                               
                                                if (ques.Type == UserReviewQuestionType.Rating)
                                                {
                                                    <li class="margin-bottom10">
                                                        <span class="bwsprite questionId-@ques.Id"></span>
                                                        <div class="inline-block">
                                                            <p class="font10 text-xt-light">@ques.MinHeading</p>
                                                            <p class="font14 text-slate-grey">@ques.SelectedRatingText</p>
                                                        </div>
                                                    </li>
                                                }                                                                                            
                                            }*@                                            
                                        </ul>
                                    </div>
                                    <div class="clear"></div>
                                </li>
                                 <!-- /ko -->
                                i++;
                            }
                        </ul>

                        @if (((Model.Pager.PageNo - 1) * Model.Pager.PageSize + 1) < Model.Pager.TotalResults)
                        {
                        <div class="padding-right20 padding-bottom10 padding-left20">
                            <div class="footer-pagination font14 border-solid-top padding-top10">
                                <div class="grid-5 alpha omega text-light-grey" data-bind="visible: TotalReviews() > 0">
                                    <p><span class="text-bold" data-bind="CurrencyText: (Pagination().pageNumber() - 1) * Pagination().pageSize() + 1">@((Model.Pager.PageNo - 1) * Model.Pager.PageSize + 1)</span>-<span class="text-bold" data-bind="CurrencyText: Math.min(TotalReviews(), Pagination().pageNumber() * Pagination().pageSize())">@Math.Min((Model.Pager.PageNo) * Model.Pager.PageSize, Model.Pager.TotalResults)</span>&nbsp;of&nbsp;<span class="text-bold" data-bind="CurrencyText: TotalReviews()">@Model.Pager.TotalResults</span>&nbsp;reviews</p>
                                </div>
                                <div id="pagination-list-content" class="grid-7 alpha omega position-rel rightfloat pagination-list-content" data-bind="visible: TotalReviews() > 0">
                                    @if (Model.Pager.TotalResults > 10)
                                    {
                                        Html.RenderAction("Index", "Pager", new { objPager = Model.Pager });
                                    }
                                </div>
                                <div class="clear"></div>
                            </div>
                        </div>
                        }
                    </div>
                    <!-- /ko -->
                    <!-- ko ifnot :  activeReviewList() && activeReviewList().length > 0 -->
                    <div class="content-inner-block-20 text-center" style="display: @(Model.Pager!=null && Model.Pager.TotalResults > 0 ? "none" : "block")" data-bind="visible: !reviewsAvailable()">
                        <div class="circle-placeholder-80">
                            <span class="bwsprite review-lg margin-top25"></span>
                        </div>
                        <p class="font14 text-light-grey margin-top20">There are no <span data-bind="text: categoryName"></span> reviews for this bike</p>
                    </div>
                    <!-- /ko -->
                    <div id="listingFooter"></div>
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </section>

    <div id="report-abuse">
        <p class="font20 text-bold text-center margin-bottom20">Why do you want to report it abuse?</p>

        <div class="report-abuse-close-btn position-abt pos-top10 pos-right10 bwsprite cross-lg-lgt-grey cur-pointer"></div>

        <p class="margin-bottom10 font14">Comment</p>

        <textarea id="txtAbuseComments"></textarea>
        <span id="spnAbuseComments" class="error font12 text-red"></span>

        <div class="text-center margin-top10">
            <a id="btnReportReviewAbuse" onclick="reportAbuse()" class="btn btn-orange" rel="nofollow">Report</a>
        </div>
    </div>
    <div id="report-background"></div>
}

