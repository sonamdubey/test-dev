@model Bikewale.Models.WriteReviewPageVM
@{
    Model.IsHeaderFix = false;
    Model.Page_ATF_CSS = "<link rel='stylesheet' type='text/css' href='/css/user-review/write-review.css' />";
    Model.Page_JS_Path = "/src/user-review/write-review.js";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@if (Model != null && Model.Make != null && Model.Model != null && Model.Rating != null)
{
    <form action="/user-reviews/save/" method="post">
        <section>
            <div id="write-review-form" class="container section-bottom-margin font14 padding-top10">
                <div class="grid-12">
                    <div class="content-box-shadow">
                        <div class="content-box-shadow padding-15-20">
                            <p class="font22 text-black text-bold inline-block">You rated @Model.Make.MakeName @Model.Model.ModelName</p>
                            <div class="inline-block user-rating-box">
                                <span class="bwsprite star-one"></span>
                                <span class="inline-block">
                                    <span class="font18 text-bold">@Model.Rating.Value</span>&nbsp;<span class="font12 text-xx-light">/&nbsp;5</span>
                                </span>
                            </div>
                        </div>
                        <div class="padding-15-20">
                            <div class="grid-8 alpha">
                                <h2 class="font18 margin-bottom10">@Model.Rating.ResponseHeading</h2>
                                <p class="text-slate-grey margin-bottom10">Tell us more about it. You may consider writing about:</p>
                                <ol class="numeric-list margin-bottom20">
                                    <li>Buying experience</li>
                                    <li>Riding experience</li>
                                    <li>Details about looks, performance etc.</li>
                                    <li>Servicing and maintenance</li>
                                    <li>Pros and Cons</li>
                                </ol>

                                <div class="textarea-box margin-bottom15">
                                    <textarea data-bind="textInput: detailedReview" name="reviewDescription" id="reviewDesc" data-validate="@((Model.SubmitResponse != null && !string.IsNullOrEmpty(Model.SubmitResponse.ReviewErrorText)) ? Model.SubmitResponse.ReviewErrorText : "")" rows="4" cols="80" maxlength="7999" placeholder="The more detailed your review, the more useful it will be. Write your review."></textarea>

                                    <div data-bind="visible: !detailedReviewFlag() && detailedReview().length < 300" class="review-char-count position-abt font12">
                                        <span data-bind="visible: detailedReview().length > 0"><span data-bind="text: detailedReview().length"></span>/</span><span data-bind="text: reviewCharLimit"></span>&nbsp;min
                                    </div>

                                    <div data-bind="visible: detailedReviewFlag" class="textarea-error position-abt">
                                        <span class="error-text" data-bind="text: detailedReviewError"></span>
                                    </div>
                                </div>

                                <h3 class="font15 text-black margin-bottom10">Give a title to your review</h3>
                                <p class="text-slate-grey margin-bottom20">A catchy title will grab eyeballs, and more people will read your review.</p>

                                <div class="input-box form-control-box" data-bind="css: reviewTitle().length > 0 ? 'not-empty' : ''">
                                    <input type="text" name="reviewTitle" id="getReviewTitle" maxlength="149" data-validate="@((Model.SubmitResponse != null && !string.IsNullOrEmpty(Model.SubmitResponse.TitleErrorText)) ? Model.SubmitResponse.TitleErrorText : "")" data-bind="textInput: reviewTitle" />
                                    <label for="getReviewTitle">Your title</label>
                                    <span class="boundary"></span>
                                    <span class="error-text"></span>
                                </div>

                                <h2 class="font18 padding-bottom5">Can you share a little more about this bike?<span class="text-light-grey text-unbold font14">&nbsp;(Optional)</span></h2>

                                <ul id="bike-review-questions" class="review-question-list margin-bottom20" data-bind="foreach: reviewQuestions">
                                    <!-- ko if: displayType == 1 -->
                                    <li class="list-item question-type-star">
                                        <p class="item-title" data-bind="text: heading"></p>
                                        <p class="item-subtitle" data-bind="text: description"></p>

                                        <div class="answer-star-list inline-block hover-effect" data-bind="foreach: rating.slice(0).reverse()">
                                            <input type="radio" data-bind="attr: {ratingId : 'review-' + $parent.qId + '-' + (5 - $index()), questiontId : $parent.qId, id: 'review-' + $parentContext.$index() + '-' + (5 - $index()), name: 'review-q-' + $parentContext.$index(), value: (5 - $index())}" data-type="star" />
                                            <label class="bwsprite star-zero" data-bind="attr: {for: 'review-' + $parentContext.$index() + '-' + (5 - $index()), 'data-value': (5 - $index())}"></label>
                                        </div>
                                        <p class="feedback-text inline-block"></p>
                                    </li>
                                    <!-- /ko -->
                                    <!-- ko if: displayType == 2 -->
                                    <li class="list-item question-type-text">
                                        <p class="item-title" data-bind="text: heading"></p>
                                        <p class="item-subtitle" data-bind="text: description"></p>

                                        <div class="answer-radio-list" data-bind="foreach: rating">
                                            <input type="radio" data-bind="attr: {ratingId : 'review-' + $parent.qId + '-' + ($index() + 1), questiontId : $parent.qId, id: 'review-' + $parentContext.$index() + '-' + ($index() + 1), name: 'review-q-' + $parentContext.$index(), value: $index() + 1}" data-type="text" />
                                            <label data-bind="attr: {for: 'review-' + $parentContext.$index() + '-' + ($index() + 1), name: 'review-q-' + $parentContext.$index(), 'data-value': $index() + 1}, text: ratingText"></label>
                                        </div>
                                        <div class="clear"></div>
                                    </li>
                                    <!-- /ko -->
                                </ul>
                                <div class="clear"></div>

                                <input type="hidden" id="reviewQuestion" name="reviewQuestion" />
                                <input type="hidden" id="reviewId" name="reviewId" value="@Model.ReviewId" />
                                <input type="hidden" name="encodedId" value="@Utils.Utils.EncryptTripleDES(string.Format("customerid={0}&reviewid={1}", Model.CustomerId, Model.ReviewId))" />
                                <input type="hidden" name="userName" value="@Model.UserName" />
                                <input type="hidden" name="emailId" value="@Model.EmailId" />
                                <input type="hidden" name="makeName" value="@Model.Make.MakeName" />
                                <input type="hidden" name="modelName" value="@Model.Model.ModelName" />
                                <input type="hidden" name="encodedString" value="@Model.EncodedWriteUrl" />
                                <input type="hidden" name="queryEncoded" value="@Model.EncodedWriteUrl" />
                                <input type="hidden" name="isDesktop" value="true" />

                                <h3 class="font15 margin-bottom10">Tips for prospective buyers</h3>
                                <p class="text-light-grey margin-bottom20">Share key tips which you think were useful while owning/riding this bike.</p>

                                <div class="input-box form-control-box" data-bind="css: reviewTips().length > 0 ? 'not-empty' : ''">
                                    <input name="reviewTips" type="text" id="getReviewTip" maxlength="1000" data-bind="textInput: reviewTips" />
                                    <label for="getReviewTip">Your tip</label>
                                    <span class="boundary"></span>
                                </div>
                                @Html.AntiForgeryToken()
                                <input id="submitReviewBtn" type="submit" class="btn btn-orange btn-220-40" value="Submit review" data-bind="click: submitReview" />

                            </div>
                            <div class="grid-4 omega">

                            </div>
                            <div class="clear"></div>
                        </div>
                    </div>
                </div>
                <div class="clear"></div>
            </div>
            <span id="review-page-data" class="hide">@Model.JsonReviewSummary</span>
            <span id="review-question-list" class="hide">@Model.JsonQuestionList</span>
            <span id="previousPageUrl" class="hide">@Model.PreviousPageUrl</span>
        </section>
    </form>
}
<script type="text/javascript">
    var page = "writeReview";
    var vmWriteReview;
    window.addEventListener("beforeunload", function (event) {
        vmWriteReview.SaveToBwCache();
    });
</script>