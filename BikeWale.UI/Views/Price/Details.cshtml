@model Bikewale.Models.Price.DealerPriceQuotePageVM
@using Bikewale.Common;
@using Bikewale.BikeBooking;
@{


    Model.Page_ATF_CSS = "<link rel='stylesheet' type='text/css' href='/css/dealerpricequote.css' />";
    Model.Page_BTF_CSS_Path = "";
    Model.Page_JS_Path = "/src/dealerpricequote.js";
    Model.AdTags.AdPath = "/1017752/Bikewale_PQ_";
    Model.AdTags.AdId = "1395986297721";
    Model.AdTags.Ad_970x90 = Model.DealerId <= 0;
    Model.AdTags.Ad_300x250 = false;
    Model.AdTags.Ad_300x250BTF = false;
    Model.IsHeaderFix = true;
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<section>
    <div class="container padding-top10">
        <div class="grid-12">
            <div class="breadcrumb margin-bottom15">
                <!-- breadcrumb code starts here -->
                <ul>
                    <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                        <a href="/" itemprop="url">
                            <span itemprop="title">Home</span>
                        </a>
                    </li>
                    <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                        <span class="bwsprite fa-angle-right margin-right10"></span>
                        <a href="/new-bikes-in-india/" itemprop="url">
                            <span itemprop="title">New</span>
                        </a>
                    </li>
                    <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                        <span class="bwsprite fa-angle-right margin-right10"></span>
                        <a href="/pricequote/" itemprop="url">
                            <span itemprop="title">On-Road Price Quote</span>
                        </a>
                    </li>
                    <li><span class="bwsprite fa-angle-right margin-right10"></span>Dealer Price Quote</li>
                </ul>
                <div class="clear"></div>
            </div>
            <div class="clear"></div>
        </div>
        <div class="clear"></div>
    </div>
</section>

<section>
    <div class="container" id="modelDetailsContainer">
        <div class="grid-12 margin-bottom20">
            <div class="content-box-shadow">
                <div class="content-box-shadow padding-14-20">
                    <h1 class="inline-block margin-right15">Detailed price quote for @Model.BikeName in @Html.Raw(Model.Location)</h1>
                </div>
                <div class="padding-top15 padding-right20 padding-bottom20 padding-left20">
                    <h2 class="font18 margin-bottom15">@Model.BikeName</h2>
                    <div id="pq-image-column" class="grid-5 alpha">
                        @if (Model.DetailedDealer != null)
                        {
                            <div id="model-image">
                                <img alt="@Model.BikeName Images" src="@Bikewale.Utility.Image.GetPathToShowImages(Model.DetailedDealer.OriginalImagePath, Model.DetailedDealer.HostUrl, Bikewale.Utility.ImageSize._360x202)" title="@Model.BikeName Images" alt="@Model.BikeName Images" width="100%" />
                            </div>
                        }
                        @Html.Raw(Model.MinSpecsHtml)
                    </div>
                    <div id="pq-table-column" class="grid-7 alpha omega">
                        @if (Model.VersionsList.Count() > 1)
                        {
                            <div id="model-version-dropdown" class="margin-right40 vertical-top">
                                <div class="select-box select-box-no-input done size-small">
                                    <p class="select-label">Version</p>
                                    <select id="ddlVersion" class="chosen-select" data-title="Version">
                                        @foreach (var version in Model.VersionsList)
                                        {
                                            <option value="@version.VersionId" @(version.VersionId == Model.VersionId ? "selected" : "")>@version.VersionName</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="single-version-content position-rel top-minus5 vertical-top margin-right40">
                                <p class="font12 text-light-grey">Version</p>
                                <p class="font14 text-bold single-version-value">@(Model.SelectedVersion != null ? Model.SelectedVersion.VersionName : "")</p>
                            </div>
                        }
                        <input type="hidden" value="@Model.VersionId" />

                        <div class="position-rel top-minus5 vertical-top getquotation" data-persistent="true" data-modelid="@Model.ModelId">
                            <p class="font12 text-light-grey">Location</p>
                            <p class="font14 text-bold block position-rel pos-top2">
                                @Html.Raw(Model.Location) <span class="margin-left5">
                                    <span class="bwsprite loc-change-blue-icon"></span>
                                </span>
                            </p>
                        </div>
                        <div>
                            <div id="pq-table" class="margin-top15">
                                @if (Model.primaryPriceList != null && Model.primaryPriceList.Count() > 0)
                                {
                                    <table cellspacing="0" cellpadding="0" width="100%" border="0">
                                        @foreach (var item in Model.primaryPriceList)
                                        {
                                            <tr class="row-with-padding">
                                                <td width="300" class="font14">
                                                    @item.CategoryName
                                                </td>
                                                <td width="170" align="right">
                                                    <span class="bwsprite inr-md"></span>&nbsp;<span id="exShowroomPrice" class="font16 text-bold">@CommonOpn.FormatPrice(item.Price.ToString())</span>
                                                </td>
                                            </tr>
                                        }
                                        <tr>
                                            <td colspan="2" class="padding-bottom5">
                                                <div class="border-light-bottom"></div>
                                            <td>
                                        </tr>

                                        <tr>
                                            <td>
                                                <p class="font14 text-bold">On-road price in @Html.Raw(Model.Location)</p>
                                            </td>
                                            <td align="right">
                                                <span class="bwsprite inr-md-lg"></span>&nbsp;<span class="font22 text-bold">@CommonOpn.FormatPrice(Model.TotalPrice.ToString())</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                @if (Model.IsPrimaryDealerAvailable)
                                                {
                                                    if (!Model.PrimaryDealer.DealerDetails.IsDSA)
                                                    {
                                                        <p class="font12 text-light-grey text-truncate position-rel top-minus5"> powered by @Model.PrimaryDealer.DealerDetails.Organization, @Model.PrimaryDealer.DealerDetails.objArea.AreaName</p>
                                                    }
                                                    else
                                                    {
                                                        <p class="font12 text-light-grey text-truncate position-rel top-minus5">*actual pricing may vary</p>
                                                    }
                                                }
                                            </td>
                                            <td align="right">
                                                @if (Model.IsPrimaryDealerAvailable)
                                                {
                                                    <a href="javascript:void(0)" class="font14 bw-ga leadcapturebtn" leadsourceid="8" data-item-id="@Model.DealerId" id="leadLink" name="leadLink" c="Dealer_PQ" a="Get_more_details_below_price_clicked" f="GetBikeVerLoc" rel="nofollow">Get more details</a>
                                                }
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" class="text-right padding-top5"></td>
                                        </tr>
                                        <tr class="hide">
                                            <td colspan="3"></td>
                                        </tr>
                                    </table>
                                }
                                else if (Model.Quotation != null && Model.Quotation.ExShowroomPrice > 0)
                                {
                                    <table cellspacing="0" cellpadding="0" width="100%" border="0">
                                        <tr class="row-with-padding">
                                            <td width="300" class="font14">
                                                Ex-Showroom (@Model.Quotation.City)
                                            </td>
                                            <td width="170" align="right">
                                                <span class="bwsprite inr-md"></span>&nbsp;<span id="exShowroomPrice" class="font16 text-bold">@CommonOpn.FormatNumeric(Model.Quotation.ExShowroomPrice.ToString())</span>
                                            </td>
                                        </tr>
                                        <tr class="row-with-padding">
                                            <td class="font14">RTO</td>
                                            <td align="right">
                                                <span class="bwsprite inr-md"></span>&nbsp;<span class="font16 text-bold">@CommonOpn.FormatNumeric(Model.Quotation.RTO.ToString())</span>
                                            </td>
                                        </tr>
                                        <tr class="row-with-padding">
                                            <td class="font14">
                                                Insurance (Comprehensive)
                                            </td>
                                            <td align="right">
                                                <span class="bwsprite inr-md"></span>&nbsp;<span class="font16 text-bold">@CommonOpn.FormatNumeric(@Model.Quotation.Insurance.ToString())</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" class="padding-bottom5">
                                                <div class="border-light-bottom"></div>
                                            <td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <p class="font14 text-bold">On-road price in @Html.Raw(Model.Location)</p>
                                            </td>
                                            <td align="right">
                                                <span class="bwsprite inr-md-lg"></span>&nbsp;<span class="font22 text-bold">@CommonOpn.FormatNumeric(Model.Quotation.OnRoadPrice.ToString())</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            @if (!Model.IsPrimaryDealerAvailable)
                                            {
                                                <td align="right" colspan="2"><p class="position-rel"><span class="position-abt neg-right15 pos-top0 font8">Ad</span><a target="_blank" href="https://www.bankbazaar.com/personal-loan.html?variant=slide&headline=HEADLINE_PL_MelaSale&WT.mc_id=bb01|BW|PL|PriceQuote&utm_source=bb01&utm_medium=display&utm_campaign=bb01|BW|PL|PriceQuote&variantOptions=mobileRequired" class="font14 bw-ga text-bold" c="Dealer_PQ" a="Get_personal_loan_offers_clicked" f="GetBikeVerLoc" rel="nofollow">Get personal loan offers</a></p></td>
                                            }
                                        </tr>
                                        <tr>
                                            <td>
                                                @if (Model.IsPrimaryDealerAvailable)
                                                {
                                                    <p class="font12 text-light-grey text-truncate position-rel top-minus5">powered by @Model.PrimaryDealer.DealerDetails.Organization, @Model.PrimaryDealer.DealerDetails.objArea.AreaName</p>
                                                }
                                            </td>
                                            <td align="right">
                                                @if (Model.IsPrimaryDealerAvailable)
                                                {
                                                    <a href="javascript:void(0)" class="font14 bw-ga leadcapturebtn" leadsourceid="8" data-item-id="@Model.DealerId" id="leadLink" name="leadLink" c="Dealer_PQ" a="Get_more_details_below_price_clicked" f="GetBikeVerLoc" rel="nofollow">Get more details</a>
                                                }
                                            </td>
                                        </tr>
                                    </table>

                                }
                                else
                                {
                                    <div>
                                        <p class="font16 text-bold">Price for this bike is not available in this city.</p>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="clear"></div>

                    @if (Model.PrimaryDealer != null && Model.PrimaryDealer.DealerDetails != null && Model.PrimaryDealer.DealerDetails.objArea != null)
                    {
                        @Html.Partial("~/Views/Price/_DealerCampaign.cshtml", Model.DetailedDealer)
                    }
                </div>
            </div>
        </div>
        <div class="clear"></div>
    </div>
</section>


@*@if (Model.DealerId == 0 && Model.DetailedDealer != null && Model.DetailedDealer.SecondaryDealerCount == 0 && Model.Quotation != null && string.IsNullOrEmpty(Model.Quotation.ManufacturerAd))
    {
        <section>
            <div class="container">
                <div class="grid-12 margin-bottom20">
                    <div class="content-box-shadow">
                        <div class="margin-left10 margin-right10"></div>
                        <BW:Dealers ID="ctrlDealers" runat="server" />
                    </div>
                </div>
            </div>
        </section>
    }*@

<!-- move into another file -->
@if (Model.ManufacturerCampaign != null)
{
    @Html.Partial("~/Views/Price/_ManufacturerCampaign.cshtml", Model.ManufacturerCampaign)
}

@if (Model.DetailedDealer != null && Model.DetailedDealer.SecondaryDealerCount > 0)
{
    @Html.Partial("~/Views/Price/_SecondaryDealers.cshtml", Model.DetailedDealer.SecondaryDealers)
}

    @*@if (ctrlAlternativeBikes.FetchedRecordsCount > 0)
        {
        <!-- Alternate bikes section starts-->
        <section>
            <div class="container margin-bottom30">
                <div class="grid-12">
                    <BW:AlternativeBikes ID="ctrlAlternativeBikes" runat="server" />
                </div>
                <div class="clear"></div>
            </div>
        </section>
        <!-- Alternate bikes section ends -->
        }*@

    <script type="text/javascript" src="@(!String.IsNullOrEmpty(Bikewale.Utility.BWConfiguration.Instance.StaticUrl) ? "https://st.aeplcdn.com" + @Bikewale.Utility.BWConfiguration.Instance.StaticUrl : "")/src/frameworks.js?@Bikewale.Utility.BWConfiguration.Instance.StaticCommonFileVersion"></script>

    <script type="text/javascript">

        var dealerId = '@Model.DealerId';
        var pqId = '@Model.PQId';
        var ABHostUrl = '@System.Configuration.ConfigurationManager.AppSettings["ApiHostUrl"]';
        var versionId = '@Model.VersionId';
        var cityId = '@Model.CityId';
        var areaId = '@Model.AreaId';
        var clientIP = "";
        var versionName = "@(Model.SelectedVersion != null ? Model.SelectedVersion.VersionName : "")";
        var pageUrl = "www.bikewale.com/pricequote/dealerpricequote.aspx?versionId=" + versionId + "&cityId=" + cityId;
        var bikeVerLocation,EMIviewModel;

        var bikeName = "@Model.bikeName";
        var bikeVersionPrice = "@Model.TotalPrice";
        var leadSourceId = '@Model.(int)Bikewale.Entities.PriceQuote.PQSourceEnum.Desktop_DPQ_SecondaryDealers';

        function secondarydealer_Click(dealerID) {
            triggerGA('Dealer_PQ', 'Secondary_Dealer_Card_Clicked', bikeVerLocation);
            try {
                var isSuccess = false;

                var objData = {
                    "dealerId": dealerID,
                    "modelId": @Model.ModelId,
                    "versionId": versionId,
                    "cityId": cityId,
                    "areaId": areaId,
                    "clientIP": clientIP,
                    "pageUrl": pageUrl,
                    "sourceType": 1,
                    "pQLeadId": pqSourceId,
                    "deviceId": getCookie('BWC')
                };

                isSuccess = dleadvm.registerPQ(objData);

                if (isSuccess) {
                    var rediurl = "CityId=" + cityId + "&AreaId=" + areaId + "&PQId=" + dleadvm.pqId() + "&VersionId=" + versionId + "&DealerId=" + dealerID;
                    window.location.href = "/pricequote/dealerpricequote.aspx?MPQ=" + Base64.encode(rediurl);
                }
            } catch (e) {
                console.warn("Unable to create pricequote : " + e.message);
            }
        }
        function openLeadCaptureForm(dealerID) {
            triggerGA('Dealer_PQ', 'Secondary_Dealer_Get_Offers_Clicked', bikeVerLocation);
            event.stopPropagation();
        }



        function GetBikeVerLoc() {
            return bikeName + "_" + versionName + "_" + "";//getCityArea;
        }

        function formatPrice(price) {
            price = price.toString();
            var lastThree = price.substring(price.length - 3);
            var otherNumbers = price.substring(0, price.length - 3);
            if (otherNumbers != '')
                lastThree = ',' + lastThree;
            var price = otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g, ",") + lastThree;
            return price;
        }

        docReady(function() {
            bikeVerLocation = GetBikeVerLoc();
            @if (Model.DetailedDealer != null && Model.DetailedDealer.SecondaryDealers != null && Model.DetailedDealer.SecondaryDealerCount > 0)
            {
                <text>triggerGA('Dealer_PQ', 'Secondary_Dealer_Card_Shown', bikeVerLocation);</text>
            }
            @if (Model.Quotation != null && Model.Quotation.ExShowroomPrice > 0)
            {
                <text>triggerGA('Dealer_PQ', 'Get_personal_loan_offers_shown', GetBikeVerLoc());</text>
            }

            $("input[name*='btnVariant']").on("click", function () {
                if ($(this).attr('versionid') == $('#hdnVariant').val()) {
                    return false;
                }
                $('#hdnVariant').val($(this).attr('title'));
                triggerGA('Dealer_PQ', 'Version_Change', bikeVerLocation);
            });

            if ($('.pricequote-benefits-list li').length % 2 == 0) {
                $('.pricequote-benefits-list').addClass("pricequote-two-benefits");
            }


            $("#readmore").on("click", function () {
                var dealerType = '@Model.DealerType';
                loadDisclaimer(dealerType);
            });
            $('.blackOut-window').on("click", function () {
                $("div#termsPopUpContainer").hide();
                $(".blackOut-window").hide();
            });
            $(".leadcapturebtn").click(function (e) {
                ele = $(this);
                var leadOptions = {
                    "dealerid": ele.attr('data-item-id'),
                    "dealername": ele.attr('data-item-name'),
                    "dealerarea": ele.attr('data-item-area'),
                    "versionid": versionId,
                    "leadsourceid": ele.attr('data-leadsourceid'),
                    "pqsourceid": ele.attr('data-pqsourceid'),
                    "isleadpopup": ele.attr('data-isleadpopup'),
                    "mfgCampid": ele.attr('data-mfgcampid'),
                    "pqid": pqId,
                    "pageurl": pageUrl,
                    "clientip": clientIP,
                    "dealerHeading" : ele.attr('data-item-heading'),
                    "dealerMessage" : ele.attr('data-item-message'),
                    "dealerDescription" : ele.attr('data-item-description'),
                    "pinCodeRequired":ele.attr("data-ispincodrequired"),
                    "gaobject": {
                        cat: ele.attr("c"),
                        act: ele.attr("a"),
                        lab: bikeVerLocation
                    }

                };
                dleadvm.setOptions(leadOptions);
            });

        });
    </script>
