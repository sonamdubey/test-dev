@model Bikewale.Models.Price.DealerPriceQuotePageVM
@using Bikewale.Common;
@using Bikewale.BikeBooking;
@{
    Model.Page_ATF_CSS = "<link rel='stylesheet' type='text/css' href='/m/css/dealerpricequote.css' />";
    Model.Page_BTF_CSS_Path = "";
    Model.Page_JS_Path = "/m/src/dealerpricequote.js";
    Model.AdTags.AdPath = "/1017752/Bikewale_Mobile_PriceQuote";
    Model.AdTags.AdId = "1398766000399";
    Layout = "~/Views/Shared/_Layout_Mobile.cshtml";
    ViewBag.TotalPrice = Model.TotalPrice; // to pass price component on dealer campaign if dealerprice not available
    Model.AdTags.Ad_320x50 = true;
    Model.AdTags.Ad_Bot_320x50 = true;
}

<div class="bg-white padding-10-5 bottom-shadow margin-bottom10">
    <div class="bike-details margin-bottom15">
        <h1>@Model.BikeName</h1>
        <p class="font12 text-light-grey padding-left15 padding-right5">Version:</p>
        @if (Model.VersionsList.Count() > 1)
        {
            <div class="dropdown-select-wrapper margin-left15">
                <select id="ddlVersion" class="dropdown-select" data-title="Version">
                    @foreach (var version in Model.VersionsList)
                    {
                        <option value="@version.VersionId" @(version.VersionId == Model.VersionId ? "selected" : "")>@version.VersionName</option>
                    }
                </select>
            </div>
        }
        else
        {
            <div class="single-version-content font14 margin-left15">
                <p class="dropdown-effect-light">@(Model.SelectedVersion != null ? Model.SelectedVersion.VersionName : "")</p>
            </div>
        }
        <div class="text-center">
            <img src="@Bikewale.Utility.Image.GetPathToShowImages(Model.SelectedVersion.OriginalImagePath, Model.SelectedVersion.HostUrl, Bikewale.Utility.ImageSize._210x118)" title="@Model.BikeName Images" alt="@Model.BikeName Images" border="0" />
        </div>
        <p class="font12 text-light-grey padding-left15 padding-right15">Location:</p>
        <p class="font16 text-bold padding-left15 padding-right15">
            @Html.Raw(Model.Location)
            <a href="javascript:void(0)" rel="nofollow" data-pqsourceid="@((int)Bikewale.Entities.PriceQuote.PQSourceEnum.Mobile_DPQ_Quotation)" data-modelid="@Model.ModelId" class="getquotation" data-persistent="true"><span class="bwmsprite loc-change-blue-icon"></span></a>
        </p>
    </div>

    <!-- Price Breakup starts here -->
    <div class="padding-left15 padding-right15">
        @if (Model.IsDealerPriceQuote)
        {
            <div class="break-line margin-bottom15"></div>
        <!-- Dealer PQ starts -->
            <table width="100%" border="0" cellspacing="0" cellpadding="0" class="pqTable font14">
                @foreach (var item in Model.DetailedDealer.PrimaryDealer.PriceList)
                {
                    <tr>
                        <td align="left" width="65%" class="padding-bottom15">
                            @item.CategoryName
                        </td>
                        <td align="right" width="35%" class="padding-bottom15 text-bold">
                            <span class="bwmsprite inr-xxsm-icon"></span>&nbsp;@CommonOpn.FormatPrice(item.Price.ToString())
                        </td>
                    </tr>
                }
                <tr >
                    <td height="1" colspan="2" class="break-line padding-bottom15"></td>
                </tr>
                <tr>
                    <td align="left" class="font16 padding-bottom5 position-rel">GST On-road price @string.Format("{0}", Model.DetailedDealer.PrimaryDealer.PriceList.FirstOrDefault().IsGstPrice ? "" : "(estimated)")
						<div class="price--label-position pos-bottom-40">
							<span class="bwmsprite info-grey-14"></span>
							<span class="text-light-grey font12">@string.Format("{0}", Model.DetailedDealer.PrimaryDealer.PriceList.FirstOrDefault().IsGstPrice ? "In accordance with GST rates" : "Final dealer price unavailable.")</span>
						</div>
					</td>
                    <td align="right" valign="top" class="font18 text-bold padding-bottom5">@Html.Raw("<span > &#x20B9;</span>")&nbsp;@Bikewale.Utility.Format.FormatPrice(Model.TotalPrice.ToString())</td>
                </tr>
                <tr>
                    <td colspan="2" align="right" class="text-light-grey padding-bottom15">
                        @if (Model.IsPrimaryDealerAvailable)
                        {
                            <a id='getMoreDetails' class="get-offer-link bw-ga leadcapturebtn" data-item-registerpq="false" data-leadsourceid="23" data-item-id="@Model.DealerId" data-item-name="@Model.DetailedDealer.PrimaryDealer.DealerDetails.Organization" data-item-area="@Model.DetailedDealer.PrimaryDealer.DealerDetails.objArea.AreaName" data-pqsourceid="@Convert.ToUInt16(Bikewale.Entities.PriceQuote.PQSourceEnum.Mobile_DPQ_Quotation)" c="Dealer_PQ" a="Get_more_details_below_price_clicked" f="GetBikeVerLoc">Get more details</a>
                        }
                    </td>
                </tr>
            </table>
        <!-- Bikewale PQ ends -->
        }
        else if (Model.Quotation != null && Model.Quotation.ExShowroomPrice > 0)
        {
        <!-- Bikewale PQ starts -->
            <table width="100%" border="0" cellspacing="0" cellpadding="0" class="pqTable font14">
                <tr>
                    <td class="text-light-grey padding-bottom15" width="60%" align="left">Ex-Showroom (@Model.Quotation.City)</td>
                    <td class="padding-bottom15 text-bold" width="40%" align="right"><span class="bwmsprite inr-xxsm-icon"></span>@CommonOpn.FormatNumeric(Model.Quotation.ExShowroomPrice.ToString())</td>
                </tr>
                <tr>
                    <td class="text-light-grey padding-bottom15" align="left">RTO</td>
                    <td class="padding-bottom15 text-bold" align="right"><span class="bwmsprite inr-xxsm-icon"></span>@CommonOpn.FormatPrice(Model.Quotation.RTO.ToString())</td>
                </tr>
                <tr>
                    <td class="text-light-grey padding-bottom15" align="left">Insurance @if (!Model.IsPrimaryDealerAvailable&& !string.IsNullOrEmpty(Bikewale.Utility.BWConfiguration.Instance.CoverFoxLink))
                    {<br><p class='position-rel'><a target="_blank" href="@Bikewale.Utility.BWConfiguration.Instance.CoverFoxLink" class="font12 bw-ga text-bold" c="Dealer_PQ" a="CoverFox_Link_Clicked" l="@string.Format("{0}_{1}",Model.BikeName,Model.CiyName);" rel="nofollow">Buy Policy Now</a><span class='position-abt pos-left35 pos-top0'>Ad</span></p>}</td>
                    <td class="padding-bottom10 text-bold" align="right"><span class="bwmsprite inr-xxsm-icon"></span>@CommonOpn.FormatPrice(Model.Quotation.Insurance.ToString())</td>
                </tr>

                <tr align="left">
                    <td height="1" colspan="2" class="break-line padding-bottom10"></td>
                </tr>
                <tr>
                    <td class="font16 position-rel" align="left">GST On-road price @string.Format("{0}", Model.Quotation.IsGstPrice ? "" : "(estimated)")
						<div class="price--label-position pos-bottom-40">
							<span class="bwmsprite info-grey-14"></span>
							<span class="text-light-grey font12">@string.Format("{0}", Model.Quotation.IsGstPrice ? "In accordance with GST rates" : "Estimated GST price as dealer price is unavailable.")</span>
						</div>
					</td>
                    <td valign="top" class="font18 text-bold" align="right">
                        @Html.Raw("<span> &#x20B9;</span>")&nbsp;@CommonOpn.FormatPrice(Model.Quotation.OnRoadPrice.ToString())
                    </td>
                </tr>
				@if (Model.IsPrimaryDealerAvailable)
				{
                <tr class="padding-bottom10">
                    <td colspan="2" align="right" class="text-bold padding-bottom10">
						<a id="getMoreDetails" class="get-offer-link bw-ga leadcapturebtn" data-item-registerpq="false" data-leadsourceid="23" data-item-id="@Model.DealerId" data-item-name="@Model.DetailedDealer.PrimaryDealer.DealerDetails.Organization" data-item-area="@Model.DetailedDealer.PrimaryDealer.DealerDetails.objArea.AreaName" data-pqsourceid="@Convert.ToUInt16(Bikewale.Entities.PriceQuote.PQSourceEnum.Mobile_DPQ_Quotation)" c="Dealer_PQ" a="Get_more_details_below_price_clicked" f="GetBikeVerLoc">Get more details</a>
                    </td>
                </tr>
				}
            </table>
			if (Model.IsPrimaryDealerAvailable)
			{
				<div class="padding-bottom10"></div>
			}
			else {
				<div class="padding-bottom40"></div>
			}
        <!-- Bikewale PQ ends -->
        }
        else
        {
            <div class="margin-top10 padding5" style="background: #fef5e6;">Price for this bike is not available in this city.</div>
        }
    </div>
    <!-- Price Breakup ends here -->
    @if (Model.DetailedDealer.PrimaryDealer != null && Model.DetailedDealer.PrimaryDealer.DealerDetails != null && Model.DetailedDealer.PrimaryDealer.DealerDetails.objArea != null)
    {
        @Html.Partial("~/Views/Price/_DealerCampaign_Mobile.cshtml", Model.DetailedDealer)
    }
    <div class="clear"></div>
</div>


@if (Model.DetailedDealer != null && Model.DetailedDealer.SecondaryDealerCount > 0 && !(Model.IsManufacturerLeadAdShown || Model.IsManufacturerEMIAdShown))
{
    <section>
        @Html.Partial("~/Views/Price/_SecondaryDealers_Mobile.cshtml", Model.DetailedDealer.SecondaryDealers)
        <div class="clear"></div>
    </section>
}

@if (Model.IsManufacturerLeadAdShown)
{
    @Html.Partial("~/Views/Price/_ManufacturerCampaign_Mobile.cshtml", Model.LeadCampaign)
    <div class="campaign__floating-btn floating-btn clearfix">
        <p class="grid-7 alpha btn__left-label">@String.Format(Model.LeadCampaign.LeadsPropertyTextMobile, Model.LeadCampaign.Organization)</p>
        <div class="grid-5 alpha omega">
            <a data-mfgcampid="@Model.LeadCampaign.CampaignId" data-item-id="@Model.LeadCampaign.DealerId" data-item-area="@Model.LeadCampaign.Area" data-leadsourceid="@Model.LeadCampaign.LeadSourceId" data-pqsourceid="@Model.LeadCampaign.PqSourceId" data-item-message="@String.Format(Model.LeadCampaign.PopupSuccessMessage,Model.LeadCampaign.Organization)" data-item-heading="@Model.LeadCampaign.PopupHeading" data-item-description="@Model.LeadCampaign.PopupDescription" data-ispincodrequired="@Model.LeadCampaign.PincodeRequired" data-dealersrequired="@Model.LeadCampaign.DealerRequired" data-item-name="@(String.Format(Model.LeadCampaign.LeadsButtonTextMobile,Model.LeadCampaign.Organization))" id="btnfloatingManufacturer" data-isemailrequired="@Model.LeadCampaign.EmailRequired" class="btn btn-orange btn-full-32 leadcapturebtn">@Model.LeadCampaign.LeadsButtonTextMobile</a>
        </div>
        <div class="clear"></div>
    </div>
}
@if (!(Model.DetailedDealer.PrimaryDealer != null && Model.DetailedDealer.PrimaryDealer.DealerDetails != null && Model.DetailedDealer.PrimaryDealer.DealerDetails.objArea != null))
{
    <section>
        <div id="emiContent" class="bw-model-tabs-data content-box-shadow card-bottom-margin content-inner-block-20">
            <h2 class="card-h2-heading margin-bottom10">@Model.SelectedVersion.ModelBase.ModelName EMI Calculator</h2>

            <div class="finance-emi-container font14">
                <div class="emi-slider-box">
                    <div class="emi-slider-box-left-section">
                        <p class="grid-8 alpha text-slate-grey">Down payment</p>
                        <div class="emi-slider-box-right-section grid-4 omega">
                            <span class="bwmsprite inr-xxsm-icon margin-right5"></span><span id="downPaymentAmount" data-bind="text: formatPrice(Math.round(downPayment()))" class="text-bold"></span>
                        </div>
                        <div class="clear"></div>

                        <div id="downPaymentSlider"
                             data-bind="slider: downPayment, sliderOptions: { min: minDnPay(), max: maxDnPay(), range: 'min', step: 1, value: Math.round(((maxDnPay() - minDnPay()) / 2) + minDnPay()) }"
                             class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all bw-ga" c="Dealer_PQ" a="Interacted_with_EMI_Calculator" l="@Model.BikeName">
                            <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min"></div>
                            <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0"></span>
                        </div>
                    </div>
                    <div class="clear"></div>
                </div>

                <div class="emi-slider-box">
                    <div class="emi-slider-box-left-section">
                        <p class="grid-8 alpha text-slate-grey">Loan amount</p>
                        <div class="emi-slider-box-right-section grid-4 omega">
                            <span class="bwmsprite inr-xxsm-icon margin-right5"></span><span id="loanAmount" data-bind="text: formatPrice(Math.round(loan()))" class="text-bold"></span>
                        </div>
                        <div class="clear"></div>

                        <div id="loanAmountSlider"
                             data-bind="slider: loan, sliderOptions: { min: bikePrice() - maxDnPay(), max: bikePrice() - minDnPay(), range: 'min', step: 1 }"
                             class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all bw-ga" c="Dealer_PQ" a="Interacted_with_EMI_Calculator" l="@Model.BikeName">
                            <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min"></div>
                            <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0"></span>
                        </div>
                    </div>
                    <div class="clear"></div>
                </div>

                <div class="emi-slider-box">
                    <div class="emi-slider-box-left-section">
                        <p class="grid-8 alpha text-slate-grey">Tenure</p>
                        <div class="emi-slider-box-right-section grid-4 omega text-bold">
                            <span id="tenurePeriod" data-bind="text: tenure"></span>&nbsp;Months
                        </div>
                        <div class="clear"></div>

                        <div id="tenureSlider"
                             data-bind="slider: tenure, sliderOptions: { min: minTenure(), max: maxTenure(), range: 'min', step: 1 }"
                             class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all bw-ga" c="Dealer_PQ" a="Interacted_with_EMI_Calculator" l="@Model.BikeName">
                            <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min"></div>
                            <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0"></span>
                        </div>
                    </div>
                    <div class="clear"></div>
                </div>

                <div class="emi-slider-box">
                    <div class="emi-slider-box-left-section">
                        <p class="grid-8 alpha text-slate-grey">Interest</p>
                        <div class="emi-slider-box-right-section grid-4 omega text-bold">
                            <span id="rateOfInterestPercentage" data-bind="text: rateofinterest">5</span>&nbsp;%
                        </div>
                        <div class="clear"></div>

                        <div id="rateOfInterestSlider"
                             data-bind="slider: rateofinterest, sliderOptions: { min: minROI(), max: maxROI(), range: 'min', step: 0.25 }"
                             class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all bw-ga" c="Dealer_PQ" a="Interacted_with_EMI_Calculator" l="@Model.BikeName">
                            <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min"></div>
                            <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0"></span>
                        </div>
                    </div>
                    <div class="clear"></div>
                </div>

                <div class="border-solid-top padding-top20 padding-bottom15">
                    <p class="grid-9 alpha text-slate-grey omega">Total amount (Principal + Interest)</p>
                    <div class="emi-slider-box-right-section grid-3 omega alpha">
                        <span class="bwmsprite inr-xxsm-icon margin-right5"></span><span class="text-bold" data-bind="text: formatPrice(Math.round(totalPayable()))"></span>
                    </div>
                    <div class="clear"></div>
                </div>

                <p class="grid-5 text-default alpha position-rel pos-top2">Indicative EMI</p>
                <div class="text-right grid-7 omega font16 text-bold">
                    @Html.Raw("<span> &#x20B9;</span>")&nbsp;<span data-bind="text: formatPrice(monthlyEMI())"></span>/month
                </div>
                <div class="clear"></div>
                @if (Model.IsManufacturerEMIAdShown)
                {
                    <div class="powered-by-campaign-wrapper margin-top15">
                        <a href="javascript:void(0)" type="button" class="btn btn-teal btn-160-32 font14 margin-right10 leadcapturebtn" data-mfgcampid="@Model.EMICampaign.CampaignId" data-item-id="@Model.EMICampaign.DealerId" data-item-area="@Model.EMICampaign.Area" data-leadsourceid="@Model.EMICampaign.LeadSourceId" data-pqsourceid="@Model.EMICampaign.PqSourceId" data-item-message="@String.Format(Model.EMICampaign.PopupSuccessMessage,Model.EMICampaign.Organization)" data-item-heading="@Model.EMICampaign.PopupHeading" data-item-description="@Model.EMICampaign.PopupDescription" data-ispincodrequired="@Model.EMICampaign.PincodeRequired" data-dealersrequired="@Model.EMICampaign.DealerRequired" data-item-name="@(String.Format("Authorised {0} Dealer", Model.EMICampaign.Organization))" id="btnManufacturer" data-isemailrequired="@Model.EMICampaign.EmailRequired">@Model.EMICampaign.EMIButtonTextMobile</a>
                        <div class="inline-block">
                            <p class="campaign__powered-key">Powered by</p>
                            <p class="campaign__powered-value" title="@String.Format(Model.EMICampaign.EMIPropertyTextMobile, Model.EMICampaign.Organization)">@String.Format(Model.EMICampaign.EMIPropertyTextMobile, Model.EMICampaign.Organization)</p>
                        </div>
                    </div>
                }
            </div>
        </div>
    </section>
}
@if (Model.ShowOtherDealers && Model.AreOtherDealersAvailable)
{
    <section class="container bg-white margin-bottom10">
        <div class="box-shadow">
            <div id="makeDealersContent" class="bw-model-tabs-data padding-bottom20 padding-top15 font14">
                <div class="carousel-heading-content">
                    <div class="swiper-heading-left-grid inline-block">
                        <h2>@Model.SelectedVersion.MakeBase.MakeName Showrooms in @Model.Quotation.City</h2>
                    </div>
                    <div class="swiper-heading-right-grid inline-block text-right">
                        <a href="@string.Format("/m{0}", Bikewale.Utility.UrlFormatter.DealerLocatorUrl(Model.SelectedVersion.MakeBase.MaskingName, Model.Quotation.CityMaskingName))" title="@Model.SelectedVersion.MakeBase.MakeName Showrooms in @Model.Quotation.City" class="btn view-all-target-btn">View all</a>
                    </div>
                    <div class="clear"></div>
                </div>
                @Html.Partial("~/Views/DealerShowroom/_DealerCard_Mobile.cshtml", Model.OtherDealers)
                <div class="clear"></div>
            </div>
            <div class="margin-right10 margin-left10 border-solid-bottom"></div>
        </div>
    </section>
}

@if (Model.SimilarBikesVM != null && Model.SimilarBikesVM.Bikes != null && Model.SimilarBikesVM.Bikes.Count() > 0)
{
    <section>
        <div class="bg-white bottom-shadow margin-top10 margin-bottom20 padding-bottom10">
            <div id="modelAlternateBikeContent" class="bw-model-tabs-data padding-top15 font14 margin-bottom20">
                <h2 class="padding-left20 padding-right20 margin-bottom20">@Model.BodyStyleText Similar to @Model.BikeName</h2>
                @Html.Partial("~/Views/BikeModels/_SimilarBikes_Mobile.cshtml", Model.SimilarBikesVM)
            </div>
        </div>
    </section>
}

@if (Model.LeadCapture != null)
{
    @Html.Partial("~/Views/Shared/_LeadCapture_Mobile.cshtml", Model.LeadCapture)
}

<script type="text/javascript">

    var dealerId = '@Model.DealerId', pqId = '@Model.PQId', versionId = '@Model.VersionId', modelId = '@Model.ModelId';
    var ABHostUrl = '@System.Configuration.ConfigurationManager.AppSettings["ApiHostUrl"]';
    var cityId = '@Model.CityId', areaId = '@Model.AreaId';
    var clientIP = "@Model.ClientIP";
    var pageUrl = window.location.href, getCityArea;
    var bikeVerLocation, EMIviewModel, dealerType = '@Model.DealerType';
    var dealerName = '@(Model.IsPrimaryDealerAvailable ? Model.DetailedDealer.PrimaryDealer.DealerDetails.Organization : "")';
    var versionName = "@(Model.SelectedVersion != null ? Model.SelectedVersion.VersionName : "")";
    var leadSourceId = "@((int)Bikewale.Entities.PriceQuote.PQSourceEnum.Desktop_DPQ_SecondaryDealers)";
    var bikeName = "@Model.BikeName", bikeVersionPrice = "@Model.TotalPrice";
    var quotationPage = true;
    var bwTrackingLab = "@Model.BhriguTrackingLabel";

    docReady(function () {
        ga_pg_id = "7";
        try {
            getCityArea = GetGlobalCityArea();
            bikeVerLocation = bikeName + '_' + versionName + '_' + getCityArea;
            gaLabel = bikeVerLocation;
            @if (Model.DetailedDealer != null && Model.DetailedDealer.SecondaryDealers != null && Model.DetailedDealer.SecondaryDealerCount > 0)
         {
             <text>triggerNonInteractiveGA('Dealer_PQ', 'Secondary_Dealer_Card_Shown', bikeVerLocation);</text>
         }

            @if (Model.Quotation != null && Model.Quotation.ExShowroomPrice > 0)
        {
            <text>triggerNonInteractiveGA('Dealer_PQ', 'CoverFox_Link_Shown', bikeVerLocation);</text>
        }

            if (dealerName != "") {
                $("#header-dealername").text(dealerName);
            }
            else {
                $("#headerText").removeClass("font12").addClass("font20 margin-top5");
            }

        }
        catch (e) {
            console.log(e.message);
        }

    });

</script>
