@model Bikewale.Models.HomePageVM
@{
    Layout = "~/Views/Shared/_Layout_Mobile.cshtml";
    Model.Page_ATF_CSS = "<link rel='stylesheet' type='text/css' href='/m/css/home.css' />";
    Model.Page_BTF_CSS_Path = "/m/css/bwm-common-btf.css";
    Model.Page_JS_Path = "";
    Model.AdTags.AdPath = "/1017752/Bikewale_Mobile_Homepage";
    Model.AdTags.AdId = "1450262275060";
    Model.PageMetaTags.AlternateUrl = "https://www.bikewale.com/m/";
    Model.AdTags.Ad320x150_Top = true;
    Model.AdTags.Ad320x150_Bottom = true;

    #region

    bool IsPopularBikesDataAvailable = (Model.PopularBikes != null && Model.PopularBikes.Bikes != null && Model.PopularBikes.Bikes.Count() > 0);
    bool IsNewLaunchedDataAvailable = (Model.NewLaunchedBikes != null && Model.NewLaunchedBikes.Bikes != null && Model.NewLaunchedBikes.Bikes.Count() > 0);
    bool IsUsedBikeCitiesAvailable = (Model.UsedBikeCities != null && Model.UsedBikeCities.Cities != null && Model.UsedBikeCities.Cities.Count() > 0);
    bool IsUpcomingBikeAvailable = (Model.UpcomingBikes != null && Model.UpcomingBikes.UpcomingBikes != null && Model.UpcomingBikes.UpcomingBikes.Count() > 0);
    bool IsUsedModelsAvailable = (Model.UsedModels != null && Model.UsedModels.UsedBikeModelList != null && Model.UsedModels.UsedBikeModelList.Count() > 0);
    var reviewTabsCnt = 0;
    bool isNewsActive = false, isExpertReviewActive = false, isVideoActive = false;

    if (Model.News.FetchedCount > 0)
    {
        reviewTabsCnt++;
        isNewsActive = true;
    }
    if (Model.ExpertReviews.FetchedCount > 0)
    {
        reviewTabsCnt++;
        if (!isNewsActive)
        {
            isExpertReviewActive = true;
        }
    }
    if (Model.Videos.FetchedCount > 0)
    {
        reviewTabsCnt++;
        if (!isExpertReviewActive && !isNewsActive)
        {
            isVideoActive = true;
        }
    }
    #endregion
}
<body class="page-type-landing bg-light-grey">
    <section>
        <div class="banner-home">
            <div class="container banner-container text-center top-campaign-banner-container">
                <!-- Top banner code starts here -->
                <h1 class="font22 text-uppercase text-white">Find your bike</h1>
                <h2 class="banner-subheading font14 text-unbold text-white">Get Comprehensive Information on Bikes!</h2>
                <div class="new-bikes-search position-rel">
                    <input type="text" placeholder="Search your bike here, e.g. Honda Activa " id="newBikeList" autocomplete="off" class="rounded-corner2">
                    <a href="javascript:void(0);" id="btnSearch" class="btn btn-orange btn-search" rel="nofollow"><span class="bwmsprite search-bold-icon"></span></a>
                    <span id="loaderMakeModel" class="fa-spinner position-abt pos-right45 pos-top15" style="display: none"></span>
                </div>
                <ul id="errNewBikeSearch" class="ui-autocomplete ui-front ui-menu hide">
                    <li class="ui-menu-item" tabindex="-1">
                        <span class="text-bold">Oops! No suggestions found</span><br />
                        <span class="text-light-grey font12">Search by bike name e.g: Honda Activa</span>
                    </li>
                </ul>
                <ul id="new-global-recent-searches" style="position: relative;margin:0;text-align: left" class="ui-autocomplete ui-front ui-menu ui-widget ui-widget-content hide"></ul>
                @if (Model.Banner != null)
                {
                    @Html.Raw(Model.Banner.MobileCss);
                    @Html.Raw(Model.Banner.MobileHtml);
                    @Html.Raw(Model.Banner.MobileJS);
                }
            </div>
        </div>
    </section>
    <section>
        @{Html.RenderPartial("/Views/Shared/Ads/Mobile/Ad320x150_First.cshtml", new { AdId = Model.AdTags.AdId });}
    </section>
    <section>
        <div class="container">
            <div class="grid-12 alpha omega">
                <h2 class="font18 text-center margin-top20 margin-bottom10">Discover your bike</h2>
                <div class="bw-tabs-panel padding-bottom20 content-box-shadow bg-white" id="discoverBikesContainer">

                    <div class="bw-tabs bw-tabs-flex">
                        <ul class="brand-collapsible-present">
                            <li class="active" data-tabs="discoverBrand">Brand</li>
                            <li data-tabs="discoverBudget">Budget</li>
                            <li data-tabs="discoverMileage">Mileage</li>
                            <li data-tabs="discoverStyle">Style</li>
                        </ul>
                    </div>

                    <div class="bw-tabs-data collapsible-brand-content" id="discoverBrand">
                        @Html.Partial("~/Views/Make/_Brands_Mobile.cshtml", Model.Brands)
                    </div>
                    <div class="bw-tabs-data hide" id="discoverBudget">
                        <div class="budget-container">
                            <ul class="text-center">
                                <li>
                                    <a href="/m/new/bike-search/?budget=0-50000">
                                        <span class="budget-title-box font14">
                                            Upto
                                        </span>
                                        <span class="budget-amount-box">
                                            <span class="bwmsprite inr-grey-xxsm-icon"></span>
                                            <span class="font14 text-bold">50,000</span>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/m/new/bike-search/?budget=50000-100000">
                                        <span class="budget-title-box font14">
                                            Between
                                        </span>
                                        <span class="budget-amount-box font14 text-bold">
                                            <span class="bwmsprite inr-grey-xxsm-icon"></span>
                                            <span>50,000 - </span>
                                            <span class="bwmsprite inr-grey-xxsm-icon"></span>
                                            <span>1</span>
                                            <span class="budget-amount-text-box">Lac</span>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/m/new/bike-search/?budget=100000-250000">
                                        <span class="budget-title-box font14">
                                            Between
                                        </span>
                                        <span class="budget-amount-box font14 text-bold">
                                            <span class="bwmsprite inr-grey-xxsm-icon"></span>
                                            <span>1</span>
                                            <span class="budget-amount-text-box">Lac</span>
                                            <span>- </span>
                                            <span class="bwmsprite inr-grey-xxsm-icon"></span>
                                            <span>2.5</span>
                                            <span class="budget-amount-text-box">Lac</span>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/m/new/bike-search/?budget=250000-">
                                        <span class="budget-title-box font14">
                                            Above
                                        </span>
                                        <span class="budget-amount-box font14 text-bold">
                                            <span class="bwmsprite inr-grey-xxsm-icon"></span>
                                            <span>2.5</span>
                                            <span class="budget-amount-text-box">Lac</span>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="bw-tabs-data hide" id="discoverMileage">
                        <div class="mileage-container">
                            <ul class="text-center">
                                <li>
                                    <a href="/m/new/bike-search/?mileage=1">
                                        <span class="mileage-title-box font14">
                                            Above
                                        </span>
                                        <span class="mileage-amount-box">
                                            <span class="font14 text-bold">70 Kmpl</span>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/m/new/bike-search/?mileage=2">
                                        <span class="mileage-title-box font14">
                                            Between
                                        </span>
                                        <span class="mileage-amount-box font14 text-bold">
                                            <span class="">70</span>
                                            <span class="mileage-amount-text-box">Kmpl</span>
                                            <span class="">- 50</span>
                                            <span class="mileage-amount-text-box">Kmpl</span>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/m/new/bike-search/?mileage=3">
                                        <span class="mileage-title-box font14">
                                            Between
                                        </span>
                                        <span class="mileage-amount-box font14 text-bold">
                                            <span class="">50</span>
                                            <span class="mileage-amount-text-box">Kmpl</span>
                                            <span class="">- 30</span>
                                            <span class="mileage-amount-text-box">Kmpl</span>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/m/new/bike-search/?mileage=4">
                                        <span class="mileage-title-box font14">
                                            Upto
                                        </span>
                                        <span class="mileage-amount-box">
                                            <span class="font14 text-bold">30 Kmpl</span>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="bw-tabs-data hide" id="discoverStyle">
                        <div class="style-type-container">
                            <ul class="text-center">
                                <li>
                                    <a href="/m/new/bike-search/?ridestyle=5">
                                        <span class="style-type">
                                            <span class="styletypesprite style-scooters"></span>
                                        </span>
                                        <span class="style-type-title">Scooters</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/m/new/bike-search/?ridestyle=3">
                                        <span class="style-type">
                                            <span class="styletypesprite style-street"></span>
                                        </span>
                                        <span class="style-type-title">Street</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/m/new/bike-search/?ridestyle=1">
                                        <span class="style-type">
                                            <span class="styletypesprite style-cruiser"></span>
                                        </span>
                                        <span class="style-type-title">Cruiser</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/m/new/bike-search/?ridestyle=2">
                                        <span class="style-type">
                                            <span class="styletypesprite style-sports"></span>
                                        </span>
                                        <span class="style-type-title">Sports</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </section>
    <section>
        <!--  Upcoming, New Launches and Top Selling code starts here -->
        <div class="container">
            <div class="grid-12 alpha omega">
                <h2 class="font18 text-center margin-top20 margin-bottom10">Featured bikes</h2>
                <div class="featured-bikes-panel content-box-shadow padding-bottom15">
                    <div class="bw-tabs-panel">
                        <div class="bw-tabs bw-tabs-flex">
                            <ul>
                                @if (IsPopularBikesDataAvailable)
                                {
                                    <li class="active" data-tabs="mctrlMostPopularBikes">Most Popular</li>
                                }
                                @if (IsNewLaunchedDataAvailable)
                                {
                                    <li data-tabs="mctrlNewLaunchedBikes">New launches</li>
                                }
                                @if (IsUpcomingBikeAvailable)
                                {
                                    <li data-tabs="mctrlUpcomingBikes">Upcoming </li>
                                }
                            </ul>
                        </div>
                        <div class="grid-12 alpha omega">
                            @if (IsPopularBikesDataAvailable)
                            {
                                <div class="bw-tabs-data features-bikes-container" id="mctrlMostPopularBikes">
                                    <div class="swiper-container card-container">
                                        <div class="swiper-wrapper discover-bike-carousel">
                                            @Html.Partial("~/Views/BikeModels/_MostPopularBikes_Mobile.cshtml", Model.PopularBikes)
                                        </div>
                                    </div>
                                    <div class="padding-left10 view-all-btn-container margin-top10">
                                        <a href="/m/best-bikes-in-india/" title="Popular Bikes in India" class="btn view-all-target-btn">View all bikes<span class="bwmsprite teal-right"></span></a>
                                    </div>
                                </div>
                            }
                            @if (IsNewLaunchedDataAvailable)
                            {
                                <div class="bw-tabs-data hide features-bikes-container" id="mctrlNewLaunchedBikes">
                                    <div class="swiper-container card-container">
                                        <div class="swiper-wrapper discover-bike-carousel">
                                            @Html.Partial("~/Views/NewLaunches/_NewLaunches_Mobile.cshtml", Model.NewLaunchedBikes)
                                        </div>
                                    </div>
                                    <div class="padding-left10 view-all-btn-container margin-top10">
                                        <a href="/m/new-bike-launches/" title="New Bike Launches in India" class="btn view-all-target-btn">View all launches<span class="bwmsprite teal-right"></span></a>
                                    </div>
                                </div>
                            }
                            @if (IsUpcomingBikeAvailable)
                            {
                                <div class="bw-tabs-data hide features-bikes-container" id="mctrlUpcomingBikes">
                                    <div class="swiper-container card-container">
                                        <div class="swiper-wrapper discover-bike-carousel">
                                            @Html.Partial("~/Views/Upcoming/_UpcomingBikes_Mobile.cshtml", Model.UpcomingBikes)
                                        </div>
                                    </div>
                                    <div class="padding-left10 view-all-btn-container margin-top10">
                                        <a href="/m/upcoming-bikes/" title="Upcoming Bikes in India" class="btn view-all-target-btn">View all bikes<span class="bwmsprite teal-right"></span></a>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <div class="clear"></div>
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </section>
    <section class="lazy home-getFinalPrice-banner" data-original="https://imgd3.aeplcdn.com/0x0/bw/static/landing-banners/m/onroad-price-banner.jpg">
        <div class="container" id="OnRoadContent">
            <div class="grid-12">
                <h2 class="font18 margin-top20 margin-bottom20 text-white text-center">On road price</h2>

                <!-- On road pricequote control-->
                <div class="form-control-box margin-bottom20">
                    <input value="" class="form-control rounded-corner2 ui-autocomplete-input" type="text" placeholder="Search Make and Model" id="getFinalPrice" />
                    <span style="display: none;" class="fa fa-spinner fa-spin position-abt pos-right10 pos-top15 text-black hide"></span>
                    <span class="bwmsprite error-icon hide"></span>
                    <div class="bw-blackbg-tooltip hide">Please enter make/model name</div>
                </div>
                <div class="form-control-box margin-bottom20 finalPriceCitySelect ">
                    <select data-placeholder="--Select City--" class="form-control" id="ddlCitiesOnRoad" tabindex="2" data-bind="options: bookingCities, value: selectedCity, optionsText: 'cityName', optionsValue: 'cityId', optionsCaption: '--Select City--', chosen: { width: '100%' }, event: { change: cityChangedOnRoad }"></select>
                    <span class="bwmsprite error-icon hide"></span>
                    <div class="bw-blackbg-tooltip hide">Please Select City</div>
                </div>
                <div class="form-control-box margin-bottom20 finalPriceAreaSelect " data-bind="visible: bookingAreas().length > 0">
                    <select data-placeholder="--Select Area--" class="form-control" id="ddlAreaOnRoad" data-bind="options: bookingAreas, value: selectedArea, optionsText: 'areaName', optionsValue: 'areaId', optionsCaption: '--Select Area--', chosen: { width: '100%' }"></select>
                    <span class="bwsprite error-icon hide"></span>
                    <div class="bw-blackbg-tooltip hide">Please Select Area</div>
                </div>
                <button id="btnDealerPriceOnRoad" class="btn btn-orange btn-full-width margin-bottom30" type="button" value="Check On-Road Price" data-bind="event: { click: getPriceQuoteOnRoad }">Check on-road price</button>
                <!-- Onroad price quote ends here-->

                <p class="text-white text-center padding-left30 padding-right30">Its private, no need to share your number and email</p>
            </div>
        </div>
        <div class="clear"></div>
    </section>
    <section>
        @{Html.RenderPartial("/Views/Shared/Ads/Mobile/Ad320x150_Second.cshtml", new { AdId = Model.AdTags.AdId });}
    </section>
    @if (Model.CompareBikes != null)
    {
        <section>
            @Html.Partial("~/Views/BestBikes/_BestBikes_Mobile.cshtml", Model.BestBikes)
        </section>
    }

    <section>
        <!--  Compare section code starts here -->
        @Html.Partial("~/Views/CompareBikes/_ComparisonMin_Mobile.cshtml", Model.CompareBikes)
    </section>

    <section>
        <div class="container">
            <h2 class="font18 text-center margin-top20 margin-bottom10">Find used bikes</h2>
            <div class="bw-tabs-panel content-box-shadow">
                <div class="bw-tabs bw-tabs-flex tabs-bottom15">
                    <ul>
                        @if (IsUsedModelsAvailable)
                        {
                            <li class="active" data-tabs="usedByModel">Model</li>
                        }
                        @if (IsUsedBikeCitiesAvailable)
                        {
                            <li data-tabs="usedByCity">City</li>
                        }
                        <li data-tabs="usedByBudget">Budget</li>
                    </ul>
                </div>
                @if (IsUsedModelsAvailable)
                {
                    <div class="bw-tabs-data" id="usedByModel">
                        @Html.Partial("~/Views/Used/_UsedBikesByModel_Mobile.cshtml", Model.UsedModels)
                    </div>
                }
                @if (IsUsedBikeCitiesAvailable)
                {
                    <div id="usedByCity" class="bw-tabs-data hide">
                        @Html.Partial("~/Views/UsedBikes/_usedBikesCities_Mobile.cshtml", Model.UsedBikeCities)
                    </div>
                }
                <div id="usedByBudget" class="bw-tabs-data hide">
                    <ul class="elevated-card-list padding-top5">
                        <li>
                            <a href="/m/used/bikes-in-india/#budget=0+35000" rel="nofollow">
                                <div class="table-middle">
                                    <div class="tab-icon-container">
                                        <span class="bwmsprite budget-one"></span>
                                    </div>
                                    <span class="key-size-14">Upto</span><br />
                                    <span class="bwmsprite inr-xsm-icon"></span><span class="value-size-15">35K</span>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="/m/used/bikes-in-india/#budget=35000+80000" rel="nofollow">
                                <div class="table-middle">
                                    <div class="tab-icon-container">
                                        <span class="bwmsprite budget-two"></span>
                                    </div>
                                    <span class="key-size-14">Between</span><br />
                                    <span class="bwmsprite inr-xsm-icon"></span><span class="value-size-15">35K -</span>
                                    <span class="bwmsprite inr-xsm-icon"></span><span class="value-size-15">80K</span>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="/m/used/bikes-in-india/#budget=80000+200000" rel="nofollow">
                                <div class="table-middle">
                                    <div class="tab-icon-container">
                                        <span class="bwmsprite budget-three"></span>
                                    </div>
                                    <span class="key-size-14">Above</span><br />
                                    <span class="bwmsprite inr-xsm-icon"></span><span class="value-size-15">80K</span>
                                </div>
                            </a>
                        </li>
                    </ul>
                    <div class="padding-left10 view-all-btn-container margin-top15 padding-bottom20">
                        <a href="/m/used/bikes-in-@Model.LocationMasking/" title="Second Hand Bikes in @Model.Location" class="btn view-all-target-btn">View all used bikes<span class="bwmsprite teal-right"></span></a>
                    </div>
                </div>
            </div>

        </div>
    </section>
    @if (reviewTabsCnt > 0)
    {
        <section class="container">
            <!--  News, reviews and videos code starts here -->
            <div class="container">
                <div class="grid-12 alpha omega margin-bottom20">
                    <h2 class="font18 text-center margin-top20 margin-bottom10">Latest updates</h2>
                    <div class="content-box-shadow">
                        <div class="bw-tabs-panel article-control padding-bottom20">
                            <div class="bw-tabs">
                                <div class="@string.Format("text-center {0}", reviewTabsCnt > 2 ? string.Empty : reviewTabsCnt > 1 ? "margin-top30 margin-bottom30" : "margin-top10")">
                                    <div id="reviewCount" class="@string.Format("bw-tabs text-center {0}", reviewTabsCnt > 2 ? "bw-tabs-flex" : reviewTabsCnt > 1 ? "home-tabs" : "hide")">
                                        <ul>
                                            @if (Model.News.FetchedCount > 0)
                                            {
                                                <li data-tabs="ctrlNews" class="@string.Format("{0}", isNewsActive ? "active" : "hide")">News</li>
                                            }
                                            @if (Model.ExpertReviews.FetchedCount > 0)
                                            {
                                                <li data-tabs="ctrlExpertReviews" class="@string.Format("{0}", isExpertReviewActive ? "active" : "hide")">Expert Reviews</li>
                                            }
                                            @if (Model.Videos.FetchedCount > 0)
                                            {
                                                <li data-tabs="ctrlVideos" class="@string.Format("{0}", isVideoActive ? "active" : "hide")">Videos</li>
                                            }
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="bw-tabs-data margin-right20 margin-left20" id="ctrlNews">
                                @if (Model.News.FetchedCount > 0)
                                {
                                    @Html.Partial("~/Views/News/_RecentNews_Mobile.cshtml", Model.News)
                                }
                            </div>
                            <div class="bw-tabs-data hide margin-right20 margin-left20" id="ctrlExpertReviews">
                                @if (Model.ExpertReviews.FetchedCount > 0)
                                {
                                    @Html.Partial("~/Views/ExpertReviews/_RecentExpertReviews_Mobile.cshtml", Model.ExpertReviews)
                                }
                            </div>
                            <div class="bw-tabs-data hide margin-right20 margin-left20" id="ctrlVideos">
                                @if (Model.Videos.FetchedCount > 0)
                                {
                                    @Html.Partial("~/Views/Videos/_RecentVideos_Mobile.cshtml", Model.Videos)
                                }
                            </div>

                        </div>
                    </div>
                </div>
                <div class="clear"></div>
            </div>
        </section>
    }
    <script type="text/javascript">

        var selectedModel = 0, pageId, selectedMakeName = '', selectedCityName = '', gaLabel = '', selectedAreaName = '';
        var onRoadcity, onRoadArea, onRoadMakeModel, mname = "";
        var onCookieObj = {}, viewModelOnRoad;


        function RfindCityById(vm, id) {
            return ko.utils.arrayFirst(vm.bookingCities(), function (child) {
                return (child.cityId === id || child.id === id);
            });
        }


        function FillCitiesOnRoad(modelId) {
            $.ajax({
                type: "GET",
                url: "/api/PQCityList/?modelId=" + modelId,
                dataType: 'json',
                success: function (response) {
                    var cities = response.cities;
                    var citySelected = null;
                    if (cities) {
                        insertCitySeparator(cities);
                        checkCookies();
                        viewModelOnRoad.bookingCities(cities);
                        if (!isNaN(onCookieObj.PQCitySelectedId) && onCookieObj.PQCitySelectedId > 0 && viewModelOnRoad.bookingCities() && selectElementFromArray(viewModelOnRoad.bookingCities(), onCookieObj.PQCitySelectedId)) {
                            viewModelOnRoad.selectedCity(onCookieObj.PQCitySelectedId);
                            viewModelOnRoad.hasAreas(RfindCityById(viewModelOnRoad, onCookieObj.PQCitySelectedId).hasAreas);
                        }
                        onRoadcity.find("option[value='0']").prop('disabled', true);
                        onRoadcity.trigger('chosen:updated');
                        cityChangedOnRoad();
                    }
                    else {
                        viewModelOnRoad.bookingCities([]);
                    }
                }
            });
        }

        function cityChangedOnRoad() {
            if (viewModelOnRoad.selectedCity() != undefined) {
                viewModelOnRoad.hasAreas(RfindCityById(viewModelOnRoad, viewModelOnRoad.selectedCity()).hasAreas);
                if (viewModelOnRoad.hasAreas() != undefined && viewModelOnRoad.hasAreas()) {
                    $.ajax({
                        type: "GET",
                        url: "/api/PQAreaList/?modelId=" + selectedModel + "&cityId=" + viewModelOnRoad.selectedCity(),
                        dataType: 'json',
                        success: function (response) {
                            areas = response.areas;
                            if (areas.length) {
                                viewModelOnRoad.bookingAreas(areas);
                                if (!isNaN(onCookieObj.PQAreaSelectedId) && onCookieObj.PQAreaSelectedId > 0 && onCookieObj.PQAreaSelectedId != 0 && selectElementFromArray(areas, onCookieObj.PQAreaSelectedId)) {
                                    viewModelOnRoad.selectedArea(onCookieObj.PQAreaSelectedId);
                                }
                            }
                            else {
                                viewModelOnRoad.selectedArea(0);
                                viewModelOnRoad.bookingAreas([]);
                            }
                        }
                    });
                }
                else {
                    viewModelOnRoad.selectedArea(0);
                    viewModelOnRoad.bookingAreas([]);
                }
            } else {
                viewModelOnRoad.bookingAreas([]);
            }
        }


        function isValidInfoOnRoad() {
            isValid = true;
            var errMsg = "Missing fields:";
            showHideMatchError(onRoadMakeModel, false);
            showHideMatchError(onRoadcity, false);
            showHideMatchError(onRoadArea, false);
            mname = onRoadMakeModel.val();

            if (selectedModel <= 0 || (mname == "" || mname.length < 2 || mname == "Search Make and Model")) {
                showHideMatchError(onRoadMakeModel, true);
                errMsg += "Make/Model,";
                isValid = false;
            }

            if (viewModelOnRoad.selectedCity() == undefined) {
                showHideMatchError(onRoadcity, true);
                errMsg += "City,";
                isValid = false;
            }

            if (viewModelOnRoad.bookingAreas().length > 0 && viewModelOnRoad.selectedArea() == undefined) {
                showHideMatchError(onRoadArea, true);
                errMsg += "Area,";
                isValid = false;
            }

            if (!isValid) {
                errMsg = errMsg.substring(0, errMsg.length - 1);
                gtmCodeAppender(pageId, "Error in submission", errMsg);
            }

            return isValid;
        }

        function getPriceQuoteOnRoad() {
            var cityId = viewModelOnRoad.selectedCity(), areaId = viewModelOnRoad.selectedArea() ? viewModelOnRoad.selectedArea() : 0;
            if (isValidInfoOnRoad()) {
                //set global cookie
                if (cityId != onCookieObj.PQCitySelectedId || areaId > 0)
                    setLocationCookie($('#ddlCitiesOnRoad option:selected'), $('#ddlAreaOnRoad option:selected'));

                var obj = {
                    'CityId': viewModelOnRoad.selectedCity(),
                    'AreaId': viewModelOnRoad.selectedArea(),
                    'ModelId': selectedModel,
                    'ClientIP': '<%= ClientIP %>',
                    'SourceType': '2',
                    'VersionId': 0,
                    'pQLeadId': '<%= PQSourceId%>',
                    'deviceId': getCookie('BWC')
                };

                $.ajax({
                    type: 'POST',
                    url: "/api/PriceQuote/",
                    data: obj,
                    dataType: 'json',
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader('utma', getCookie('__utma'));
                        xhr.setRequestHeader('utmz', getCookie('_bwutmz'));
                    },
                    success: function (json) {
                        var jsonObj = json;

                        selectedCityName = $("#ddlCitiesOnRoad option:selected").text();

                        if (areaId > 0)
                            selectedAreaName = $("#ddlAreaOnRoad option:selected").text();

                        if (selectedMakeName != "" && selectedCityName != "") {
                            gaLabel = selectedMakeName + ',' + selectedCityName;

                            if (selectedAreaName != '')
                                gaLabel += ',' + selectedAreaName;
                        }

                        cookieValue = "CityId=" + viewModelOnRoad.selectedCity() + "&AreaId=" + (!isNaN(viewModelOnRoad.selectedArea()) ? viewModelOnRoad.selectedArea() : 0) + "&PQId=" + jsonObj.quoteId + "&VersionId=" + jsonObj.versionId + "&DealerId=" + jsonObj.dealerId;
                        //SetCookie("_MPQ", cookieValue);

                        if (jsonObj != undefined && jsonObj.quoteId > 0) {
                            gtmCodeAppender(pageId, 'Dealer_PriceQuote_Success_Submit', gaLabel);
                            window.location = "/m/pricequote/dealer/?MPQ=" + Base64.encode(cookieValue);
                        }
                        else {
                            gtmCodeAppender(pageId, 'BW_PriceQuote_Error_Submit', gaLabel);
                            $("#errMsgOnRoad").text("Oops. We do not seem to have pricing for given details.").show();
                        }
                    },
                    error: function (e) {
                        gtmCodeAppender(pageId, 'BW_PriceQuote_Error_Submit', gaLabel);
                        $("#errMsg").text("Oops. Some error occured. Please try again.").show();
                    }
                });
            } else {
                gtmCodeAppender(pageId, 'BW_PriceQuote_Error_Submit', gaLabel);
                $("#errMsgOnRoad").text("Please select all the details").show();
            }
        }

        function gtmCodeAppender(pageId, action, label) {
            var categoty = '';
            if (pageId != null) {
                switch (pageId) {
                    case "1":
                        category = 'Make_Page';
                        break;
                    case "2":
                        category = "CheckPQ_Series";
                        action = "CheckPQ_Series_" + action;
                        break;
                    case "3":
                        category = "Model_Page";
                        action = "CheckPQ_Model_" + action;
                        break;
                    case '4':
                        category = 'New_Bikes_Page';
                        break;
                    case '5':
                        category = 'HP';
                        break;
                }
                if (label) {
                    dataLayer.push({ 'event': 'Bikewale_all', 'cat': category, 'act': action, 'lab': label });
                }
                else {
                    dataLayer.push({ 'event': 'Bikewale_all', 'cat': category, 'act': action });
                }
            }

        }

        function checkCookies() {
            c = document.cookie.split('; ');
            for (i = c.length - 1; i >= 0; i--) {
                C = c[i].split('=');
                if (C[0] == "location") {
                    var cData = (String(C[1])).split('_');
                    onCookieObj.PQCitySelectedId = parseInt(cData[0]) || 0;
                    onCookieObj.PQCitySelectedName = cData[1] ? cData[1].replace(/-/g, ' ') : "";
                    onCookieObj.PQAreaSelectedId = parseInt(cData[2]) || 0;
                    onCookieObj.PQAreaSelectedName = cData[3] ? cData[3].replace(/-/g, ' ') : "";

                }
            }
        }

        docReady(function () {

            onRoadcity = $('#ddlCitiesOnRoad'), onRoadArea = $('#ddlAreaOnRoad'), onRoadMakeModel = $('#getFinalPrice');

            // knockout OnRoadData binding
            viewModelOnRoad = {
                selectedCity: ko.observable(),
                bookingCities: ko.observableArray([]),
                selectedArea: ko.observable(),
                bookingAreas: ko.observableArray([]),
                hasAreas: ko.observable()
            };

            //for jquery chosen
            ko.bindingHandlers.chosen = {
                init: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
                    var $element = $(element);
                    var options = ko.unwrap(valueAccessor());
                    if (typeof options === 'object')
                        $element.chosen(options);

                    ['options', 'selectedOptions', 'value'].forEach(function (propName) {
                        if (allBindings.has(propName)) {
                            var prop = allBindings.get(propName);
                            if (ko.isObservable(prop)) {
                                prop.subscribe(function () {
                                    $element.trigger('chosen:updated');
                                });
                            }
                        }
                    });
                }
            };

            // Chosen touch support.
            if ($('.chosen-container').length > 0) {
                $('.chosen-container').on('touchstart', function (e) {
                    e.stopPropagation(); e.preventDefault();
                    // Trigger the mousedown event.
                    $(this).trigger('mousedown');
                });
            }

            $.fn.hint = bwHint;
            $.fn.bw_autocomplete = bwAutoComplete;

            $("#getFinalPrice").bw_autocomplete({

                source: 2,
                recordCount: 5,
                onClear: function () {
                    objBikes = new Object();
                },
                click: function (event, ui, orgTxt) {
                    var model = null;
                    if (ui.item.payload.modelId > 0) {
                        model = new Object();
                        model.maskingName = ui.item.payload.modelMaskingName;
                        model.id = ui.item.payload.modelId;
                        pageId = '<%= PageId %>';
                        selectedModel = model.id;
                        selectedMakeName = ui.item.label;
                        FillCitiesOnRoad(selectedModel);
                        gtmCodeAppender(pageId, "Get_On_Road_Price_Click", selectedMakeName);
                    }
                },
                open: function (result) {
                    objBikes.result = result;
                    if (navigator.userAgent.match(/(iPod|iPhone|iPad)/)) {

                        $('.ui-autocomplete').off('menufocus hover mouseover');
                    }
                },
                focusout: function () {
                    if ($('li.ui-state-focus a:visible').text() != "") {
                        focusedMakeModel = new Object();
                        focusedMakeModel = objBikes.result[$('li.ui-state-focus').index()];
                    }
                },
                afterfetch: function (result, searchtext) {
                    return false;
                }
            });

            ko.applyBindings(viewModelOnRoad, $("#OnRoadContent")[0]);

        });
    </script>

</body>