@model Carwale.UI.ViewModels.Used.SellCar.VoucherViewModel
@using Carwale.Utility;
<div class="voucher-screen">
	<span class="congratulation-icon"></span>
	<div class="voucher-body">
		<p id="congratulations" class="voucher__title">Congratulations</p>
		<p class="voucher__subtitle">Your Ad is live.</p>
		@if (Model.IsC2bCity && Model.BuyingIndexPrice > 0)
        {
		    <p class="voucher__subtitle margin-top20">We can help you sell car your car right now at</p>
		    <p class="voucher__amount">&#x20b9;&nbsp;<span class="font-bold" id="buyerindexprice" data-buyerindexprice="@Model.BuyingIndexPrice">@Format.FormatNumericCommaSep(Model.BuyingIndexPrice.ToString())</span></p>
		    <input type="button" value="Help me sell my car" class="btn btn-white voucher-btn" id="helpsellcar">
		    <div id="thankyoutext" class="font14 margin-bottom20 hide">Thank You, We will call you from @Model.VoucherHelplineNumber</div>
		    <div id="thankyouLoading" class="font14 margin-bottom20 hide">Processing...</div>
        }
		<!-- add conditional margin-top30 class in voucher-btn for non C2bCity -->
		<a href="@string.Format("/used/cardetails.aspx?car=s{0}", @Model.InquiryId)" id="voucherViewAd" class="btn btn-orange voucher-btn">View your ad</a>
        @if (Model.IsC2bCity && Model.BuyingIndexPrice > 0)
        {
		    <p class="voucher__disclaimer">*Offer price is subject to the car's condition.</p>
        }
	</div>
</div>
<script>
    if ($("#helpsellcar").length > 0) {
        sellCarTracking.forDesktop("voucherShown");
    }
    $('#helpsellcar').on('click', function (e) {
        e.preventDefault();
        sellCarTracking.forDesktop("voucherClicked");
        $('#helpsellcar').hide();
        $('#thankyouLoading').show();
        var biPrice = $('#buyerindexprice').data('buyerindexprice');
        var settings = {
            url: '/api/selllead/',
            type: "POST",
            data: '=' + biPrice
        }
        $.ajax(settings).done(function () {
            $('#thankyouLoading').hide();
            $('#thankyoutext').show();
        }).fail(function () {
            $('#helpsellcar').show();
            $('#thankyouLoading').hide();
        });
        
    });
    $('#voucherViewAd').on('click', function () {
        sellCarTracking.forDesktop("viewAd");
    });
    window.removeEventListener("beforeunload", parentContainer.onPageUnload);
</script>