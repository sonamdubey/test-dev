@using Carwale.Entity.CarData;
@using Carwale.Entity.Dealers;
@using MobileWeb.Common;
@model Tuple<CarModelDetails, SponsoredDealer>

    <noscript id="newcar_lead_popup">
        <script type="text/html" src="/static/m/ui/newCarLeadPopup.html">
        </script>
    </noscript>
    <script>
        @if (Model.Item1 != null)
        {
            <text>
            var CarDetails =
            {

                carMakeId : @Model.Item1.MakeId,
                carMakeName : "@Model.Item1.MakeName" ,
                carMaskingName : "@Model.Item1.MaskingName",
                carModelName : "@Model.Item1.ModelName",
                carModelId : @Model.Item1.ModelId
            };
            </text>
            if (Model.Item2 != null)
            {
                <text>
                sponsorDlrBusType = "@Model.Item2.DealerLeadBusinessType";
                sponsorDlrName = "@Model.Item2.DealerName";
                campaignId = "@Model.Item2.DealerId";
                sponsorDlrLeadPanel = "@Model.Item2.LeadPanel";
                showEmail ="@Model.Item2.ShowEmail".toLowerCase() === 'true';
                sponsoredDealerId = "@Model.Item2.ActualDealerId";
                sponsoredDlrMutualLeads = "@Model.Item2.MutualLeads".toLowerCase() === 'true';
                dealerAdminId = "@(Model.Item2.DealerAdminId)";  // Identifies dealers group id
                </text>
            }

            var userCityId = CookiesCustomers.MasterCityId;
        }

        var nonRecommendationsCampaignIds = '@(System.Configuration.ConfigurationManager.AppSettings["nonRecommendationsCampaignIds"] ?? String.Empty)'.split(",");
        var LeadFormFlowCitiesArray = '@(System.Configuration.ConfigurationManager.AppSettings["multiLeadAssignmentABTestCities"] ?? String.Empty)'.split(",");
        document.addEventListener('DOMContentLoaded', function () {
            var leadpopup_src = $($("#newcar_lead_popup").text()).attr("src");
            window.popup_promise = window.popup_promise || $.Deferred();
            $.get(leadpopup_src).done(
                        function (response) {
                            $("body").append(response);
                            window.popup_promise.resolve();
                        });
        });

        function saveDealerCookie(campaignId, cityId, zoneId, modelId) {
            if (cityId == null) cityId = -1;
            var dealerDetail = $.cookie("_dealerCityModel");
            if (dealerDetail == null || dealerDetail == undefined)
                $.cookie("_dealerCityModel", campaignId + "~" + cityId + "~" + modelId + "~" + zoneId + "!", { path: '/' });
            else {
                var temp = dealerDetail.split('!');
                var len = temp.length;
                var flag = 0;
                for (var i = 0 ; i < len - 1 ; i++) {
                    var curr = temp[i].split('~');
                    var existingcity = curr[1];
                    var existingmodel = curr[2];
                    var existingzone = curr[3];
                    if (existingcity == cityId && existingmodel == modelId && existingzone == zoneId) {
                        dealerDetail = dealerDetail.replace(curr[0], campaignId); // string replace without knowing position
                        $.cookie("_dealerCityModel", dealerDetail, { path: '/' });
                        break;
                    } flag++;
                }
                if (flag == (len - 1))
                    $.cookie("_dealerCityModel", dealerDetail + campaignId + "~" + cityId + "~" + modelId + "~" + zoneId + "!", { path: '/' });
            }
        }
    </script>
    <script type="text/javascript" src="/static/m/js/lead-form.js" defer></script>
    <script type="text/javascript" src="/static/m/js/form-misc.js" defer></script>
    <script type="text/javascript" src="/static/js/location-plugin.js" defer></script>

