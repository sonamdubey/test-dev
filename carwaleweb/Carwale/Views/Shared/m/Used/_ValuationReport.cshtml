@model Carwale.Entity.Classified.CarValuation.ValuationReport

@using Carwale.BL.Stock;
@using Carwale.Utility;
@using System.Globalization;
@using Carwale.BL.Classified.CarValuation;
@{
    Layout = null;
}

@if (Model != null)
{
    <link rel="stylesheet" href="/static/m/css/car-valuation.css" type="text/css">
    <link rel="stylesheet" href="/static/m/css/cwm-common-style.css" type="text/css">
    <link rel="stylesheet" href="/static/cwfontawesome/cw-font-awesome.css" type="text/css">
    
    <div class="content-inner-block-10 content-box-shadow">
        <h1 class="pgsubhead margin-bottom5 font16">@Model.Make @Model.Model @Model.Version</h1>
        <p class="margin-bottom5 @(!string.IsNullOrWhiteSpace(Model.DealerRatingText)?"inline-block":"")">
            <span class="margin-right5">@Model.Fuel</span><span class="text-dark-grey">|</span>
            <span class="margin-left5 margin-right5">@Model.Year</span><span class="text-dark-grey">|</span>
            <span class="margin-left5">@Model.City</span>
            <span class="valuationEdit hide"><a href="javascript:history.back()">Edit Details</a></span>
            <span class="clear"></span>
        </p>
        @if (!string.IsNullOrWhiteSpace(Model.DealerRatingText))
        { 
            <span class="top-rated-seller-tag margin-top0 font12 margin-left20 float-right">@Model.DealerRatingText</span>
            <div class="seller-rating__toast">
                <span class="seller-rating-toast__close"></span>
                <p>This seller has consistently been rated well by his customers</p>
            </div>
        }
    </div>

    if (Model.Valuation != null)
    {
        var valuation = Model.Valuation;
        <div class="right-price-box" caseid=@Model.Valuation.Case>
            @if ((valuation.FairPrice <= 0 || valuation.GoodPrice <= 0) && (valuation.Valuations == null || valuation.Valuations.Count <= 0))
            {
                <div class="right-price-not-available">
                    <div class="cwmsprite not-avlbl-icon"> </div>
                    <div class="not-avlbl-text">Right Price is not available</div>
                </div>
            }

            @if (!String.IsNullOrEmpty(valuation.WarningNote))
            {
                <p class="font13 margin-top10 text-left padding-left10 padding-right10">@valuation.WarningNote</p>
            }

            @if (!String.IsNullOrEmpty(valuation.AvailableInfoNote))
            {
                <p class="font13 margin-top10 text-left padding-left10 padding-right10" style="font-weight: 700">@valuation.AvailableInfoNote</p>
            }

            @if (valuation.FairPrice > 0 && valuation.GoodPrice > 0)
            {
                <div class="right-price-title margin-top25">Right Price Guide</div>
                <div class="horizontal-bar @(Model.SellerAskingPrice != null ? "margin-bottom50" : "margin-bottom20")">
                    @if (Model.SellerAskingPrice != null)
                    {
                        <div class="bar-pointer fair-price" style="left:@ValuationBL.GetIndicatorPosition(valuation.FairPrice, valuation.GoodPrice, Model.SellerAskingPrice.Value)%">
                            <div class="fair-mark"></div>
                            <div class="pointer-text">Asking Price</div>
                            <div class="price-pos">@Format.FormatFullPrice(Model.SellerAskingPrice.ToString(), true)</div>
                        </div>
                    }
                    <div class="bar-pointer fair-pointer">
                        <div>Fair Condition</div>
                        <div class="price-pos">@Format.FormatFullPrice(valuation.FairPrice.ToString(), true)</div>
                        <div class="border-mark"></div>
                    </div>
                    <div class="bar-pointer good-pointer">
                        <div>Good Condition</div>
                        <div class="price-pos">@Format.FormatFullPrice(valuation.GoodPrice.ToString(), true)</div>
                        <div class="border-mark"></div>
                    </div>
                </div>
            }

            @if (valuation.Valuations != null && valuation.Valuations.Count > 0)
            {
                bool isYearAvailable = valuation.Valuations.Exists(v => v.Year != null);
                bool isVersionAvailable = valuation.Valuations.Exists(v => v.Version != null);
                <div class="table-container margin-top10">
                    <table>
                        <tr>
                            @if (isYearAvailable)
                            {
                                <th>Year</th>
                            }
                            @if (isVersionAvailable)
                            {
                                <th>Version</th>
                            }
                            <th>Fair Car Condition</th>
                            <th>Good Car Condition</th>
                        </tr>
                        @foreach (var val in valuation.Valuations)
                        {
                            <tr>
                                @if (isYearAvailable)
                                {
                                    <td>@val.Year</td>
                                }
                                @if (isVersionAvailable)
                                {
                                    <td>@val.Version</td>
                                }
                                <td>@String.Format(new CultureInfo("EN-in"), "{0:c0}", val.FairPrice)</td>
                                <td>@String.Format(new CultureInfo("EN-in"), "{0:c0}", val.GoodPrice)</td>
                            </tr>
                        }
                    </table>
                </div>
            }

            @if (!String.IsNullOrEmpty(valuation.Disclaimer))
            {
                <p class="font13 margin-top15 text-left padding-left10 padding-right10"><span style="font-weight: 700">Note : </span>@valuation.Disclaimer</p>
            }
        </div>
    }
    else
    {
        <div style="padding: 10px;" class="error">Something went wrong. Please try again later.</div>
    }

    if (Model.SellerAskingPrice != null && Model.SellerAskingPrice > 0)
    {
        <div id="valuation-seller-details">
            @{Html.RenderPartial("~/Views/Shared/m/Used/_SellerDetailsBtn.cshtml");}
        </div>
    }
}
else
{
    <div style="padding: 10px;" class="error">Something went wrong. Please try again later.</div>
}
