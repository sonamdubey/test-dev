ß
0D:\work\bikewaleweb\Bikewale.ImageIPC\Program.cs
	namespace 	
Bikewale
 
. 
ImageIPC 
{ 
class 	
Program
 
{		 
static

 
void

 
Main

 
(

 
string

 
[

  
]

  !
args

" &
)

& '
{ 	!
RabbitMqImageConsumer !!
rabbitMqImageConsumer" 7
=8 9
new: =!
RabbitMqImageConsumer> S
(S T
)T U
;U V
Random 
random 
= 
new 
Random  &
(& '
)' (
;( )
string 
hostName 
= 
( 
(  
List  $
<$ %
string% +
>+ ,
), -
CreateConnection- =
.= >
nodes> C
)C D
[D E
randomE K
.K L
NextL P
(P Q
(Q R
(R S
ListS W
<W X
stringX ^
>^ _
)_ `
CreateConnection` p
.p q
nodesq v
)v w
.w x
Countx }
)} ~
]~ 
;	 €!
rabbitMqImageConsumer !
.! "
RabbitMQExecution" 3
(3 4
$str4 ?
+@ A 
ConfigurationManagerB V
.V W
AppSettingsW b
[b c
$strc n
]n o
.o p
ToUpperp w
(w x
)x y
+z {
$str	| „
,
„ …
hostName
† 
)
 
;
 
} 	
} 
} ë
@D:\work\bikewaleweb\Bikewale.ImageIPC\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str +
)+ ,
], -
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str -
)- .
]. /
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *Í‚
>D:\work\bikewaleweb\Bikewale.ImageIPC\RabbitMqImageConsumer.cs
	namespace 	
Bikewale
 
. 
ImageIPC 
{ 
internal 
class !
RabbitMqImageConsumer (
{ 
internal 
void 
RabbitMQExecution '
(' (
string( .
	queueName/ 8
,8 9
string: @
hostNameA I
)I J
{ 	
CreateConnection 
. 
Connect $
($ %
	queueName% .
,. /
hostName0 8
)8 9
;9 :
IConnection 
iconnection #
=$ %
(& '
IConnection' 2
)2 3
CreateConnection3 C
.C D

ConnectionD N
;N O
SendMail 
. 
APPLICATION  
=! "
$str# 6
;6 7
	queueName 
=  
ConfigurationManager ,
., -
AppSettings- 8
[8 9
$str9 D
]D E
.E F
ToUpperF M
(M N
)N O
;O P
if 
( 
iconnection 
== 
null #
)# $
return 
; 
CreateConnection 
. 
CreateChannel *
(* +
)+ ,
;, -
IModel 
imodel 
= 
( 
IModel #
)# $
CreateConnection$ 4
.4 5
Model5 :
;: ;!
QueueingBasicConsumer   !
consumer  " *
=  + ,
CreateConnection  - =
.  = >
CreateConsumer  > L
(  L M
)  M N
;  N O
consumer!! 
.!! 
ConsumerCancelled!! &
+=!!' )&
consumer_ConsumerCancelled!!* D
;!!D E
while"" 
("" 
true"" 
)"" 
{## 
Logs$$ 
.$$ 
WriteInfoLog$$ !
($$! "
$str$$" G
)$$G H
;$$H I
try%% 
{&& !
BasicDeliverEventArgs'' )
deliverEventArgs''* :
=''; <
consumer''= E
.''E F
Queue''F K
.''K L
Dequeue''L S
(''S T
)''T U
;''U V
NameValueCollection(( '
nvc((( +
=((, -
this((. 2
.((2 3
ByteArrayToObject((3 D
(((D E
deliverEventArgs((E U
.((U V
Body((V Z
)((Z [
;(([ \
try)) 
{** 
Logs++ 
.++ 
WriteInfoLog++ )
(++) *
$str++* N
+++O P
nvc++Q T
[++T U
$str++U Y
]++Y Z
+++[ \
$str++] b
+++c d
nvc++e h
[++h i
$str++i s
]++s t
+++u v
$str++w |
+++} ~
nvc	++ ‚
[
++‚ ƒ
$str
++ƒ 
]
++ 
+
++ 
$str
++‘ ¦
+
++§ ¨
nvc
++© ¬
[
++¬ ­
$str
++­ º
]
++º »
+
++¼ ½
$str
++¾ È
+
++É Ê
nvc
++Ë Î
[
++Î Ï
$str
++Ï ×
]
++× Ø
+
++Ù Ú
$str
++Û î
+
++ï ğ
nvc
++ñ ô
[
++ô õ
$str
++õ †
]
++† ‡
+
++ˆ ‰
$str
++Š 
+
++Ÿ  
nvc
++¡ ¤
[
++¤ ¥
$str
++¥ ·
]
++· ¸
+
++¹ º
$str
++» Ë
+
++Ì Í
nvc
++Î Ñ
[
++Ñ Ò
$str
++Ò à
]
++à á
)
++á â
;
++â ã
MemoryStream,, $
ms,,% '
=,,( )
this,,* .
.,,. /%
ImageMemoryStreamFromByte,,/ H
(,,H I
nvc,,I L
[,,L M
$str,,M W
],,W X
),,X Y
;,,Y Z
if-- 
(-- 
nvc-- 
[--  
$str--  $
]--$ %
==--& (
null--) -
||--. 0
ms--1 3
==--4 6
null--7 ;
)--; <
{.. 
Logs//  
.//  !
WriteInfoLog//! -
(//- .
$str//. `
)//` a
;//a b
imodel00 "
.00" #
BasicReject00# .
(00. /
deliverEventArgs00/ ?
.00? @
DeliveryTag00@ K
,00K L
false00M R
)00R S
;00S T
}11 
else22 
if22 
(22  !
nvc22! $
[22$ %
$str22% 0
]220 1
==222 4
$str225 8
)228 9
{33 
imodel44 "
.44" #
BasicReject44# .
(44. /
deliverEventArgs44/ ?
.44? @
DeliveryTag44@ K
,44K L
false44M R
)44R S
;44S T
Logs55  
.55  !
WriteInfoLog55! -
(55- .
$str55. [
+55\ ]
nvc55^ a
[55a b
$str55b m
]55m n
)55n o
;55o p
}66 
else77 
{88 
Uri99 
uri99  #
=99$ %
new99& )
Uri99* -
(99- .
nvc99. 1
[991 2
$str992 <
]99< =
)99= >
;99> ?
string:: "
str1::# '
=::( )
string::* 0
.::0 1
Empty::1 6
;::6 7
string;; "
environment;;# .
=;;/ 0
string;;1 7
.;;7 8
Empty;;8 =
;;;= >
string<< "
targetImagePath<<# 2
;<<2 3
if== 
(==   
ConfigurationManager==  4
.==4 5
AppSettings==5 @
[==@ A
$str==A N
]==N O
.==O P
ToLower==P W
(==W X
)==X Y
.==Y Z
Equals==Z `
(==` a
$str==a m
)==m n
)==n o
{>> 
targetImagePath??  /
=??0 1
uri??2 5
.??5 6
	LocalPath??6 ?
.??? @
	Substring??@ I
(??I J
$num??J K
)??K L
.??L M
ToLower??M T
(??T U
)??U V
;??V W
}@@ 
elseAA  
{BB 
targetImagePathCC  /
=CC0 1 
ConfigurationManagerCC2 F
.CCF G
AppSettingsCCG R
[CCR S
$strCCS `
]CC` a
+CCb c
uriCCd g
.CCg h
	LocalPathCCh q
.CCq r
ToLowerCCr y
(CCy z
)CCz {
;CC{ |
environmentDD  +
=DD, -
$strDD. 1
+DD2 3 
ConfigurationManagerDD4 H
.DDH I
AppSettingsDDI T
[DDT U
$strDDU b
]DDb c
;DDc d
}EE 
LogsFF  
.FF  !
WriteInfoLogFF! -
(FF- .
targetImagePathFF. =
)FF= >
;FF> ?
ifGG 
(GG  
newGG  #

UploadToS3GG$ .
(GG. /
)GG/ 0
.GG0 1
CallS3ServiceGG1 >
(GG> ?
msGG? A
,GGA B
targetImagePathGGC R
)GGR S
)GGS T
{HH 
LogsII  $
.II$ %
WriteInfoLogII% 1
(II1 2
$strII2 L
+IIM N
targetImagePathIIO ^
+II_ `
$strIIa k
+IIl m
nvcIIn q
[IIq r
$strIIr v
]IIv w
+IIx y
$str	IIz 
)
II 
;
II ‘
ConsoleJJ  '
.JJ' (
	WriteLineJJ( 1
(JJ1 2
$strJJ2 L
+JJM N
targetImagePathJJO ^
+JJ_ `
$strJJa k
+JJl m
nvcJJn q
[JJq r
$strJJr v
]JJv w
+JJx y
$str	JJz 
)
JJ 
;
JJ ‘
msKK  "
.KK" #
DisposeKK# *
(KK* +
)KK+ ,
;KK, -
stringLL  &
str2LL' +
=LL, -
stringLL. 4
.LL4 5
EmptyLL5 :
;LL: ;
stringMM  &
qsforMasterImageMM' 7
=MM8 9
thisMM: >
.MM> ?"
CreateQSforMasterImageMM? U
(MMU V
nvcMMV Y
)MMY Z
;MMZ [
ifNN  "
(NN# $
thisNN$ (
.NN( )
CreateMasterImageNN) :
(NN: ;
targetImagePathNN; J
+NNK L
qsforMasterImageNNM ]
)NN] ^
)NN^ _
{OO  !
LogsPP$ (
.PP( )
WriteInfoLogPP) 5
(PP5 6
$strPP6 c
+PPd e
targetImagePathPPf u
+PPv w
$str	PPx ƒ
+
PP„ …
nvc
PP† ‰
[
PP‰ Š
$str
PPŠ 
]
PP 
)
PP 
;
PP ‘
ConsoleQQ$ +
.QQ+ ,
	WriteLineQQ, 5
(QQ5 6
$strQQ6 c
+QQd e
targetImagePathQQf u
+QQv w
$str	QQx ƒ
+
QQ„ …
nvc
QQ† ‰
[
QQ‰ Š
$str
QQŠ 
]
QQ 
)
QQ 
;
QQ ‘
ListRR$ (
<RR( )
stringRR) /
>RR/ 0
listRR1 5
=RR6 7
newRR8 ;
ListRR< @
<RR@ A
stringRRA G
>RRG H
(RRH I
(RRI J
IEnumerableRRJ U
<RRU V
stringRRV \
>RR\ ]
)RR] ^ 
ConfigurationManagerRR^ r
.RRr s
AppSettingsRRs ~
[RR~ 
$str	RR ‹
]
RR‹ Œ
.
RRŒ 
Split
RR ’
(
RR’ “
$char
RR“ –
)
RR– —
)
RR— ˜
;
RR˜ ™
RandomSS$ *
randomSS+ 1
=SS2 3
newSS4 7
RandomSS8 >
(SS> ?
)SS? @
;SS@ A
stringTT$ *
hostUrlTT+ 2
=TT3 4
listTT5 9
[TT9 :
randomTT: @
.TT@ A
NextTTA E
(TTE F
listTTF J
.TTJ K
CountTTK P
)TTP Q
]TTQ R
;TTR S
ifUU$ &
(UU' (
thisUU( ,
.UU, -&
UploadImageProcessCompleteUU- G
(UUG H
nvcUUH K
[UUK L
$strUUL P
]UUP Q
,UUQ R
hostUrlUUS Z
,UUZ [
stringUU\ b
.UUb c
EmptyUUc h
,UUh i
nvcUUj m
[UUm n
$strUUn x
]UUx y
,UUy z
environment	UU{ †
)
UU† ‡
)
UU‡ ˆ
{VV$ %
LogsWW( ,
.WW, -
WriteInfoLogWW- 9
(WW9 :
$strWW: a
+WWb c
targetImagePathWWd s
+WWt u
$str	WWv 
+
WW‚ ƒ
nvc
WW„ ‡
[
WW‡ ˆ
$str
WWˆ Œ
]
WWŒ 
+
WW 
$str
WW ¤
)
WW¤ ¥
;
WW¥ ¦
ConsoleXX( /
.XX/ 0
	WriteLineXX0 9
(XX9 :
$strXX: a
+XXb c
targetImagePathXXd s
+XXt u
$str	XXv 
+
XX‚ ƒ
nvc
XX„ ‡
[
XX‡ ˆ
$str
XXˆ Œ
]
XXŒ 
+
XX 
$str
XX ¤
)
XX¤ ¥
;
XX¥ ¦
LogsYY( ,
.YY, -
WriteInfoLogYY- 9
(YY9 :
$str	YY: Š
)
YYŠ ‹
;
YY‹ Œ
imodelZZ( .
.ZZ. /
BasicAckZZ/ 7
(ZZ7 8
deliverEventArgsZZ8 H
.ZZH I
DeliveryTagZZI T
,ZZT U
falseZZV [
)ZZ[ \
;ZZ\ ]
}[[$ %
else\\$ (
{]]$ %
Logs^^( ,
.^^, -
WriteErrorLog^^- :
(^^: ;
$str^^; q
+^^r s
targetImagePath	^^t ƒ
+
^^„ …
$str
^^† ‘
+
^^’ “
nvc
^^” —
[
^^— ˜
$str
^^˜ œ
]
^^œ 
)
^^ 
;
^^ Ÿ
this__( ,
.__, -
DeadLetterPublish__- >
(__> ?
nvc__? B
,__B C
	queueName__D M
)__M N
;__N O
imodel``( .
.``. /
BasicReject``/ :
(``: ;
deliverEventArgs``; K
.``K L
DeliveryTag``L W
,``W X
false``Y ^
)``^ _
;``_ `
Logsaa( ,
.aa, -
WriteInfoLogaa- 9
(aa9 :
$straa: l
+aam n
nvcaao r
[aar s
$straas ~
]aa~ 
)	aa €
;
aa€ 
}bb$ %
}cc  !
elsedd  $
{ee  !
Logsff$ (
.ff( )
WriteErrorLogff) 6
(ff6 7
$strff7 k
+ffl m
targetImagePathffn }
+ff~ 
$str
ff€ ‹
+
ffŒ 
nvc
ff ‘
[
ff‘ ’
$str
ff’ –
]
ff– —
)
ff— ˜
;
ff˜ ™
thisgg$ (
.gg( )
DeadLetterPublishgg) :
(gg: ;
nvcgg; >
,gg> ?
	queueNamegg@ I
)ggI J
;ggJ K
imodelhh$ *
.hh* +
BasicRejecthh+ 6
(hh6 7
deliverEventArgshh7 G
.hhG H
DeliveryTaghhH S
,hhS T
falsehhU Z
)hhZ [
;hh[ \
Logsii$ (
.ii( )
WriteInfoLogii) 5
(ii5 6
$strii6 h
+iii j
nvciik n
[iin o
$striio z
]iiz {
)ii{ |
;ii| }
}jj  !
}kk 
elsell  
{mm 
Logsnn  $
.nn$ %
WriteErrorLognn% 2
(nn2 3
$strnn3 M
+nnN O
targetImagePathnnP _
+nn` a
$strnnb m
+nnn o
nvcnnp s
[nns t
$strnnt x
]nnx y
+nnz {
$str	nn| •
)
nn• –
;
nn– —
thisoo  $
.oo$ %
DeadLetterPublishoo% 6
(oo6 7
nvcoo7 :
,oo: ;
	queueNameoo< E
)ooE F
;ooF G
imodelpp  &
.pp& '
BasicRejectpp' 2
(pp2 3
deliverEventArgspp3 C
.ppC D
DeliveryTagppD O
,ppO P
falseppQ V
)ppV W
;ppW X
Logsqq  $
.qq$ %
WriteInfoLogqq% 1
(qq1 2
$strqq2 d
+qqe f
nvcqqg j
[qqj k
$strqqk v
]qqv w
)qqw x
;qqx y
}rr 
}ss 
}tt 
catchuu 
(uu 
	Exceptionuu $
exuu% '
)uu' (
{vv 
Logsww 
.ww 
WriteErrorLogww *
(ww* +
$strww+ B
+wwC D
exwwE G
.wwG H
MessagewwH O
+wwP Q
EnvironmentwwR ]
.ww] ^
NewLineww^ e
+wwf g
$strwwh w
+wwx y
exwwz |
.ww| }

StackTrace	ww} ‡
)
ww‡ ˆ
;
wwˆ ‰
imodelxx 
.xx 
BasicRejectxx *
(xx* +
deliverEventArgsxx+ ;
.xx; <
DeliveryTagxx< G
,xxG H
falsexxI N
)xxN O
;xxO P
}yy 
}zz 
catch{{ 
({{ 
	Exception{{  
ex{{! #
){{# $
{|| 
Logs}} 
.}} 
WriteErrorLog}} &
(}}& '
$str}}' Q
+}}R S
ex}}T V
.}}V W
Message}}W ^
)}}^ _
;}}_ `
break~~ 
;~~ 
} 
}
€€ 
}
 	
private
ƒƒ 
string
ƒƒ $
CreateQSforMasterImage
ƒƒ -
(
ƒƒ- .!
NameValueCollection
ƒƒ. A
nvc
ƒƒB E
)
ƒƒE F
{
„„ 	
string
…… 
str1
…… 
=
…… 
string
……  
.
……  !
Empty
……! &
;
……& '
string
†† 
str2
†† 
=
†† 
string
††  
.
††  !
Empty
††! &
;
††& '
return
‡‡ 
(
‡‡ 
string
‡‡ 
.
‡‡ 
IsNullOrEmpty
‡‡ (
(
‡‡( )
nvc
‡‡) ,
[
‡‡, -
$str
‡‡- :
]
‡‡: ;
)
‡‡; <
?
‡‡= >
$str
‡‡? I
:
‡‡J K
$str
‡‡L R
+
‡‡S T
nvc
‡‡U X
[
‡‡X Y
$str
‡‡Y f
]
‡‡f g
)
‡‡g h
+
‡‡i j
(
‡‡k l
string
‡‡l r
.
‡‡r s
IsNullOrEmpty‡‡s €
(‡‡€ 
nvc‡‡ „
[‡‡„ …
$str‡‡… 
]‡‡ 
)‡‡ ‘
?‡‡’ “
$str‡‡” œ
:‡‡ 
$str‡‡Ÿ ¦
+‡‡§ ¨
nvc‡‡© ¬
[‡‡¬ ­
$str‡‡­ ·
]‡‡· ¸
)‡‡¸ ¹
;‡‡¹ º
}
ˆˆ 	
private
ŠŠ 
bool
ŠŠ 
CreateMasterImage
ŠŠ &
(
ŠŠ& '
string
ŠŠ' -
	imagePath
ŠŠ. 7
)
ŠŠ7 8
{
‹‹ 	
bool
ŒŒ 
flag
ŒŒ 
=
ŒŒ 
false
ŒŒ 
;
ŒŒ 
try
 
{
 
WebResponse
 
response
 $
=
% &

WebRequest
' 1
.
1 2
Create
2 8
(
8 9"
ConfigurationManager
9 M
.
M N
AppSettings
N Y
[
Y Z
$str
Z g
]
g h
+
i j
	imagePath
k t
)
t u
.
u v
GetResponsev 
( ‚
)‚ ƒ
;ƒ „
if
 
(
 
(
 
(
 
HttpWebResponse
 %
)
% &
response
& .
)
. /
.
/ 0

StatusCode
0 :
==
; =
HttpStatusCode
> L
.
L M
OK
M O
)
O P
flag
‘‘ 
=
‘‘ 
true
‘‘ 
;
‘‘  
response
’’ 
.
’’ 
Dispose
’’  
(
’’  !
)
’’! "
;
’’" #
}
““ 
catch
”” 
(
”” 
	Exception
”” 
ex
”” 
)
””  
{
•• 
Logs
–– 
.
–– 
WriteErrorLog
–– "
(
––" #
$str––# „
+––… †
ex––‡ ‰
.––‰ Š
Message––Š ‘
+––’ “
$str––” ¡
+––¢ £
ex––¤ ¦
.––¦ §
Source––§ ­
+––® ¯
$str––° È
+––É Ê
ex––Ë Í
.––Í Î

StackTrace––Î Ø
)––Ø Ù
;––Ù Ú
}
—— 
return
˜˜ 
flag
˜˜ 
;
˜˜ 
}
™™ 	
public
›› 
MemoryStream
›› '
ImageMemoryStreamFromByte
›› 5
(
››5 6
string
››6 <
location
››= E
)
››E F
{
œœ 	
MemoryStream
 
memoryStream
 %
=
& '
new
( +
MemoryStream
, 8
(
8 9
)
9 :
;
: ;
try
 
{
ŸŸ 
byte
   
[
   
]
   
buffer
   
=
   
new
    #
	WebClient
  $ -
(
  - .
)
  . /
.
  / 0
DownloadData
  0 <
(
  < =
location
  = E
)
  E F
;
  F G
memoryStream
¡¡ 
.
¡¡ 
Write
¡¡ "
(
¡¡" #
buffer
¡¡# )
,
¡¡) *
$num
¡¡+ ,
,
¡¡, -
buffer
¡¡. 4
.
¡¡4 5
Length
¡¡5 ;
)
¡¡; <
;
¡¡< =
Logs
¢¢ 
.
¢¢ 
WriteInfoLog
¢¢ !
(
¢¢! "
$str
¢¢" z
)
¢¢z {
;
¢¢{ |
}
££ 
catch
¤¤ 
(
¤¤ 
	Exception
¤¤ 
ex
¤¤ 
)
¤¤  
{
¥¥ 
Logs
¦¦ 
.
¦¦ 
WriteErrorLog
¦¦ "
(
¦¦" #
$str¦¦#  
+¦¦¡ ¢
ex¦¦£ ¥
.¦¦¥ ¦
Message¦¦¦ ­
+¦¦® ¯
$str¦¦° ½
+¦¦¾ ¿
ex¦¦À Â
.¦¦Â Ã
Source¦¦Ã É
)¦¦É Ê
;¦¦Ê Ë
memoryStream
§§ 
=
§§ 
(
§§  
MemoryStream
§§  ,
)
§§, -
null
§§- 1
;
§§1 2
}
¨¨ 
return
©© 
memoryStream
©© 
;
©©  
}
ªª 	
private
¬¬ !
NameValueCollection
¬¬ #
ByteArrayToObject
¬¬$ 5
(
¬¬5 6
byte
¬¬6 :
[
¬¬: ;
]
¬¬; <
	byteArray
¬¬= F
)
¬¬F G
{
­­ 	
try
®® 
{
¯¯ 
MemoryStream
°° 
memoryStream
°° )
=
°°* +
new
°°, /
MemoryStream
°°0 <
(
°°< =
	byteArray
°°= F
)
°°F G
;
°°G H
BinaryFormatter
±± 
binaryFormatter
±±  /
=
±±0 1
new
±±2 5
BinaryFormatter
±±6 E
(
±±E F
)
±±F G
;
±±G H
binaryFormatter
²² 
.
²²  
AssemblyFormat
²²  .
=
²²/ 0$
FormatterAssemblyStyle
²²1 G
.
²²G H
Simple
²²H N
;
²²N O
memoryStream
³³ 
.
³³ 
Position
³³ %
=
³³& '
$num
³³( *
;
³³* +
return
´´ 
(
´´ !
NameValueCollection
´´ +
)
´´+ ,
binaryFormatter
´´, ;
.
´´; <
Deserialize
´´< G
(
´´G H
(
´´H I
Stream
´´I O
)
´´O P
memoryStream
´´P \
)
´´\ ]
;
´´] ^
}
µµ 
catch
¶¶ 
(
¶¶ 
	Exception
¶¶ 
ex
¶¶ 
)
¶¶  
{
·· 
Logs
¸¸ 
.
¸¸ 
WriteErrorLog
¸¸ "
(
¸¸" #
$str
¸¸# d
+
¸¸e f
ex
¸¸g i
.
¸¸i j
Message
¸¸j q
+
¸¸r s
$str¸¸t „
+¸¸… †
ex¸¸‡ ‰
.¸¸‰ Š

StackTrace¸¸Š ”
)¸¸” •
;¸¸• –
}
¹¹ 
return
ºº 
(
ºº !
NameValueCollection
ºº '
)
ºº' (
null
ºº( ,
;
ºº, -
}
»» 	
private
½½ 
void
½½ (
consumer_ConsumerCancelled
½½ /
(
½½/ 0
object
½½0 6
sender
½½7 =
,
½½= >
ConsumerEventArgs
½½? P
args
½½Q U
)
½½U V
{
¾¾ 	
Logs
¿¿ 
.
¿¿ 
WriteInfoLog
¿¿ 
(
¿¿ 
$str
¿¿ ?
)
¿¿? @
;
¿¿@ A
CreateConnection
ÀÀ 
.
ÀÀ 
CloseConnections
ÀÀ -
(
ÀÀ- .
)
ÀÀ. /
;
ÀÀ/ 0
CreateConnection
ÁÁ 
.
ÁÁ 
RefreshNodes
ÁÁ )
(
ÁÁ) *
)
ÁÁ* +
;
ÁÁ+ ,
CreateConnection
ÂÂ 
.
ÂÂ 
GetNextNode
ÂÂ (
(
ÂÂ( )
)
ÂÂ) *
;
ÂÂ* +
this
ÃÃ 
.
ÃÃ 
RabbitMQExecution
ÃÃ "
(
ÃÃ" #
(
ÃÃ# $
string
ÃÃ$ *
)
ÃÃ* +
CreateConnection
ÃÃ+ ;
.
ÃÃ; <
	QueueName
ÃÃ< E
,
ÃÃE F
(
ÃÃG H
string
ÃÃH N
)
ÃÃN O
CreateConnection
ÃÃO _
.
ÃÃ_ `
serverIp
ÃÃ` h
)
ÃÃh i
;
ÃÃi j
}
ÄÄ 	
private
ÆÆ 
void
ÆÆ 
DeadLetterPublish
ÆÆ &
(
ÆÆ& '!
NameValueCollection
ÆÆ' :
nvc
ÆÆ; >
,
ÆÆ> ?
string
ÆÆ@ F
	queueName
ÆÆG P
)
ÆÆP Q
{
ÇÇ 	
RabbitMqPublish
ÈÈ 
rabbitMqPublish
ÈÈ +
=
ÈÈ, -
new
ÈÈ. 1
RabbitMqPublish
ÈÈ2 A
(
ÈÈA B
)
ÈÈB C
;
ÈÈC D
rabbitMqPublish
ÉÉ 
.
ÉÉ #
UseDeadLetterExchange
ÉÉ 1
=
ÉÉ2 3
true
ÉÉ4 8
;
ÉÉ8 9
rabbitMqPublish
ÊÊ 
.
ÊÊ 

MessageTTL
ÊÊ &
=
ÊÊ' (
(
ÊÊ) *
int
ÊÊ* -
.
ÊÊ- .
Parse
ÊÊ. 3
(
ÊÊ3 4"
ConfigurationManager
ÊÊ4 H
.
ÊÊH I
AppSettings
ÊÊI T
[
ÊÊT U
$str
ÊÊU c
]
ÊÊc d
.
ÊÊd e
ToString
ÊÊe m
(
ÊÊm n
)
ÊÊn o
)
ÊÊo p
)
ÊÊp q
;
ÊÊq r
int
ËË 
num
ËË 
=
ËË 
nvc
ËË 
[
ËË 
$str
ËË %
]
ËË% &
==
ËË' )
null
ËË* .
?
ËË/ 0
$num
ËË1 2
:
ËË3 4
(
ËË5 6
int
ËË6 9
)
ËË9 :
short
ËË: ?
.
ËË? @
Parse
ËË@ E
(
ËËE F
nvc
ËËF I
[
ËËI J
$str
ËËJ U
]
ËËU V
)
ËËV W
+
ËËX Y
$num
ËËZ [
;
ËË[ \
nvc
ÌÌ 
.
ÌÌ 
Set
ÌÌ 
(
ÌÌ 
$str
ÌÌ 
,
ÌÌ  
num
ÌÌ! $
.
ÌÌ$ %
ToString
ÌÌ% -
(
ÌÌ- .
)
ÌÌ. /
)
ÌÌ/ 0
;
ÌÌ0 1
rabbitMqPublish
ÍÍ 
.
ÍÍ 
PublishToQueue
ÍÍ *
(
ÍÍ* +
	queueName
ÍÍ+ 4
,
ÍÍ4 5
nvc
ÍÍ6 9
)
ÍÍ9 :
;
ÍÍ: ;
}
ÎÎ 	
internal
ĞĞ 
bool
ĞĞ (
UploadImageProcessComplete
ĞĞ 0
(
ĞĞ0 1
string
ĞĞ1 7
photoId
ĞĞ8 ?
,
ĞĞ? @
string
ĞĞA G
hostUrl
ĞĞH O
,
ĞĞO P
string
ĞĞQ W
imageServers
ĞĞX d
,
ĞĞd e
string
ĞĞf l
category
ĞĞm u
,
ĞĞu v
string
ĞĞw }
environmentĞĞ~ ‰
)ĞĞ‰ Š
{
ÑÑ 	
bool
ÒÒ 
flag
ÒÒ 
=
ÒÒ 
false
ÒÒ 
;
ÒÒ 
try
ÓÓ 
{
ÔÔ 
using
ÕÕ 
(
ÕÕ 
	DbCommand
ÕÕ  
cmd
ÕÕ! $
=
ÕÕ% &
	DbFactory
ÕÕ' 0
.
ÕÕ0 1
GetDBCommand
ÕÕ1 =
(
ÕÕ= >"
ConfigurationManager
ÕÕ> R
.
ÕÕR S
AppSettings
ÕÕS ^
[
ÕÕ^ _
$str
ÕÕ_ g
]
ÕÕg h
.
ÕÕh i
ToLower
ÕÕi p
(
ÕÕp q
)
ÕÕq r
)
ÕÕr s
)
ÕÕs t
{
ÖÖ 
cmd
×× 
.
×× 
CommandType
×× #
=
××$ %
CommandType
××& 1
.
××1 2
StoredProcedure
××2 A
;
××A B
cmd
ØØ 
.
ØØ 

Parameters
ØØ "
.
ØØ" #
Add
ØØ# &
(
ØØ& '
	DbFactory
ØØ' 0
.
ØØ0 1

GetDbParam
ØØ1 ;
(
ØØ; <
$str
ØØ< G
,
ØØG H
DbType
ØØI O
.
ØØO P
Int64
ØØP U
,
ØØU V
Convert
ØØW ^
.
ØØ^ _
ToInt32
ØØ_ f
(
ØØf g
photoId
ØØg n
)
ØØn o
)
ØØo p
)
ØØp q
;
ØØq r
cmd
ÙÙ 
.
ÙÙ 

Parameters
ÙÙ "
.
ÙÙ" #
Add
ÙÙ# &
(
ÙÙ& '
	DbFactory
ÙÙ' 0
.
ÙÙ0 1

GetDbParam
ÙÙ1 ;
(
ÙÙ; <
$str
ÙÙ< G
,
ÙÙG H
DbType
ÙÙI O
.
ÙÙO P
String
ÙÙP V
,
ÙÙV W
$num
ÙÙX [
,
ÙÙ[ \
hostUrl
ÙÙ] d
)
ÙÙd e
)
ÙÙe f
;
ÙÙf g
cmd
ÚÚ 
.
ÚÚ 

Parameters
ÚÚ "
.
ÚÚ" #
Add
ÚÚ# &
(
ÚÚ& '
	DbFactory
ÚÚ' 0
.
ÚÚ0 1

GetDbParam
ÚÚ1 ;
(
ÚÚ; <
$str
ÚÚ< J
,
ÚÚJ K
DbType
ÚÚL R
.
ÚÚR S
String
ÚÚS Y
,
ÚÚY Z
$num
ÚÚ[ ^
,
ÚÚ^ _
imageServers
ÚÚ` l
)
ÚÚl m
)
ÚÚm n
;
ÚÚn o
cmd
ÛÛ 
.
ÛÛ 

Parameters
ÛÛ "
.
ÛÛ" #
Add
ÛÛ# &
(
ÛÛ& '
	DbFactory
ÛÛ' 0
.
ÛÛ0 1

GetDbParam
ÛÛ1 ;
(
ÛÛ; <
$str
ÛÛ< H
,
ÛÛH I
DbType
ÛÛJ P
.
ÛÛP Q
String
ÛÛQ W
,
ÛÛW X
$num
ÛÛY \
,
ÛÛ\ ]
category
ÛÛ^ f
)
ÛÛf g
)
ÛÛg h
;
ÛÛh i
cmd
ÜÜ 
.
ÜÜ 

Parameters
ÜÜ "
.
ÜÜ" #
Add
ÜÜ# &
(
ÜÜ& '
	DbFactory
ÜÜ' 0
.
ÜÜ0 1

GetDbParam
ÜÜ1 ;
(
ÜÜ; <
$str
ÜÜ< K
,
ÜÜK L
DbType
ÜÜM S
.
ÜÜS T
String
ÜÜT Z
,
ÜÜZ [
$num
ÜÜ\ ^
,
ÜÜ^ _
!
ÜÜ` a
string
ÜÜa g
.
ÜÜg h
IsNullOrEmpty
ÜÜh u
(
ÜÜu v
environmentÜÜv 
)ÜÜ ‚
?ÜÜƒ „
environmentÜÜ… 
:ÜÜ‘ ’
$strÜÜ“ •
)ÜÜ• –
)ÜÜ– —
;ÜÜ— ˜
cmd
İİ 
.
İİ 

Parameters
İİ "
.
İİ" #
Add
İİ# &
(
İİ& '
	DbFactory
İİ' 0
.
İİ0 1

GetDbParam
İİ1 ;
(
İİ; <
$str
İİ< J
,
İİJ K
DbType
İİL R
.
İİR S
Int32
İİS X
,
İİX Y
DBNull
İİZ `
.
İİ` a
Value
İİa f
)
İİf g
)
İİg h
;
İİh i
MySqlDatabase
ßß !
.
ßß! "
ExecuteNonQuery
ßß" 1
(
ßß1 2
cmd
ßß2 5
,
ßß5 6
ConnectionType
ßß7 E
.
ßßE F
MasterDatabase
ßßF T
)
ßßT U
;
ßßU V
flag
áá 
=
áá 
true
áá 
;
áá  
Logs
ââ 
.
ââ 
WriteInfoLog
ââ %
(
ââ% &
$str
ââ& p
)
ââp q
;
ââq r
}
ãã 
}
ää 
catch
åå 
(
åå 
	Exception
åå 
ex
åå 
)
åå  
{
ææ 
Logs
çç 
.
çç 
WriteErrorLog
çç "
(
çç" #
$str
çç# s
+
ççt u
ex
ççv x
.
ççx y
Messageççy €
,çç€ 
exçç‚ „
)çç„ …
;çç… †
}
èè 
return
éé 
flag
éé 
;
éé 
}
êê 	
}
ëë 
public
íí 

class
íí 

UploadToS3
íí 
{
îî 
internal
ïï 
bool
ïï 
CallS3Service
ïï #
(
ïï# $
MemoryStream
ïï$ 0
ms
ïï1 3
,
ïï3 4
string
ïï5 ;
targetImagePath
ïï< K
)
ïïK L
{
ğğ 	
Logs
ññ 
.
ññ 
WriteInfoLog
ññ 
(
ññ 
$str
ññ O
+
ññP Q
targetImagePath
ññR a
)
ñña b
;
ññb c"
ConfigurationManager
òò  
.
òò  !
AppSettings
òò! ,
[
òò, -
$str
òò- 5
]
òò5 6
.
òò6 7
ToString
òò7 ?
(
òò? @
)
òò@ A
;
òòA B

UploadFile
óó 

uploadFile
óó !
=
óó" #
new
óó$ '

UploadFile
óó( 2
(
óó2 3
)
óó3 4
;
óó4 5
bool
ôô 
flag
ôô 
;
ôô 
try
õõ 
{
öö 

uploadFile
÷÷ 
.
÷÷ 
Bucket
÷÷ !
=
÷÷" #"
ConfigurationManager
÷÷$ 8
.
÷÷8 9
AppSettings
÷÷9 D
[
÷÷D E
$str
÷÷E S
]
÷÷S T
.
÷÷T U
ToString
÷÷U ]
(
÷÷] ^
)
÷÷^ _
;
÷÷_ `

uploadFile
øø 
.
øø 
CreateBucket
øø '
(
øø' (
)
øø( )
;
øø) *

uploadFile
ùù 
.
ùù "
UploadFileFromStream
ùù /
(
ùù/ 0
targetImagePath
ùù0 ?
,
ùù? @
(
ùùA B
Stream
ùùB H
)
ùùH I
ms
ùùI K
)
ùùK L
;
ùùL M
flag
úú 
=
úú 
true
úú 
;
úú 
}
ûû 
catch
üü 
(
üü 
	Exception
üü 
ex
üü 
)
üü  
{
ıı 
flag
şş 
=
şş 
false
şş 
;
şş 
Logs
ÿÿ 
.
ÿÿ 
WriteErrorLog
ÿÿ "
(
ÿÿ" #
$str
ÿÿ# >
+
ÿÿ? @
ex
ÿÿA C
.
ÿÿC D
Message
ÿÿD K
+
ÿÿL M
$str
ÿÿN S
+
ÿÿT U
ex
ÿÿV X
.
ÿÿX Y
Source
ÿÿY _
+
ÿÿ` a
$str
ÿÿb g
+
ÿÿh i
ex
ÿÿj l
.
ÿÿl m

StackTrace
ÿÿm w
)
ÿÿw x
;
ÿÿx y
}
€€ 
return
 
flag
 
;
 
}
‚‚ 	
}
ƒƒ 
}„„ 