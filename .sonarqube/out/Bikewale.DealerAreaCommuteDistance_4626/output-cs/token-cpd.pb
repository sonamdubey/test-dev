Û≠
KD:\work\bikewaleweb\Bikewale.DealerAreaCommuteDistance\CommuteDistanceBL.cs
	namespace 	
Bikewale
 
. %
DealerAreaCommuteDistance ,
{		 
public 

class 
CommuteDistanceBL "
{ 
private 
readonly %
CommuteDistanceRepository 2
commuteDistance3 B
=C D
nullE I
;I J
public 
CommuteDistanceBL  
(  !
)! "
{ 	
commuteDistance 
= 
new !%
CommuteDistanceRepository" ;
(; <
)< =
;= >
} 	
internal!! 
bool!! (
UpdateCommuteDistanceForArea!! 2
(!!2 3
UInt32!!3 9
areaId!!: @
,!!@ A
double!!B H
	lattitude!!I R
,!!R S
double!!T Z
	longitude!![ d
)!!d e
{"" 	#
GoogleDistanceAPIHelper## #
	googleApi##$ -
=##. /
null##0 4
;##4 5
IEnumerable$$ 
<$$ (
GeoLocationDestinationEntity$$ 4
>$$4 5
apiResp$$6 =
=$$> ?
null$$@ D
;$$D E
string%% 
formatedResp%% 
=%%  !
string%%" (
.%%( )
Empty%%) .
;%%. /
UInt16&& 
maxArea&& 
=&& 
Convert&& $
.&&$ %
ToUInt16&&% -
(&&- . 
ConfigurationManager&&. B
.&&B C
AppSettings&&C N
[&&N O
$str&&O _
]&&_ `
)&&` a
;&&a b
GeoLocationEntity'' 
area'' "
=''# $
null''% )
;'') *
try(( 
{)) 
IEnumerable** 
<** 
GeoLocationEntity** -
>**- .
dealers**/ 6
=**7 8
null**9 =
,**= >
dealersBatch**? K
=**L M
null**N R
;**R S
dealers,, 
=,, 
commuteDistance,, )
.,,) *
GetDealersByArea,,* :
(,,: ;
areaId,,; A
),,A B
;,,B C
area-- 
=-- 
new-- 
GeoLocationEntity-- ,
(--, -
)--- .
;--. /
area.. 
... 
Id.. 
=.. 
areaId..  
;..  !
area// 
.// 
Latitude// 
=// 
	lattitude//  )
;//) *
area00 
.00 
	Longitude00 
=00  
	longitude00! *
;00* +
if11 
(11 
area11 
!=11 
null11  
&&11! #
dealers11$ +
!=11, .
null11/ 3
&&114 6
dealers117 >
.11> ?
Count11? D
(11D E
)11E F
>11G H
$num11I J
)11J K
{22 
	googleApi33 
=33 
new33  ##
GoogleDistanceAPIHelper33$ ;
(33; <
)33< =
;33= >
dealersBatch44  
=44! "
dealers44# *
.44* +
Take44+ /
(44/ 0
maxArea440 7
)447 8
;448 9
int55 
batchCounter55 $
=55% &
$num55' (
;55( )
do66 
{77 
apiResp99 
=99  !
	googleApi99" +
.99+ ,&
GetDistanceUsingArrayIndex99, F
(99F G
area99G K
,99K L
dealersBatch99M Y
)99Y Z
;99Z [
if:: 
(:: 
apiResp:: #
!=::$ &
null::' +
&&::, .
apiResp::/ 6
.::6 7
Count::7 <
(::< =
)::= >
>::? @
$num::A B
)::B C
{;; 
formatedResp<< (
=<<) *
	googleApi<<+ 4
.<<4 5
FormatApiResp<<5 B
(<<B C
apiResp<<C J
)<<J K
;<<K L
if>> 
(>>  
commuteDistance>>  /
.>>/ 0
UpdateDistances>>0 ?
(>>? @
$num>>@ A
,>>A B
areaId>>C I
,>>I J
formatedResp>>K W
)>>W X
)>>X Y
{?? 
Logs@@  $
.@@$ %
WriteInfoLog@@% 1
(@@1 2
String@@2 8
.@@8 9
Format@@9 ?
(@@? @
$str@@@ t
,@@t u
(@@v w
batchCounter	@@w É
+
@@Ñ Ö
$num
@@Ü á
)
@@á à
,
@@à â
area
@@ä é
.
@@é è
Id
@@è ë
)
@@ë í
)
@@í ì
;
@@ì î
}AA 
elseBB  
{CC 
LogsDD  $
.DD$ %
WriteInfoLogDD% 1
(DD1 2
StringDD2 8
.DD8 9
FormatDD9 ?
(DD? @
$strDD@ {
,DD{ |
(DD} ~
batchCounter	DD~ ä
+
DDã å
$num
DDç é
)
DDé è
,
DDè ê
area
DDë ï
.
DDï ñ
Id
DDñ ò
)
DDò ô
)
DDô ö
;
DDö õ
}EE 
}FF 
elseGG 
{HH 
LogsII  
.II  !
WriteInfoLogII! -
(II- .
StringII. 4
.II4 5
FormatII5 ;
(II; <
$str	II< Ñ
,
IIÑ Ö
area
IIÜ ä
.
IIä ã
Id
IIã ç
,
IIç é
(
IIè ê
batchCounter
IIê ú
+
IIù û
$num
IIü †
)
II† °
)
II° ¢
)
II¢ £
;
II£ §
}JJ 
++KK 
batchCounterKK &
;KK& '
dealersBatchLL $
=LL% &
dealersLL' .
.LL. /
SkipLL/ 3
(LL3 4
maxAreaLL4 ;
*LL< =
batchCounterLL> J
)LLJ K
.LLK L
TakeLLL P
(LLP Q
maxAreaLLQ X
)LLX Y
;LLY Z
ThreadMM 
.MM 
SleepMM $
(MM$ %
$numMM% (
)MM( )
;MM) *
}NN 
whileNN 
(NN 
dealersBatchNN )
.NN) *
CountNN* /
(NN/ 0
)NN0 1
>NN2 3
$numNN4 5
)NN5 6
;NN6 7
LogsOO 
.OO 
WriteInfoLogOO %
(OO% &
StringOO& ,
.OO, -
FormatOO- 3
(OO3 4
$strOO4 M
,OOM N
areaOOO S
.OOS T
IdOOT V
)OOV W
)OOW X
;OOX Y
}PP 
elseQQ 
{RR 
LogsSS 
.SS 
WriteInfoLogSS %
(SS% &
StringSS& ,
.SS, -
FormatSS- 3
(SS3 4
$strSS4 [
,SS[ \
areaSS] a
.SSa b
IdSSb d
)SSd e
)SSe f
;SSf g
}TT 
}UU 
catchVV 
{WW 
returnYY 
falseYY 
;YY 
}ZZ 
return[[ 
true[[ 
;[[ 
}\\ 	
internalee 
boolee +
UpdateCommuteDistanceForAreaAddee 5
(ee5 6
Int32ee6 ;
cityIdee< B
,eeB C
UInt32eeD J
areaIdeeK Q
,eeQ R
doubleeeS Y
	lattitudeeeZ c
,eec d
doubleeee k
	longitudeeel u
)eeu v
{ff 	#
GoogleDistanceAPIHelpergg #
	googleApigg$ -
=gg. /
nullgg0 4
;gg4 5
IEnumerablehh 
<hh (
GeoLocationDestinationEntityhh 4
>hh4 5
apiResphh6 =
=hh> ?
nullhh@ D
;hhD E
stringii 
formatedRespii 
=ii  !
stringii" (
.ii( )
Emptyii) .
;ii. /
UInt16jj 
maxAreajj 
=jj 
Convertjj $
.jj$ %
ToUInt16jj% -
(jj- . 
ConfigurationManagerjj. B
.jjB C
AppSettingsjjC N
[jjN O
$strjjO _
]jj_ `
)jj` a
;jja b
GeoLocationEntitykk 
areakk "
=kk# $
nullkk% )
;kk) *
tryll 
{mm 
IEnumerablenn 
<nn 
GeoLocationEntitynn -
>nn- .
dealersnn/ 6
=nn7 8
nullnn9 =
,nn= >
dealersBatchnn? K
=nnL M
nullnnN R
;nnR S
dealerspp 
=pp 
commuteDistancepp )
.pp) *#
GetCampaignDealerByCitypp* A
(ppA B
cityIdppB H
)ppH I
;ppI J
areaqq 
=qq 
newqq 
GeoLocationEntityqq ,
(qq, -
)qq- .
;qq. /
arearr 
.rr 
Idrr 
=rr 
areaIdrr  
;rr  !
areass 
.ss 
Latitudess 
=ss 
	lattitudess  )
;ss) *
areatt 
.tt 
	Longitudett 
=tt  
	longitudett! *
;tt* +
ifuu 
(uu 
areauu 
!=uu 
nulluu  
&&uu! #
dealersuu$ +
!=uu, .
nulluu/ 3
&&uu4 6
dealersuu7 >
.uu> ?
Countuu? D
(uuD E
)uuE F
>uuG H
$numuuI J
)uuJ K
{vv 
	googleApiww 
=ww 
newww  ##
GoogleDistanceAPIHelperww$ ;
(ww; <
)ww< =
;ww= >
dealersBatchxx  
=xx! "
dealersxx# *
.xx* +
Takexx+ /
(xx/ 0
maxAreaxx0 7
)xx7 8
;xx8 9
intyy 
batchCounteryy $
=yy% &
$numyy' (
;yy( )
dozz 
{{{ 
apiResp}} 
=}}  !
	googleApi}}" +
.}}+ ,&
GetDistanceUsingArrayIndex}}, F
(}}F G
area}}G K
,}}K L
dealersBatch}}M Y
)}}Y Z
;}}Z [
if~~ 
(~~ 
apiResp~~ #
!=~~$ &
null~~' +
&&~~, .
apiResp~~/ 6
.~~6 7
Count~~7 <
(~~< =
)~~= >
>~~? @
$num~~A B
)~~B C
{ 
formatedResp
ÄÄ (
=
ÄÄ) *
	googleApi
ÄÄ+ 4
.
ÄÄ4 5
FormatApiResp
ÄÄ5 B
(
ÄÄB C
apiResp
ÄÄC J
)
ÄÄJ K
;
ÄÄK L
if
ÇÇ 
(
ÇÇ  
commuteDistance
ÇÇ  /
.
ÇÇ/ 0
UpdateDistances
ÇÇ0 ?
(
ÇÇ? @
$num
ÇÇ@ A
,
ÇÇA B
areaId
ÇÇC I
,
ÇÇI J
formatedResp
ÇÇK W
)
ÇÇW X
)
ÇÇX Y
{
ÉÉ 
Logs
ÑÑ  $
.
ÑÑ$ %
WriteInfoLog
ÑÑ% 1
(
ÑÑ1 2
String
ÑÑ2 8
.
ÑÑ8 9
Format
ÑÑ9 ?
(
ÑÑ? @
$str
ÑÑ@ t
,
ÑÑt u
(
ÑÑv w
batchCounterÑÑw É
+ÑÑÑ Ö
$numÑÑÜ á
)ÑÑá à
,ÑÑà â
areaÑÑä é
.ÑÑé è
IdÑÑè ë
)ÑÑë í
)ÑÑí ì
;ÑÑì î
}
ÖÖ 
else
ÜÜ  
{
áá 
Logs
àà  $
.
àà$ %
WriteInfoLog
àà% 1
(
àà1 2
String
àà2 8
.
àà8 9
Format
àà9 ?
(
àà? @
$str
àà@ {
,
àà{ |
(
àà} ~
batchCounteràà~ ä
+ààã å
$numààç é
)ààé è
,ààè ê
areaààë ï
.ààï ñ
Idààñ ò
)ààò ô
)ààô ö
;ààö õ
}
ââ 
}
ää 
else
ãã 
{
åå 
Logs
çç  
.
çç  !
WriteInfoLog
çç! -
(
çç- .
String
çç. 4
.
çç4 5
Format
çç5 ;
(
çç; <
$strçç< Ñ
,ççÑ Ö
areaççÜ ä
.ççä ã
Idççã ç
,ççç é
(ççè ê
batchCounterççê ú
+ççù û
$numççü †
)çç† °
)çç° ¢
)çç¢ £
;çç£ §
}
éé 
++
èè 
batchCounter
èè &
;
èè& '
dealersBatch
êê $
=
êê% &
dealers
êê' .
.
êê. /
Skip
êê/ 3
(
êê3 4
maxArea
êê4 ;
*
êê< =
batchCounter
êê> J
)
êêJ K
.
êêK L
Take
êêL P
(
êêP Q
maxArea
êêQ X
)
êêX Y
;
êêY Z
Thread
ëë 
.
ëë 
Sleep
ëë $
(
ëë$ %
$num
ëë% (
)
ëë( )
;
ëë) *
}
íí 
while
íí 
(
íí 
dealersBatch
íí )
.
íí) *
Count
íí* /
(
íí/ 0
)
íí0 1
>
íí2 3
$num
íí4 5
)
íí5 6
;
íí6 7
Logs
ìì 
.
ìì 
WriteInfoLog
ìì %
(
ìì% &
String
ìì& ,
.
ìì, -
Format
ìì- 3
(
ìì3 4
$str
ìì4 M
,
ììM N
area
ììO S
.
ììS T
Id
ììT V
)
ììV W
)
ììW X
;
ììX Y
}
îî 
else
ïï 
{
ññ 
Logs
óó 
.
óó 
WriteInfoLog
óó %
(
óó% &
String
óó& ,
.
óó, -
Format
óó- 3
(
óó3 4
$str
óó4 [
,
óó[ \
area
óó] a
.
óóa b
Id
óób d
)
óód e
)
óóe f
;
óóf g
}
òò 
}
ôô 
catch
öö 
(
öö 
	Exception
öö 
ex
öö 
)
öö  
{
õõ 
Logs
úú 
.
úú 
WriteErrorLog
úú "
(
úú" #
$str
úú# E
+
úúF G
ex
úúH J
.
úúJ K
Message
úúK R
)
úúR S
;
úúS T
return
ùù 
false
ùù 
;
ùù 
}
ûû 
return
üü 
true
üü 
;
üü 
}
†† 	
internal
™™ 
bool
™™ 2
$UpdateCommuteDistanceForDealerUpdate
™™ :
(
™™: ;
UInt32
™™; A
dealerId
™™B J
,
™™J K
double
™™L R
	lattitude
™™S \
,
™™\ ]
double
™™^ d
	longitude
™™e n
)
™™n o
{
´´ 	%
GoogleDistanceAPIHelper
¨¨ #
	googleApi
¨¨$ -
=
¨¨. /
null
¨¨0 4
;
¨¨4 5
IEnumerable
≠≠ 
<
≠≠ *
GeoLocationDestinationEntity
≠≠ 4
>
≠≠4 5
apiResp
≠≠6 =
=
≠≠> ?
null
≠≠@ D
;
≠≠D E
string
ÆÆ 
formatedResp
ÆÆ 
=
ÆÆ  !
string
ÆÆ" (
.
ÆÆ( )
Empty
ÆÆ) .
;
ÆÆ. /
UInt16
ØØ 
maxArea
ØØ 
=
ØØ 
Convert
ØØ $
.
ØØ$ %
ToUInt16
ØØ% -
(
ØØ- ."
ConfigurationManager
ØØ. B
.
ØØB C
AppSettings
ØØC N
[
ØØN O
$str
ØØO _
]
ØØ_ `
)
ØØ` a
;
ØØa b
GeoLocationEntity
∞∞ 
dealer
∞∞ $
=
∞∞% &
null
∞∞' +
;
∞∞+ ,
try
±± 
{
≤≤ 
IEnumerable
≥≥ 
<
≥≥ 
GeoLocationEntity
≥≥ -
>
≥≥- .
areas
≥≥/ 4
=
≥≥5 6
null
≥≥7 ;
,
≥≥; <

areasBatch
≥≥= G
=
≥≥H I
null
≥≥J N
;
≥≥N O
areas
µµ 
=
µµ 
commuteDistance
µµ '
.
µµ' (
GetAreasByDealer
µµ( 8
(
µµ8 9
dealerId
µµ9 A
)
µµA B
;
µµB C
dealer
∂∂ 
=
∂∂ 
new
∂∂ 
GeoLocationEntity
∂∂ .
(
∂∂. /
)
∂∂/ 0
;
∂∂0 1
dealer
∑∑ 
.
∑∑ 
Id
∑∑ 
=
∑∑ 
dealerId
∑∑ $
;
∑∑$ %
dealer
∏∏ 
.
∏∏ 
Latitude
∏∏ 
=
∏∏  !
	lattitude
∏∏" +
;
∏∏+ ,
dealer
ππ 
.
ππ 
	Longitude
ππ  
=
ππ! "
	longitude
ππ# ,
;
ππ, -
if
∫∫ 
(
∫∫ 
dealer
∫∫ 
!=
∫∫ 
null
∫∫ "
&&
∫∫# %
areas
∫∫& +
!=
∫∫, .
null
∫∫/ 3
&&
∫∫4 6
areas
∫∫7 <
.
∫∫< =
Count
∫∫= B
(
∫∫B C
)
∫∫C D
>
∫∫E F
$num
∫∫G H
)
∫∫H I
{
ªª 
	googleApi
ºº 
=
ºº 
new
ºº  #%
GoogleDistanceAPIHelper
ºº$ ;
(
ºº; <
)
ºº< =
;
ºº= >

areasBatch
ΩΩ 
=
ΩΩ  
areas
ΩΩ! &
.
ΩΩ& '
Take
ΩΩ' +
(
ΩΩ+ ,
maxArea
ΩΩ, 3
)
ΩΩ3 4
;
ΩΩ4 5
int
ææ 
batchCounter
ææ $
=
ææ% &
$num
ææ' (
;
ææ( )
do
øø 
{
¿¿ 
apiResp
¬¬ 
=
¬¬  !
	googleApi
¬¬" +
.
¬¬+ ,(
GetDistanceUsingArrayIndex
¬¬, F
(
¬¬F G
dealer
¬¬G M
,
¬¬M N

areasBatch
¬¬O Y
)
¬¬Y Z
;
¬¬Z [
if
√√ 
(
√√ 
apiResp
√√ #
!=
√√$ &
null
√√' +
&&
√√, .
apiResp
√√/ 6
.
√√6 7
Count
√√7 <
(
√√< =
)
√√= >
>
√√? @
$num
√√A B
)
√√B C
{
ƒƒ 
formatedResp
≈≈ (
=
≈≈) *
	googleApi
≈≈+ 4
.
≈≈4 5
FormatApiResp
≈≈5 B
(
≈≈B C
apiResp
≈≈C J
)
≈≈J K
;
≈≈K L
if
«« 
(
««  
commuteDistance
««  /
.
««/ 0
UpdateDistances
««0 ?
(
««? @
$num
««@ A
,
««A B
dealer
««C I
.
««I J
Id
««J L
,
««L M
formatedResp
««N Z
)
««Z [
)
««[ \
{
»» 
Logs
……  $
.
……$ %
WriteInfoLog
……% 1
(
……1 2
String
……2 8
.
……8 9
Format
……9 ?
(
……? @
$str
……@ t
,
……t u
(
……v w
batchCounter……w É
+……Ñ Ö
$num……Ü á
)……á à
,……à â
dealer……ä ê
.……ê ë
Id……ë ì
)……ì î
)……î ï
;……ï ñ
}
   
else
ÀÀ  
{
ÃÃ 
Logs
ÕÕ  $
.
ÕÕ$ %
WriteInfoLog
ÕÕ% 1
(
ÕÕ1 2
String
ÕÕ2 8
.
ÕÕ8 9
Format
ÕÕ9 ?
(
ÕÕ? @
$str
ÕÕ@ {
,
ÕÕ{ |
(
ÕÕ} ~
batchCounterÕÕ~ ä
+ÕÕã å
$numÕÕç é
)ÕÕé è
,ÕÕè ê
dealerÕÕë ó
.ÕÕó ò
IdÕÕò ö
)ÕÕö õ
)ÕÕõ ú
;ÕÕú ù
}
ŒŒ 
}
œœ 
else
–– 
{
—— 
Logs
““  
.
““  !
WriteInfoLog
““! -
(
““- .
String
““. 4
.
““4 5
Format
““5 ;
(
““; <
$str““< Ñ
,““Ñ Ö
dealer““Ü å
.““å ç
Id““ç è
,““è ê
(““ë í
batchCounter““í û
+““ü †
$num““° ¢
)““¢ £
)““£ §
)““§ •
;““• ¶
}
”” 
++
‘‘ 
batchCounter
‘‘ &
;
‘‘& '

areasBatch
’’ "
=
’’# $
areas
’’% *
.
’’* +
Skip
’’+ /
(
’’/ 0
maxArea
’’0 7
*
’’8 9
batchCounter
’’: F
)
’’F G
.
’’G H
Take
’’H L
(
’’L M
maxArea
’’M T
)
’’T U
;
’’U V
Thread
÷÷ 
.
÷÷ 
Sleep
÷÷ $
(
÷÷$ %
$num
÷÷% (
)
÷÷( )
;
÷÷) *
}
◊◊ 
while
◊◊ 
(
◊◊ 

areasBatch
◊◊ '
.
◊◊' (
Count
◊◊( -
(
◊◊- .
)
◊◊. /
>
◊◊0 1
$num
◊◊2 3
)
◊◊3 4
;
◊◊4 5
}
ÿÿ 
else
ŸŸ 
{
⁄⁄ 
}
‹‹ 
}
›› 
catch
ﬁﬁ 
(
ﬁﬁ 
	Exception
ﬁﬁ 
ex
ﬁﬁ 
)
ﬁﬁ  
{
ﬂﬂ 
return
·· 
false
·· 
;
·· 
}
‚‚ 
return
„„ 
true
„„ 
;
„„ 
}
‰‰ 	
internal
ÓÓ 
bool
ÓÓ &
IsAreaGeoLocationChanged
ÓÓ .
(
ÓÓ. /
UInt32
ÓÓ/ 5
areaId
ÓÓ6 <
,
ÓÓ< =
double
ÓÓ> D
	lattitude
ÓÓE N
,
ÓÓN O
double
ÓÓP V
	longitude
ÓÓW `
)
ÓÓ` a
{
ÔÔ 	
return
 
commuteDistance
 "
.
" #&
IsAreaGeoLocationChanged
# ;
(
; <
areaId
< B
,
B C
	lattitude
D M
,
M N
	longitude
O X
)
X Y
;
Y Z
}
ÒÒ 	
internal
˚˚ 
bool
˚˚ (
IsDealerGeoLocationChanged
˚˚ 0
(
˚˚0 1
UInt32
˚˚1 7
dealerId
˚˚8 @
,
˚˚@ A
double
˚˚B H
	lattitude
˚˚I R
,
˚˚R S
double
˚˚T Z
	longitude
˚˚[ d
)
˚˚d e
{
¸¸ 	
return
˝˝ 
commuteDistance
˝˝ "
.
˝˝" #(
IsDealerGeoLocationChanged
˝˝# =
(
˝˝= >
dealerId
˝˝> F
,
˝˝F G
	lattitude
˝˝H Q
,
˝˝Q R
	longitude
˝˝S \
)
˝˝\ ]
;
˝˝] ^
}
˛˛ 	
internal
ÜÜ 
bool
ÜÜ 
IsAreaExists
ÜÜ "
(
ÜÜ" #
UInt32
ÜÜ# )
areaId
ÜÜ* 0
)
ÜÜ0 1
{
áá 	
return
àà 
commuteDistance
àà "
.
àà" #
IsAreaExists
àà# /
(
àà/ 0
areaId
àà0 6
)
àà6 7
;
àà7 8
}
ââ 	
}
ää 
}ãã åt
QD:\work\bikewaleweb\Bikewale.DealerAreaCommuteDistance\CommuteDistanceConsumer.cs
	namespace		 	
Bikewale		
 
.		 %
DealerAreaCommuteDistance		 ,
{

 
public 

class #
CommuteDistanceConsumer (
{ 
internal 
void 
RabbitMQExecution '
(' (
string( .
	queueName/ 8
,8 9
string: @
hostNameA I
)I J
{ 	
string 
operationType  
=! "
string# )
.) *
Empty* /
;/ 0
int 
cityID 
; 
UInt32 
areaId 
, 
dealerId #
;# $
double 
	lattitude 
, 
	longitude '
;' (
try 
{ 
CreateConnection  
.  !
Connect! (
(( )
	queueName) 2
,2 3
hostName4 <
)< =
;= >
IConnection 

Connection &
=' (
CreateConnection) 9
.9 :

Connection: D
;D E
SendMail 
. 
APPLICATION $
=% & 
ConfigurationManager' ;
.; <
AppSettings< G
[G H
$strH V
]V W
.W X
ToStringX `
(` a
)a b
;b c
	queueName 
=  
ConfigurationManager 0
.0 1
AppSettings1 <
[< =
$str= H
]H I
.I J
ToUpperJ Q
(Q R
)R S
;S T
if   
(   

Connection   
!=   !
null  " &
)  & '
{!! 
CreateConnection"" $
.""$ %
CreateChannel""% 2
(""2 3
)""3 4
;""4 5
IModel## 
Model##  
=##! "
CreateConnection### 3
.##3 4
Model##4 9
;##9 :!
QueueingBasicConsumer$$ )
consumer$$* 2
=$$3 4
CreateConnection$$5 E
.$$E F
CreateConsumer$$F T
($$T U
)$$U V
;$$V W
consumer'' 
.'' 
ConsumerCancelled'' .
+=''/ 1&
consumer_ConsumerCancelled''2 L
;''L M
CommuteDistanceBL(( %
bl((& (
=(() *
new((+ .
CommuteDistanceBL((/ @
(((@ A
)((A B
;((B C
while)) 
()) 
true)) 
)))  
{** 
Logs,, 
.,, 
WriteInfoLog,, )
(,,) *
$str,,* O
),,O P
;,,P Q
RabbitMQ--  
.--  !
Client--! '
.--' (
Events--( .
.--. /!
BasicDeliverEventArgs--/ D
e--E F
=--G H
(--I J
RabbitMQ--J R
.--R S
Client--S Y
.--Y Z
Events--Z `
.--` a!
BasicDeliverEventArgs--a v
)--v w
consumer--w 
.	-- Ä
Queue
--Ä Ö
.
--Ö Ü
Dequeue
--Ü ç
(
--ç é
)
--é è
;
--è ê
NameValueCollection.. +
nvc.., /
=..0 1
null..2 6
;..6 7
try// 
{00 
nvc22 
=22  !
ByteArrayToObject22" 3
(223 4
e224 5
.225 6
Body226 :
)22: ;
;22; <
if33 
(33  
nvc33  #
!=33$ &
null33' +
&&33, .
nvc33/ 2
.332 3
HasKeys333 :
(33: ;
)33; <
&&33= ?
!33@ A
String33A G
.33G H
IsNullOrEmpty33H U
(33U V
nvc33V Y
[33Y Z
$str33Z i
]33i j
)33j k
)33k l
{44 
if55  "
(55# $
nvc55$ '
[55' (
$str55( 3
]553 4
==555 7
$str558 ;
)55; <
{66  !
Model77$ )
.77) *
BasicReject77* 5
(775 6
e776 7
.777 8
DeliveryTag778 C
,77C D
false77E J
)77J K
;77K L
Logs88$ (
.88( )
WriteInfoLog88) 5
(885 6
$str886 c
+88d e
nvc88f i
[88i j
$str88j u
]88u v
)88v w
;88w x
continue99$ ,
;99, -
}::  !
operationType;;  -
=;;. /
nvc;;0 3
[;;3 4
$str;;4 C
];;C D
.;;D E
ToUpper;;E L
(;;L M
);;M N
;;;N O
var<<  #
watch<<$ )
=<<* +
System<<, 2
.<<2 3
Diagnostics<<3 >
.<<> ?
	Stopwatch<<? H
.<<H I
StartNew<<I Q
(<<Q R
)<<R S
;<<S T
Logs==  $
.==$ %
WriteInfoLog==% 1
(==1 2
$str==2 A
+==B C
DateTime==D L
.==L M
Now==M P
)==P Q
;==Q R
switch>>  &
(>>' (
operationType>>( 5
)>>5 6
{??  !
case@@$ (
$str@@) 5
:@@5 6
cityIDAA( .
=AA/ 0
ConvertAA1 8
.AA8 9
ToInt32AA9 @
(AA@ A
nvcAAA D
[AAD E
$strAAE Q
]AAQ R
)AAR S
;AAS T
areaIdBB( .
=BB/ 0
ConvertBB1 8
.BB8 9
ToUInt32BB9 A
(BBA B
nvcBBB E
[BBE F
$strBBF N
]BBN O
)BBO P
;BBP Q
	lattitudeCC( 1
=CC2 3
ConvertCC4 ;
.CC; <
ToDoubleCC< D
(CCD E
nvcCCE H
[CCH I
$strCCI X
]CCX Y
)CCY Z
;CCZ [
	longitudeDD( 1
=DD2 3
ConvertDD4 ;
.DD; <
ToDoubleDD< D
(DDD E
nvcDDE H
[DDH I
$strDDI X
]DDX Y
)DDY Z
;DDZ [
ifEE( *
(EE+ ,
blEE, .
.EE. /
IsAreaExistsEE/ ;
(EE; <
areaIdEE< B
)EEB C
)EEC D
{FF( )
blGG, .
.GG. /+
UpdateCommuteDistanceForAreaAddGG/ N
(GGN O
cityIDGGO U
,GGU V
areaIdGGW ]
,GG] ^
	lattitudeGG_ h
,GGh i
	longitudeGGj s
)GGs t
;GGt u
}HH( )
ModelII( -
.II- .
BasicAckII. 6
(II6 7
eII7 8
.II8 9
DeliveryTagII9 D
,IID E
falseIIF K
)IIK L
;IIL M
breakJJ( -
;JJ- .
caseKK$ (
$strKK) 5
:KK5 6
areaIdLL( .
=LL/ 0
ConvertLL1 8
.LL8 9
ToUInt32LL9 A
(LLA B
nvcLLB E
[LLE F
$strLLF N
]LLN O
)LLO P
;LLP Q
	lattitudeMM( 1
=MM2 3
ConvertMM4 ;
.MM; <
ToDoubleMM< D
(MMD E
nvcMME H
[MMH I
$strMMI X
]MMX Y
)MMY Z
;MMZ [
	longitudeNN( 1
=NN2 3
ConvertNN4 ;
.NN; <
ToDoubleNN< D
(NND E
nvcNNE H
[NNH I
$strNNI X
]NNX Y
)NNY Z
;NNZ [
ifOO( *
(OO+ ,
blOO, .
.OO. /$
IsAreaGeoLocationChangedOO/ G
(OOG H
areaIdOOH N
,OON O
	lattitudeOOP Y
,OOY Z
	longitudeOO[ d
)OOd e
)OOe f
blPP, .
.PP. /(
UpdateCommuteDistanceForAreaPP/ K
(PPK L
areaIdPPL R
,PPR S
	lattitudePPT ]
,PP] ^
	longitudePP_ h
)PPh i
;PPi j
ModelQQ( -
.QQ- .
BasicAckQQ. 6
(QQ6 7
eQQ7 8
.QQ8 9
DeliveryTagQQ9 D
,QQD E
falseQQF K
)QQK L
;QQL M
breakRR( -
;RR- .
caseSS$ (
$strSS) ;
:SS; <
dealerIdTT( 0
=TT1 2
ConvertTT3 :
.TT: ;
ToUInt32TT; C
(TTC D
nvcTTD G
[TTG H
$strTTH V
]TTV W
)TTW X
;TTX Y
	lattitudeUU( 1
=UU2 3
ConvertUU4 ;
.UU; <
ToDoubleUU< D
(UUD E
nvcUUE H
[UUH I
$strUUI X
]UUX Y
)UUY Z
;UUZ [
	longitudeVV( 1
=VV2 3
ConvertVV4 ;
.VV; <
ToDoubleVV< D
(VVD E
nvcVVE H
[VVH I
$strVVI X
]VVX Y
)VVY Z
;VVZ [
ifWW( *
(WW+ ,
blWW, .
.WW. /&
IsDealerGeoLocationChangedWW/ I
(WWI J
dealerIdWWJ R
,WWR S
	lattitudeWWT ]
,WW] ^
	longitudeWW_ h
)WWh i
)WWi j
blXX, .
.XX. /0
$UpdateCommuteDistanceForDealerUpdateXX/ S
(XXS T
dealerIdXXT \
,XX\ ]
	lattitudeXX^ g
,XXg h
	longitudeXXi r
)XXr s
;XXs t
ModelYY( -
.YY- .
BasicAckYY. 6
(YY6 7
eYY7 8
.YY8 9
DeliveryTagYY9 D
,YYD E
falseYYF K
)YYK L
;YYL M
breakZZ( -
;ZZ- .
default[[$ +
:[[+ ,
Model\\( -
.\\- .
BasicReject\\. 9
(\\9 :
e\\: ;
.\\; <
DeliveryTag\\< G
,\\G H
false\\I N
)\\N O
;\\O P
break]]( -
;]]- .
}^^  !
watch``  %
.``% &
Stop``& *
(``* +
)``+ ,
;``, -
varaa  #
	elapsedMsaa$ -
=aa. /
Stringaa0 6
.aa6 7
Formataa7 =
(aa= >
$straa> a
,aaa b
watchaac h
.aah i
Elapsedaai p
.aap q
TotalSecondsaaq }
)aa} ~
;aa~ 
Logscc  $
.cc$ %
WriteInfoLogcc% 1
(cc1 2
	elapsedMscc2 ;
)cc; <
;cc< =
}dd 
elseee  
{ff 
Modelgg  %
.gg% &
BasicRejectgg& 1
(gg1 2
egg2 3
.gg3 4
DeliveryTaggg4 ?
,gg? @
falseggA F
)ggF G
;ggG H
Logshh  $
.hh$ %
WriteInfoLoghh% 1
(hh1 2
$strhh2 M
+hhN O

NewtonsofthhP Z
.hhZ [
Jsonhh[ _
.hh_ `
JsonConverthh` k
.hhk l
SerializeObjecthhl {
(hh{ |
nvchh| 
)	hh Ä
)
hhÄ Å
;
hhÅ Ç
}ii 
}kk 
catchll 
(ll 
	Exceptionll (
exll) +
)ll+ ,
{mm 
Logsnn  
.nn  !
WriteErrorLognn! .
(nn. /
Stringnn/ 5
.nn5 6
Formatnn6 <
(nn< =
$strnn= b
,nnb c
exnnd f
.nnf g
Messagenng n
,nnn o

Newtonsoftnnp z
.nnz {
Jsonnn{ 
.	nn Ä
JsonConvert
nnÄ ã
.
nnã å
SerializeObject
nnå õ
(
nnõ ú
nvc
nnú ü
)
nnü †
)
nn† °
)
nn° ¢
;
nn¢ £
Modeloo !
.oo! "
BasicRejectoo" -
(oo- .
eoo. /
.oo/ 0
DeliveryTagoo0 ;
,oo; <
falseoo= B
)ooB C
;ooC D
continuepp $
;pp$ %
}qq 
}rr 
}ss 
}tt 
catchuu 
(uu 
	Exceptionuu 
exuu 
)uu  
{vv 
Logsww 
.ww 
WriteErrorLogww "
(ww" #
$strww# 8
+ww9 :
exww; =
.ww= >
Messageww> E
)wwE F
;wwF G
SendMailxx 
.xx 
HandleExceptionxx (
(xx( )
exxx) +
,xx+ ,
$strxx- r
)xxr s
;xxs t
}yy 
}zz 	
private
ÅÅ !
NameValueCollection
ÅÅ #
ByteArrayToObject
ÅÅ$ 5
(
ÅÅ5 6
byte
ÅÅ6 :
[
ÅÅ: ;
]
ÅÅ; <
	byteArray
ÅÅ= F
)
ÅÅF G
{
ÇÇ 	
MemoryStream
ÑÑ 
memstr
ÑÑ 
=
ÑÑ  !
new
ÑÑ" %
MemoryStream
ÑÑ& 2
(
ÑÑ2 3
	byteArray
ÑÑ3 <
)
ÑÑ< =
;
ÑÑ= >
BinaryFormatter
áá 
bf
áá 
=
áá  
new
áá! $
BinaryFormatter
áá% 4
(
áá4 5
)
áá5 6
;
áá6 7
bf
ää 
.
ää 
AssemblyFormat
ää 
=
ää 
System
ää  &
.
ää& '
Runtime
ää' .
.
ää. /
Serialization
ää/ <
.
ää< =

Formatters
ää= G
.
ääG H$
FormatterAssemblyStyle
ääH ^
.
ää^ _
Simple
ää_ e
;
ääe f
memstr
çç 
.
çç 
Position
çç 
=
çç 
$num
çç 
;
çç  !
NameValueCollection
êê 
obj
êê  #
=
êê$ %
(
êê& '!
NameValueCollection
êê' :
)
êê: ;
bf
êê; =
.
êê= >
Deserialize
êê> I
(
êêI J
memstr
êêJ P
)
êêP Q
;
êêQ R
return
íí 
obj
íí 
;
íí 
}
ìì 	
private
ïï 
void
ïï (
consumer_ConsumerCancelled
ïï /
(
ïï/ 0
object
ïï0 6
sender
ïï7 =
,
ïï= >
RabbitMQ
ïï? G
.
ïïG H
Client
ïïH N
.
ïïN O
Events
ïïO U
.
ïïU V
ConsumerEventArgs
ïïV g
args
ïïh l
)
ïïl m
{
ññ 	
Logs
óó 
.
óó 
WriteInfoLog
óó 
(
óó 
$str
óó ?
)
óó? @
;
óó@ A
CreateConnection
òò 
.
òò 
CloseConnections
òò -
(
òò- .
)
òò. /
;
òò/ 0
CreateConnection
ôô 
.
ôô 
RefreshNodes
ôô )
(
ôô) *
)
ôô* +
;
ôô+ ,
CreateConnection
öö 
.
öö 
GetNextNode
öö (
(
öö( )
)
öö) *
;
öö* +
RabbitMQExecution
õõ 
(
õõ 
CreateConnection
õõ .
.
õõ. /
	QueueName
õõ/ 8
,
õõ8 9
CreateConnection
õõ: J
.
õõJ K
serverIp
õõK S
)
õõS T
;
õõT U
}
úú 	
}
ùù 
}ûû ª’
SD:\work\bikewaleweb\Bikewale.DealerAreaCommuteDistance\CommuteDistanceRepository.cs
	namespace

 	
Bikewale


 
.

 %
DealerAreaCommuteDistance

 ,
{ 
internal 
class %
CommuteDistanceRepository ,
{ 
public 
IEnumerable 
< 
GeoLocationEntity ,
>, -#
GetCampaignDealerByCity. E
(E F
intF I
cityIdJ P
)P Q
{ 	
IList 
< 
GeoLocationEntity #
># $

lstDealers% /
=0 1
null2 6
;6 7
try 
{ 
using 
( 
	DbCommand  
command! (
=) *
	DbFactory+ 4
.4 5
GetDBCommand5 A
(A B
)B C
)C D
{ 
command 
. 
CommandText '
=( )
$str* G
;G H
command   
.   
CommandType   '
=  ( )
CommandType  * 5
.  5 6
StoredProcedure  6 E
;  E F
command!! 
.!! 

Parameters!! &
.!!& '
Add!!' *
(!!* +
	DbFactory!!+ 4
.!!4 5

GetDbParam!!5 ?
(!!? @
$str!!@ J
,!!J K
DbType!!L R
.!!R S
Int32!!S X
,!!X Y
Convert!!Z a
.!!a b
ToInt32!!b i
(!!i j
cityId!!j p
)!!p q
)!!q r
)!!r s
;!!s t
using"" 
("" 
IDataReader"" &
	objReader""' 0
=""1 2
MySqlDatabase""3 @
.""@ A
SelectQuery""A L
(""L M
command""M T
,""T U
ConnectionType""V d
.""d e
MasterDatabase""e s
)""s t
)""t u
{## 
if$$ 
($$ 
	objReader$$ %
!=$$& (
null$$) -
)$$- .
{%% 

lstDealers&& &
=&&' (
new&&) ,
List&&- 1
<&&1 2
GeoLocationEntity&&2 C
>&&C D
(&&D E
)&&E F
;&&F G
while'' !
(''" #
	objReader''# ,
.'', -
Read''- 1
(''1 2
)''2 3
)''3 4
{(( 

lstDealers))  *
.))* +
Add))+ .
()). /
new))/ 2
GeoLocationEntity))3 D
())D E
)))E F
{**  !
Id++$ &
=++' (
!++) *
Convert++* 1
.++1 2
IsDBNull++2 :
(++: ;
	objReader++; D
[++D E
$str++E O
]++O P
)++P Q
?++R S
Convert++T [
.++[ \
ToUInt32++\ d
(++d e
	objReader++e n
[++n o
$str++o y
]++y z
)++z {
:++| }
default	++~ Ö
(
++Ö Ü
UInt16
++Ü å
)
++å ç
,
++ç é
Latitude,,$ ,
=,,- .
!,,/ 0
Convert,,0 7
.,,7 8
IsDBNull,,8 @
(,,@ A
	objReader,,A J
[,,J K
$str,,K V
],,V W
),,W X
?,,Y Z
Convert,,[ b
.,,b c
ToDouble,,c k
(,,k l
	objReader,,l u
[,,u v
$str	,,v Å
]
,,Å Ç
)
,,Ç É
:
,,Ñ Ö
default
,,Ü ç
(
,,ç é
double
,,é î
)
,,î ï
,
,,ï ñ
	Longitude--$ -
=--. /
!--0 1
Convert--1 8
.--8 9
IsDBNull--9 A
(--A B
	objReader--B K
[--K L
$str--L W
]--W X
)--X Y
?--Z [
Convert--\ c
.--c d
ToDouble--d l
(--l m
	objReader--m v
[--v w
$str	--w Ç
]
--Ç É
)
--É Ñ
:
--Ö Ü
default
--á é
(
--é è
double
--è ï
)
--ï ñ
}..  !
)..! "
;.." #
}// 
}00 
}22 
}33 
}44 
catch55 
(55 
	Exception55 
ex55 
)55  
{66 
Logs77 
.77 
WriteErrorLog77 "
(77" #
$str77# =
+77> ?
ex77@ B
.77B C
Message77C J
)77J K
;77K L
}88 
return99 

lstDealers99 
;99 
}:: 	
publicDD 
boolDD 
UpdateDistancesDD #
(DD# $
UInt16DD$ *
idTypeDD+ 1
,DD1 2
UInt32DD3 9
idDD: <
,DD< =
stringDD> D
distanceMatrixDDE S
)DDS T
{EE 	
boolFF 
	isSuccessFF 
=FF 
falseFF "
;FF" #
ifGG 
(GG 

EnumerableGG 
.GG 
RangeGG  
(GG  !
$numGG! "
,GG" #
$numGG$ %
)GG% &
.GG& '
ContainsGG' /
(GG/ 0
idTypeGG0 6
)GG6 7
)GG7 8
{HH 
tryII 
{JJ 
usingKK 
(KK 
	DbCommandKK $
commandKK% ,
=KK- .
	DbFactoryKK/ 8
.KK8 9
GetDBCommandKK9 E
(KKE F
)KKF G
)KKG H
{LL 
commandMM 
.MM  
CommandTextMM  +
=MM, -
$strMM. J
;MMJ K
commandNN 
.NN  
CommandTypeNN  +
=NN, -
CommandTypeNN. 9
.NN9 :
StoredProcedureNN: I
;NNI J
commandOO 
.OO  

ParametersOO  *
.OO* +
AddOO+ .
(OO. /
	DbFactoryOO/ 8
.OO8 9

GetDbParamOO9 C
(OOC D
$strOOD P
,OOP Q
DbTypeOOR X
.OOX Y
Int32OOY ^
,OO^ _
ConvertOO` g
.OOg h
ToInt32OOh o
(OOo p
idTypeOOp v
)OOv w
)OOw x
)OOx y
;OOy z
commandPP 
.PP  

ParametersPP  *
.PP* +
AddPP+ .
(PP. /
	DbFactoryPP/ 8
.PP8 9

GetDbParamPP9 C
(PPC D
$strPPD L
,PPL M
DbTypePPN T
.PPT U
Int32PPU Z
,PPZ [
idPP\ ^
)PP^ _
)PP_ `
;PP` a
commandQQ 
.QQ  

ParametersQQ  *
.QQ* +
AddQQ+ .
(QQ. /
	DbFactoryQQ/ 8
.QQ8 9

GetDbParamQQ9 C
(QQC D
$strQQD X
,QQX Y
DbTypeQQZ `
.QQ` a
StringQQa g
,QQg h
distanceMatrixQQi w
)QQw x
)QQx y
;QQy z
MySqlDatabaseRR %
.RR% &
ExecuteNonQueryRR& 5
(RR5 6
commandRR6 =
,RR= >
ConnectionTypeRR? M
.RRM N
MasterDatabaseRRN \
)RR\ ]
;RR] ^
returnSS 
trueSS #
;SS# $
}TT 
}UU 
catchVV 
(VV 
	ExceptionVV  
exVV! #
)VV# $
{WW 
LogsXX 
.XX 
WriteErrorLogXX &
(XX& '
$strXX' 9
+XX: ;
exXX< >
.XX> ?
MessageXX? F
)XXF G
;XXG H
}YY 
}ZZ 
return[[ 
	isSuccess[[ 
;[[ 
}\\ 	
publicdd 
IEnumerabledd 
<dd 
GeoLocationEntitydd ,
>dd, -
GetDealersByAreadd. >
(dd> ?
UInt32dd? E
areaIdddF L
)ddL M
{ee 	
IListff 
<ff 
GeoLocationEntityff #
>ff# $

lstDealersff% /
=ff0 1
nullff2 6
;ff6 7
trygg 
{hh 
usingii 
(ii 
	DbCommandii  
commandii! (
=ii) *
	DbFactoryii+ 4
.ii4 5
GetDBCommandii5 A
(iiA B
)iiB C
)iiC D
{jj 
commandkk 
.kk 
CommandTextkk '
=kk( )
$strkk* >
;kk> ?
commandll 
.ll 
CommandTypell '
=ll( )
CommandTypell* 5
.ll5 6
StoredProcedurell6 E
;llE F
commandmm 
.mm 

Parametersmm &
.mm& '
Addmm' *
(mm* +
	DbFactorymm+ 4
.mm4 5

GetDbParammm5 ?
(mm? @
$strmm@ L
,mmL M
DbTypemmN T
.mmT U
Int32mmU Z
,mmZ [
Convertmm\ c
.mmc d
ToInt32mmd k
(mmk l
areaIdmml r
)mmr s
)mms t
)mmt u
;mmu v
usingoo 
(oo 
IDataReaderoo &
	objReaderoo' 0
=oo1 2
MySqlDatabaseoo3 @
.oo@ A
SelectQueryooA L
(ooL M
commandooM T
,ooT U
ConnectionTypeooV d
.ood e
MasterDatabaseooe s
)oos t
)oot u
{pp 
ifqq 
(qq 
	objReaderqq %
!=qq& (
nullqq) -
)qq- .
{rr 

lstDealersss &
=ss' (
newss) ,
Listss- 1
<ss1 2
GeoLocationEntityss2 C
>ssC D
(ssD E
)ssE F
;ssF G
whilett !
(tt" #
	objReadertt# ,
.tt, -
Readtt- 1
(tt1 2
)tt2 3
)tt3 4
{uu 

lstDealersvv  *
.vv* +
Addvv+ .
(vv. /
newvv/ 2
GeoLocationEntityvv3 D
(vvD E
)vvE F
{ww  !
Idxx$ &
=xx' (
!xx) *
Convertxx* 1
.xx1 2
IsDBNullxx2 :
(xx: ;
	objReaderxx; D
[xxD E
$strxxE O
]xxO P
)xxP Q
?xxR S
ConvertxxT [
.xx[ \
ToUInt32xx\ d
(xxd e
	objReaderxxe n
[xxn o
$strxxo y
]xxy z
)xxz {
:xx| }
default	xx~ Ö
(
xxÖ Ü
UInt32
xxÜ å
)
xxå ç
,
xxç é
Latitudeyy$ ,
=yy- .
!yy/ 0
Convertyy0 7
.yy7 8
IsDBNullyy8 @
(yy@ A
	objReaderyyA J
[yyJ K
$stryyK V
]yyV W
)yyW X
?yyY Z
Convertyy[ b
.yyb c
ToDoubleyyc k
(yyk l
	objReaderyyl u
[yyu v
$str	yyv Å
]
yyÅ Ç
)
yyÇ É
:
yyÑ Ö
default
yyÜ ç
(
yyç é
double
yyé î
)
yyî ï
,
yyï ñ
	Longitudezz$ -
=zz. /
!zz0 1
Convertzz1 8
.zz8 9
IsDBNullzz9 A
(zzA B
	objReaderzzB K
[zzK L
$strzzL W
]zzW X
)zzX Y
?zzZ [
Convertzz\ c
.zzc d
ToDoublezzd l
(zzl m
	objReaderzzm v
[zzv w
$str	zzw Ç
]
zzÇ É
)
zzÉ Ñ
:
zzÖ Ü
default
zzá é
(
zzé è
double
zzè ï
)
zzï ñ
}{{  !
){{! "
;{{" #
}|| 
}}} 
}~~ 
}
ÄÄ 
}
ÅÅ 
catch
ÇÇ 
(
ÇÇ 
	Exception
ÇÇ 
ex
ÇÇ 
)
ÇÇ  
{
ÉÉ 
Logs
ÑÑ 
.
ÑÑ 
WriteErrorLog
ÑÑ "
(
ÑÑ" #
$str
ÑÑ# 6
+
ÑÑ7 8
areaId
ÑÑ9 ?
+
ÑÑ@ A
ex
ÑÑB D
.
ÑÑD E
Message
ÑÑE L
)
ÑÑL M
;
ÑÑM N
}
ÖÖ 
return
ÜÜ 

lstDealers
ÜÜ 
;
ÜÜ 
}
áá 	
public
èè 
IEnumerable
èè 
<
èè 
GeoLocationEntity
èè ,
>
èè, -
GetAreasByDealer
èè. >
(
èè> ?
UInt32
èè? E
dealerID
èèF N
)
èèN O
{
êê 	
IList
ëë 
<
ëë 
GeoLocationEntity
ëë #
>
ëë# $
lstArea
ëë% ,
=
ëë- .
null
ëë/ 3
;
ëë3 4
try
íí 
{
ìì 
using
îî 
(
îî 
	DbCommand
îî  
command
îî! (
=
îî) *
	DbFactory
îî+ 4
.
îî4 5
GetDBCommand
îî5 A
(
îîA B
)
îîB C
)
îîC D
{
ïï 
command
ññ 
.
ññ 
CommandText
ññ '
=
ññ( )
$str
ññ* ?
;
ññ? @
command
óó 
.
óó 
CommandType
óó '
=
óó( )
CommandType
óó* 5
.
óó5 6
StoredProcedure
óó6 E
;
óóE F
command
òò 
.
òò 

Parameters
òò &
.
òò& '
Add
òò' *
(
òò* +
	DbFactory
òò+ 4
.
òò4 5

GetDbParam
òò5 ?
(
òò? @
$str
òò@ N
,
òòN O
DbType
òòP V
.
òòV W
Int32
òòW \
,
òò\ ]
Convert
òò^ e
.
òòe f
ToInt32
òòf m
(
òòm n
dealerID
òòn v
)
òòv w
)
òòw x
)
òòx y
;
òòy z
using
öö 
(
öö 
IDataReader
öö &
	objReader
öö' 0
=
öö1 2
MySqlDatabase
öö3 @
.
öö@ A
SelectQuery
ööA L
(
ööL M
command
ööM T
,
ööT U
ConnectionType
ööV d
.
ööd e
MasterDatabase
ööe s
)
öös t
)
ööt u
{
õõ 
if
úú 
(
úú 
	objReader
úú %
!=
úú& (
null
úú) -
)
úú- .
{
ùù 
lstArea
ûû #
=
ûû$ %
new
ûû& )
List
ûû* .
<
ûû. /
GeoLocationEntity
ûû/ @
>
ûû@ A
(
ûûA B
)
ûûB C
;
ûûC D
while
üü !
(
üü" #
	objReader
üü# ,
.
üü, -
Read
üü- 1
(
üü1 2
)
üü2 3
)
üü3 4
{
†† 
lstArea
°°  '
.
°°' (
Add
°°( +
(
°°+ ,
new
°°, /
GeoLocationEntity
°°0 A
(
°°A B
)
°°B C
{
¢¢  !
Id
££$ &
=
££' (
!
££) *
Convert
££* 1
.
££1 2
IsDBNull
££2 :
(
££: ;
	objReader
££; D
[
££D E
$str
££E I
]
££I J
)
££J K
?
££L M
Convert
££N U
.
££U V
ToUInt32
££V ^
(
££^ _
	objReader
££_ h
[
££h i
$str
££i m
]
££m n
)
££n o
:
££p q
default
££r y
(
££y z
UInt32££z Ä
)££Ä Å
,££Å Ç
Latitude
§§$ ,
=
§§- .
!
§§/ 0
Convert
§§0 7
.
§§7 8
IsDBNull
§§8 @
(
§§@ A
	objReader
§§A J
[
§§J K
$str
§§K V
]
§§V W
)
§§W X
?
§§Y Z
Convert
§§[ b
.
§§b c
ToDouble
§§c k
(
§§k l
	objReader
§§l u
[
§§u v
$str§§v Å
]§§Å Ç
)§§Ç É
:§§Ñ Ö
default§§Ü ç
(§§ç é
double§§é î
)§§î ï
,§§ï ñ
	Longitude
••$ -
=
••. /
!
••0 1
Convert
••1 8
.
••8 9
IsDBNull
••9 A
(
••A B
	objReader
••B K
[
••K L
$str
••L W
]
••W X
)
••X Y
?
••Z [
Convert
••\ c
.
••c d
ToDouble
••d l
(
••l m
	objReader
••m v
[
••v w
$str••w Ç
]••Ç É
)••É Ñ
:••Ö Ü
default••á é
(••é è
double••è ï
)••ï ñ
}
¶¶  !
)
¶¶! "
;
¶¶" #
}
ßß 
}
®® 
}
©© 
}
´´ 
}
¨¨ 
catch
≠≠ 
(
≠≠ 
	Exception
≠≠ 
ex
≠≠ 
)
≠≠  
{
ÆÆ 
Logs
ØØ 
.
ØØ 
WriteErrorLog
ØØ "
(
ØØ" #
$str
ØØ# 6
+
ØØ7 8
dealerID
ØØ9 A
+
ØØB C
ex
ØØD F
.
ØØF G
Message
ØØG N
)
ØØN O
;
ØØO P
}
∞∞ 
return
±± 
lstArea
±± 
;
±± 
}
≤≤ 	
public
ºº 
bool
ºº &
IsAreaGeoLocationChanged
ºº ,
(
ºº, -
UInt32
ºº- 3
areaId
ºº4 :
,
ºº: ;
double
ºº< B
	lattitude
ººC L
,
ººL M
double
ººN T
	longitude
ººU ^
)
ºº^ _
{
ΩΩ 	
bool
ææ 
	isChanged
ææ 
=
ææ 
false
ææ "
;
ææ" #
try
øø 
{
¿¿ 
using
¡¡ 
(
¡¡ 
	DbCommand
¡¡  
command
¡¡! (
=
¡¡) *
	DbFactory
¡¡+ 4
.
¡¡4 5
GetDBCommand
¡¡5 A
(
¡¡A B
)
¡¡B C
)
¡¡C D
{
¬¬ 
command
√√ 
.
√√ 
CommandText
√√ '
=
√√( )
$str
√√* ?
;
√√? @
command
ƒƒ 
.
ƒƒ 
CommandType
ƒƒ '
=
ƒƒ( )
CommandType
ƒƒ* 5
.
ƒƒ5 6
StoredProcedure
ƒƒ6 E
;
ƒƒE F
command
≈≈ 
.
≈≈ 

Parameters
≈≈ &
.
≈≈& '
Add
≈≈' *
(
≈≈* +
	DbFactory
≈≈+ 4
.
≈≈4 5

GetDbParam
≈≈5 ?
(
≈≈? @
$str
≈≈@ L
,
≈≈L M
DbType
≈≈N T
.
≈≈T U
Int32
≈≈U Z
,
≈≈Z [
Convert
≈≈\ c
.
≈≈c d
ToInt32
≈≈d k
(
≈≈k l
areaId
≈≈l r
)
≈≈r s
)
≈≈s t
)
≈≈t u
;
≈≈u v
command
∆∆ 
.
∆∆ 

Parameters
∆∆ &
.
∆∆& '
Add
∆∆' *
(
∆∆* +
	DbFactory
∆∆+ 4
.
∆∆4 5

GetDbParam
∆∆5 ?
(
∆∆? @
$str
∆∆@ O
,
∆∆O P
DbType
∆∆Q W
.
∆∆W X
Double
∆∆X ^
,
∆∆^ _
	lattitude
∆∆` i
)
∆∆i j
)
∆∆j k
;
∆∆k l
command
«« 
.
«« 

Parameters
«« &
.
««& '
Add
««' *
(
««* +
	DbFactory
««+ 4
.
««4 5

GetDbParam
««5 ?
(
««? @
$str
««@ O
,
««O P
DbType
««Q W
.
««W X
Double
««X ^
,
««^ _
	longitude
««` i
)
««i j
)
««j k
;
««k l
using
…… 
(
…… 
IDataReader
…… &
	objReader
……' 0
=
……1 2
MySqlDatabase
……3 @
.
……@ A
SelectQuery
……A L
(
……L M
command
……M T
,
……T U
ConnectionType
……V d
.
……d e
MasterDatabase
……e s
)
……s t
)
……t u
{
   
if
ÀÀ 
(
ÀÀ 
	objReader
ÀÀ %
!=
ÀÀ& (
null
ÀÀ) -
)
ÀÀ- .
{
ÃÃ 
if
ÕÕ 
(
ÕÕ  
	objReader
ÕÕ  )
.
ÕÕ) *
Read
ÕÕ* .
(
ÕÕ. /
)
ÕÕ/ 0
)
ÕÕ0 1
{
ŒŒ 
	isChanged
œœ  )
=
œœ* +
!
œœ, -
Convert
œœ- 4
.
œœ4 5
IsDBNull
œœ5 =
(
œœ= >
	objReader
œœ> G
[
œœG H
$str
œœH S
]
œœS T
)
œœT U
?
œœV W
Convert
œœX _
.
œœ_ `
	ToBoolean
œœ` i
(
œœi j
	objReader
œœj s
[
œœs t
$str
œœt 
]œœ Ä
)œœÄ Å
:œœÇ É
falseœœÑ â
;œœâ ä
}
–– 
}
—— 
}
““ 
}
‘‘ 
}
’’ 
catch
÷÷ 
(
÷÷ 
	Exception
÷÷ 
ex
÷÷ 
)
÷÷  
{
◊◊ 
Logs
ÿÿ 
.
ÿÿ 
WriteErrorLog
ÿÿ "
(
ÿÿ" #
string
ÿÿ# )
.
ÿÿ) *
Format
ÿÿ* 0
(
ÿÿ0 1
$str
ÿÿ1 ^
,
ÿÿ^ _
areaId
ÿÿ` f
,
ÿÿf g
	lattitude
ÿÿh q
,
ÿÿq r
	longitude
ÿÿs |
,
ÿÿ| }
exÿÿ~ Ä
.ÿÿÄ Å
MessageÿÿÅ à
)ÿÿà â
)ÿÿâ ä
;ÿÿä ã
}
ŸŸ 
return
⁄⁄ 
	isChanged
⁄⁄ 
;
⁄⁄ 
}
€€ 	
public
ÂÂ 
bool
ÂÂ (
IsDealerGeoLocationChanged
ÂÂ .
(
ÂÂ. /
UInt32
ÂÂ/ 5
dealerId
ÂÂ6 >
,
ÂÂ> ?
double
ÂÂ@ F
	lattitude
ÂÂG P
,
ÂÂP Q
double
ÂÂR X
	longitude
ÂÂY b
)
ÂÂb c
{
ÊÊ 	
bool
ÁÁ 
	isChanged
ÁÁ 
=
ÁÁ 
false
ÁÁ "
;
ÁÁ" #
try
ËË 
{
ÈÈ 
using
ÍÍ 
(
ÍÍ 
	DbCommand
ÍÍ  
command
ÍÍ! (
=
ÍÍ) *
	DbFactory
ÍÍ+ 4
.
ÍÍ4 5
GetDBCommand
ÍÍ5 A
(
ÍÍA B
)
ÍÍB C
)
ÍÍC D
{
ÎÎ 
command
ÏÏ 
.
ÏÏ 
CommandText
ÏÏ '
=
ÏÏ( )
$str
ÏÏ* A
;
ÏÏA B
command
ÌÌ 
.
ÌÌ 
CommandType
ÌÌ '
=
ÌÌ( )
CommandType
ÌÌ* 5
.
ÌÌ5 6
StoredProcedure
ÌÌ6 E
;
ÌÌE F
command
ÓÓ 
.
ÓÓ 

Parameters
ÓÓ &
.
ÓÓ& '
Add
ÓÓ' *
(
ÓÓ* +
	DbFactory
ÓÓ+ 4
.
ÓÓ4 5

GetDbParam
ÓÓ5 ?
(
ÓÓ? @
$str
ÓÓ@ N
,
ÓÓN O
DbType
ÓÓP V
.
ÓÓV W
Int32
ÓÓW \
,
ÓÓ\ ]
Convert
ÓÓ^ e
.
ÓÓe f
ToInt32
ÓÓf m
(
ÓÓm n
dealerId
ÓÓn v
)
ÓÓv w
)
ÓÓw x
)
ÓÓx y
;
ÓÓy z
command
ÔÔ 
.
ÔÔ 

Parameters
ÔÔ &
.
ÔÔ& '
Add
ÔÔ' *
(
ÔÔ* +
	DbFactory
ÔÔ+ 4
.
ÔÔ4 5

GetDbParam
ÔÔ5 ?
(
ÔÔ? @
$str
ÔÔ@ O
,
ÔÔO P
DbType
ÔÔQ W
.
ÔÔW X
Double
ÔÔX ^
,
ÔÔ^ _
	lattitude
ÔÔ` i
)
ÔÔi j
)
ÔÔj k
;
ÔÔk l
command
 
.
 

Parameters
 &
.
& '
Add
' *
(
* +
	DbFactory
+ 4
.
4 5

GetDbParam
5 ?
(
? @
$str
@ O
,
O P
DbType
Q W
.
W X
Double
X ^
,
^ _
	longitude
` i
)
i j
)
j k
;
k l
using
ÚÚ 
(
ÚÚ 
IDataReader
ÚÚ &
	objReader
ÚÚ' 0
=
ÚÚ1 2
MySqlDatabase
ÚÚ3 @
.
ÚÚ@ A
SelectQuery
ÚÚA L
(
ÚÚL M
command
ÚÚM T
,
ÚÚT U
ConnectionType
ÚÚV d
.
ÚÚd e
MasterDatabase
ÚÚe s
)
ÚÚs t
)
ÚÚt u
{
ÛÛ 
if
ÙÙ 
(
ÙÙ 
	objReader
ÙÙ %
!=
ÙÙ& (
null
ÙÙ) -
)
ÙÙ- .
{
ıı 
if
ˆˆ 
(
ˆˆ  
	objReader
ˆˆ  )
.
ˆˆ) *
Read
ˆˆ* .
(
ˆˆ. /
)
ˆˆ/ 0
)
ˆˆ0 1
{
˜˜ 
	isChanged
¯¯  )
=
¯¯* +
!
¯¯, -
Convert
¯¯- 4
.
¯¯4 5
IsDBNull
¯¯5 =
(
¯¯= >
	objReader
¯¯> G
[
¯¯G H
$str
¯¯H S
]
¯¯S T
)
¯¯T U
?
¯¯V W
Convert
¯¯X _
.
¯¯_ `
	ToBoolean
¯¯` i
(
¯¯i j
	objReader
¯¯j s
[
¯¯s t
$str
¯¯t 
]¯¯ Ä
)¯¯Ä Å
:¯¯Ç É
false¯¯Ñ â
;¯¯â ä
}
˘˘ 
}
˙˙ 
}
˚˚ 
}
˝˝ 
}
˛˛ 
catch
ˇˇ 
(
ˇˇ 
	Exception
ˇˇ 
ex
ˇˇ 
)
ˇˇ  
{
ÄÄ 
Logs
ÅÅ 
.
ÅÅ 
WriteErrorLog
ÅÅ "
(
ÅÅ" #
$str
ÅÅ# @
+
ÅÅA B
ex
ÅÅC E
.
ÅÅE F
Message
ÅÅF M
)
ÅÅM N
;
ÅÅN O
}
ÇÇ 
return
ÉÉ 
	isChanged
ÉÉ 
;
ÉÉ 
}
ÑÑ 	
public
åå 
bool
åå 
IsAreaExists
åå  
(
åå  !
UInt32
åå! '
areaId
åå( .
)
åå. /
{
çç 	
bool
éé 
isExists
éé 
=
éé 
false
éé !
;
éé! "
try
èè 
{
êê 
using
ëë 
(
ëë 
	DbCommand
ëë  
command
ëë! (
=
ëë) *
	DbFactory
ëë+ 4
.
ëë4 5
GetDBCommand
ëë5 A
(
ëëA B
)
ëëB C
)
ëëC D
{
íí 
command
ìì 
.
ìì 
CommandText
ìì '
=
ìì( )
$str
ìì* L
+
ììM N
areaId
ììO U
;
ììU V
command
îî 
.
îî 
CommandType
îî '
=
îî( )
CommandType
îî* 5
.
îî5 6
Text
îî6 :
;
îî: ;
using
ññ 
(
ññ 
IDataReader
ññ &
	objReader
ññ' 0
=
ññ1 2
MySqlDatabase
ññ3 @
.
ññ@ A
SelectQuery
ññA L
(
ññL M
command
ññM T
,
ññT U
ConnectionType
ññV d
.
ññd e
MasterDatabase
ññe s
)
ññs t
)
ññt u
{
óó 
if
òò 
(
òò 
	objReader
òò %
!=
òò& (
null
òò) -
)
òò- .
{
ôô 
if
öö 
(
öö  
	objReader
öö  )
.
öö) *
Read
öö* .
(
öö. /
)
öö/ 0
)
öö0 1
{
õõ 
isExists
úú  (
=
úú) *
!
úú+ ,
Convert
úú, 3
.
úú3 4
IsDBNull
úú4 <
(
úú< =
	objReader
úú= F
[
úúF G
$str
úúG K
]
úúK L
)
úúL M
?
úúN O
Convert
úúP W
.
úúW X
ToInt32
úúX _
(
úú_ `
	objReader
úú` i
[
úúi j
$str
úúj n
]
úún o
)
úúo p
>
úúq r
$num
úús t
:
úúu v
false
úúw |
;
úú| }
}
ùù 
}
ûû 
}
üü 
}
°° 
}
¢¢ 
catch
££ 
(
££ 
	Exception
££ 
ex
££ 
)
££  
{
§§ 
Logs
•• 
.
•• 
WriteErrorLog
•• "
(
••" #
$str
••# 2
+
••3 4
ex
••5 7
.
••7 8
Message
••8 ?
)
••? @
;
••@ A
}
¶¶ 
return
ßß 
isExists
ßß 
;
ßß 
}
®® 	
}
©© 
}™™ ﬂ
FD:\work\bikewaleweb\Bikewale.DealerAreaCommuteDistance\DealerEntity.cs
	namespace 	
Bikewale
 
. %
DealerAreaCommuteDistance ,
{ 
internal 
class 
DealerEntity 
{ 
public 
UInt16 
Id 
{ 
get 
; 
set  #
;# $
}% &
public 
UInt16 
LeadServingRadius '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
}		 
}

 Ål
QD:\work\bikewaleweb\Bikewale.DealerAreaCommuteDistance\GoogleDistanceAPIHelper.cs
	namespace 	
Bikewale
 
. %
DealerAreaCommuteDistance ,
{ 
internal 
class #
GoogleDistanceAPIHelper *
{ 
private 
string 
	GoogleUrl  
=! "
$str	# ú
;
ú ù
internal 
string 
FormatCSVLatLon '
(' (
string( .
latitude/ 7
,7 8
string9 ?
	longitude@ I
)I J
{ 	
return 
string 
. 
Format  
(  !
$str! *
,* +
latitude, 4
,4 5
	longitude6 ?
)? @
;@ A
} 	
internal&& 
string&& 
FormatCSVLatLon&& '
(&&' (
double&&( .
latitude&&/ 7
,&&7 8
double&&9 ?
	longitude&&@ I
)&&I J
{'' 	
return(( 
string(( 
.(( 
Format((  
(((  !
$str((! *
,((* +
latitude((, 4
,((4 5
	longitude((6 ?
)((? @
;((@ A
})) 	
internal00 
string00 
FormatCSVLatLon00 '
(00' (
GeoLocationEntity00( 9
location00: B
)00B C
{11 	
return22 
string22 
.22 
Format22  
(22  !
$str22! *
,22* +
location22, 4
.224 5
Latitude225 =
,22= >
location22? G
.22G H
	Longitude22H Q
)22Q R
;22R S
}33 	
internal99 
string99 
FormatCSVLatLonArr99 *
(99* +
IEnumerable99+ 6
<996 7
GeoLocationEntity997 H
>99H I
	locations99J S
)99S T
{:: 	
StringBuilder;; 
retVal;;  
=;;! "
new;;# &
StringBuilder;;' 4
(;;4 5
);;5 6
;;;6 7
int<< 
arrLen<< 
=<< 
	locations<< "
!=<<# %
null<<& *
?<<+ ,
	locations<<- 6
.<<6 7
Count<<7 <
(<<< =
)<<= >
:<<? @
$num<<A B
;<<B C
for== 
(== 
int== 
index== 
=== 
$num== 
;== 
index==  %
<==& '
arrLen==( .
;==. /
index==0 5
++==5 7
)==7 8
{>> 
retVal?? 
.?? 
AppendFormat?? #
(??# $
$str??$ *
,??* +
FormatCSVLatLon??, ;
(??; <
	locations??< E
.??E F
	ElementAt??F O
(??O P
index??P U
)??U V
)??V W
)??W X
;??X Y
}@@ 
ifAA 
(AA 
arrLenAA 
>AA 
$numAA 
)AA 
retValBB 
.BB 
LengthBB 
--BB 
;BB  
returnCC 
retValCC 
.CC 
ToStringCC "
(CC" #
)CC# $
;CC$ %
}DD 	
internalLL 
stringLL 
FormatRequestUrlLL (
(LL( )
GeoLocationEntityLL) :
sourceLL; A
,LLA B
IEnumerableLLC N
<LLN O
GeoLocationEntityLLO `
>LL` a
destinationsLLb n
)LLn o
{MM 	
returnNN 
StringNN 
.NN 
FormatNN  
(NN  !
	GoogleUrlNN! *
,NN* +
FormatCSVLatLonNN, ;
(NN; <
sourceNN< B
)NNB C
,NNC D
FormatCSVLatLonArrNNE W
(NNW X
destinationsNNX d
)NNd e
,NNe f 
ConfigurationManagerNNg {
.NN{ |
AppSettings	NN| á
[
NNá à
$str
NNà §
]
NN§ •
)
NN• ¶
;
NN¶ ß
}OO 	
publicZZ 
IEnumerableZZ 
<ZZ (
GeoLocationDestinationEntityZZ 7
>ZZ7 8&
GetDistanceUsingArrayIndexZZ9 S
(ZZS T
GeoLocationEntityZZT e
sourceZZf l
,ZZl m
IEnumerableZZn y
<ZZy z
GeoLocationEntity	ZZz ã
>
ZZã å
destinations
ZZç ô
,
ZZô ö
bool
ZZõ ü
showShortedFirst
ZZ† ∞
=
ZZ± ≤
false
ZZ≥ ∏
)
ZZ∏ π
{[[ 	
JObject\\ 
response\\ 
=\\ 
null\\ #
;\\# $
IList]] 
<]] (
GeoLocationDestinationEntity]] .
>]]. /)
lstLinqGeoLocationDestination]]0 M
=]]N O
null]]P T
;]]T U
string^^ 
url^^ 
=^^ 
String^^ 
.^^  
Empty^^  %
;^^% &
try__ 
{`` 
urlaa 
=aa 
FormatRequestUrlaa &
(aa& '
sourceaa' -
,aa- .
destinationsaa/ ;
)aa; <
;aa< =
responsebb 
=bb 
CallAPIbb "
(bb" #
urlbb# &
)bb& '
;bb' (
ifcc 
(cc 
responsecc 
!=cc 
nullcc  $
)cc$ %
{dd 
intee 
resultCountee #
=ee$ %
$numee& '
;ee' (
varff 
respff 
=ff 
JObjectff &
.ff& '

FromObjectff' 1
(ff1 2
responseff2 :
)ff: ;
;ff; <
ifhh 
(hh 
resphh 
!=hh 
nullhh  $
&&hh% '
Converthh( /
.hh/ 0
ToStringhh0 8
(hh8 9
resphh9 =
[hh= >
$strhh> F
]hhF G
)hhG H
==hhI K
$strhhL P
)hhP Q
{ii 
resultCountjj #
=jj$ %
respjj& *
[jj* +
$strjj+ 1
]jj1 2
[jj2 3
$numjj3 4
]jj4 5
[jj5 6
$strjj6 @
]jj@ A
.jjA B
CountjjB G
(jjG H
)jjH I
;jjI J)
lstLinqGeoLocationDestinationkk 5
=kk6 7
newll 
Listll  $
<ll$ %(
GeoLocationDestinationEntityll% A
>llA B
(llB C
)llC D
;llD E
formm 
(mm 
intmm  
indexmm! &
=mm' (
$nummm) *
;mm* +
indexmm, 1
<mm2 3
resultCountmm4 ?
;mm? @
indexmmA F
++mmF H
)mmH I
{nn )
lstLinqGeoLocationDestinationoo 9
.oo9 :
Addoo: =
(oo= >
newpp "(
GeoLocationDestinationEntitypp# ?
(pp? @
)pp@ A
{qq  
StrDistancerr# .
=rr/ 0
Convertrr1 8
.rr8 9
ToStringrr9 A
(rrA B
resprrB F
[rrF G
$strrrG M
]rrM N
[rrN O
$numrrO P
]rrP Q
[rrQ R
$strrrR \
]rr\ ]
[rr] ^
indexrr^ c
]rrc d
[rrd e
$strrre o
]rro p
[rrp q
$strrrq x
]rrx y
)rry z
,rrz {
Sourcess# )
=ss* +
sourcess, 2
,ss2 3
Idtt# %
=tt& '
destinationstt( 4
.tt4 5
	ElementAttt5 >
(tt> ?
indextt? D
)ttD E
.ttE F
IdttF H
,ttH I
Latitudeuu# +
=uu, -
destinationsuu. :
.uu: ;
	ElementAtuu; D
(uuD E
indexuuE J
)uuJ K
.uuK L
LatitudeuuL T
,uuT U
	Longitudevv# ,
=vv- .
destinationsvv/ ;
.vv; <
	ElementAtvv< E
(vvE F
indexvvF K
)vvK L
.vvL M
	LongitudevvM V
}ww  
)ww  !
;ww! "
}xx 
}yy 
elsezz 
{{{ 
Logs|| 
.|| 
WriteInfoLog|| )
(||) *
$str||* t
+||u v
resp||w {
)||{ |
;||| }
}}} 
} 
}
ÄÄ 
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
ex
ÅÅ 
)
ÅÅ  
{
ÇÇ 
Logs
ÉÉ 
.
ÉÉ 
WriteErrorLog
ÉÉ "
(
ÉÉ" #
$str
ÉÉ# B
+
ÉÉC D
ex
ÉÉE G
.
ÉÉG H
Message
ÉÉH O
)
ÉÉO P
;
ÉÉP Q
}
ÑÑ 
if
ÖÖ 
(
ÖÖ 
showShortedFirst
ÖÖ  
)
ÖÖ  !
{
ÜÜ 
return
áá +
lstLinqGeoLocationDestination
áá 4
.
áá4 5
OrderBy
áá5 <
(
áá< =
m
áá= >
=>
áá? A
m
ááB C
.
ááC D
DistanceInKm
ááD P
)
ááP Q
;
ááQ R
}
àà 
else
ââ 
{
ää 
return
ãã +
lstLinqGeoLocationDestination
ãã 4
;
ãã4 5
}
åå 
}
çç 	
internal
ññ 
JObject
ññ 
CallAPI
ññ  
(
ññ  !
string
ññ! '
apiUrl
ññ( .
)
ññ. /
{
óó 	

HttpClient
òò 

httpClient
òò !
=
òò" #
null
òò$ (
;
òò( )
JObject
ôô 
response
ôô 
=
ôô 
null
ôô #
;
ôô# $
try
öö 
{
õõ 

httpClient
úú 
=
úú 
new
úú  

HttpClient
úú! +
(
úú+ ,
)
úú, -
;
úú- .
if
ùù 
(
ùù 

httpClient
ùù 
!=
ùù !
null
ùù" &
)
ùù& '
{
ûû 
using
†† 
(
†† !
HttpResponseMessage
†† .
	_response
††/ 8
=
††9 :

httpClient
††; E
.
††E F
GetAsync
††F N
(
††N O
apiUrl
††O U
)
††U V
.
††V W
Result
††W ]
)
††] ^
{
°° 
if
££ 
(
££ 
	_response
££ %
.
££% &!
IsSuccessStatusCode
££& 9
)
££9 :
{
§§ 
if
•• 
(
••  
	_response
••  )
.
••) *

StatusCode
••* 4
==
••5 7
System
••8 >
.
••> ?
Net
••? B
.
••B C
HttpStatusCode
••C Q
.
••Q R
OK
••R T
)
••T U
{
¶¶ 
response
ßß  (
=
ßß) *
	_response
ßß+ 4
.
ßß4 5
Content
ßß5 <
.
ßß< =
ReadAsAsync
ßß= H
<
ßßH I
JObject
ßßI P
>
ßßP Q
(
ßßQ R
)
ßßR S
.
ßßS T
Result
ßßT Z
;
ßßZ [
	_response
®®  )
.
®®) *
Content
®®* 1
.
®®1 2
Dispose
®®2 9
(
®®9 :
)
®®: ;
;
®®; <
	_response
©©  )
.
©©) *
Content
©©* 1
=
©©2 3
null
©©4 8
;
©©8 9
}
™™ 
}
´´ 
}
¨¨ 
}
≠≠ 
}
ÆÆ 
catch
ØØ 
(
ØØ 
	Exception
ØØ 
ex
ØØ 
)
ØØ  
{
∞∞ 
Logs
±± 
.
±± 
WriteErrorLog
±± "
(
±±" #
$str
±±# /
+
±±0 1
ex
±±2 4
.
±±4 5
Message
±±5 <
)
±±< =
;
±±= >
}
≤≤ 
return
≥≥ 
response
≥≥ 
;
≥≥ 
}
¥¥ 	
private
ºº 
static
ºº 
IEnumerable
ºº "
<
ºº" #
JToken
ºº# )
>
ºº) *
AllChildren
ºº+ 6
(
ºº6 7
JToken
ºº7 =
json
ºº> B
)
ººB C
{
ΩΩ 	
foreach
ææ 
(
ææ 
var
ææ 
c
ææ 
in
ææ 
json
ææ "
.
ææ" #
Children
ææ# +
(
ææ+ ,
)
ææ, -
)
ææ- .
{
øø 
yield
¿¿ 
return
¿¿ 
c
¿¿ 
;
¿¿ 
foreach
¡¡ 
(
¡¡ 
var
¡¡ 
cc
¡¡ 
in
¡¡  "
AllChildren
¡¡# .
(
¡¡. /
c
¡¡/ 0
)
¡¡0 1
)
¡¡1 2
{
¬¬ 
yield
√√ 
return
√√  
cc
√√! #
;
√√# $
}
ƒƒ 
}
≈≈ 
}
∆∆ 	
internal
œœ 
string
œœ 
FormatApiResp
œœ %
(
œœ% &
IEnumerable
œœ& 1
<
œœ1 2*
GeoLocationDestinationEntity
œœ2 N
>
œœN O
apiResp
œœP W
)
œœW X
{
–– 	
StringBuilder
—— 
resp
—— 
=
——  
new
——! $
StringBuilder
——% 2
(
——2 3
)
——3 4
;
——4 5
foreach
““ 
(
““ *
GeoLocationDestinationEntity
““ 1
location
““2 :
in
““; =
apiResp
““> E
)
““E F
{
”” 
resp
‘‘ 
.
‘‘ 
Append
‘‘ 
(
‘‘ 
location
‘‘ $
.
‘‘$ %
AreaDistance
‘‘% 1
)
‘‘1 2
;
‘‘2 3
resp
’’ 
.
’’ 
Append
’’ 
(
’’ 
$str
’’ 
)
’’  
;
’’  !
}
÷÷ 
resp
◊◊ 
.
◊◊ 
Length
◊◊ 
--
◊◊ 
;
◊◊ 
return
ÿÿ 
resp
ÿÿ 
.
ÿÿ 
ToString
ÿÿ  
(
ÿÿ  !
)
ÿÿ! "
;
ÿÿ" #
}
ŸŸ 	
}
⁄⁄ 
}€€ Ô
AD:\work\bikewaleweb\Bikewale.DealerAreaCommuteDistance\Program.cs
	namespace 	
Bikewale
 
. %
DealerAreaCommuteDistance ,
{ 
class 	
Program
 
{ 
static		 
void		 
Main		 
(		 
string		 
[		  
]		  !
args		" &
)		& '
{

 	
log4net 
. 
Config 
. 
XmlConfigurator *
.* +
	Configure+ 4
(4 5
)5 6
;6 7
try 
{ 
Logs 
. 
WriteInfoLog !
(! "
$str" 1
+2 3
DateTime4 <
.< =
Now= @
)@ A
;A B#
CommuteDistanceConsumer '
consumer( 0
=1 2
new3 6#
CommuteDistanceConsumer7 N
(N O
)O P
;P Q
Random 
Random 
= 
new  #
Random$ *
(* +
)+ ,
;, -
string 
hostName 
=  !
CreateConnection" 2
.2 3
nodes3 8
[8 9
Random9 ?
.? @
Next@ D
(D E
CreateConnectionE U
.U V
nodesV [
.[ \
Count\ a
)a b
]b c
;c d
consumer 
. 
RabbitMQExecution *
(* +
String+ 1
.1 2
Format2 8
(8 9
$str9 M
,M N 
ConfigurationManagerO c
.c d
AppSettingsd o
[o p
$strp {
]{ |
.| }
ToUpper	} Ñ
(
Ñ Ö
)
Ö Ü
)
Ü á
,
á à
hostName
â ë
)
ë í
;
í ì
} 
catch 
( 
	Exception 
ex 
)  
{ 
Logs 
. 
WriteErrorLog "
(" #
$str# /
+0 1
ex2 4
.4 5
Message5 <
)< =
;= >
} 
finally 
{ 
Logs 
. 
WriteInfoLog !
(! "
$str" -
+. /
DateTime0 8
.8 9
Now9 <
)< =
;= >
} 
} 	
} 
} ¸
QD:\work\bikewaleweb\Bikewale.DealerAreaCommuteDistance\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str =
)= >
]> ?
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str ?
)? @
]@ A
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *