@model BikewaleOpr.Models.UserReviews.ManageUserReviewsPageVM
@using BikewaleOpr.Entity.UserReviews;
@{
    ViewBag.Title = "Manage User Reviews";
    ViewBag.PageTitle = "Manage User Reviews";
}

<link href="~/css/userreviews.css" rel="stylesheet" />

<div class="row" style="margin-top:5px;" data-userid="@Model.currentUserId" id="UserReviews" data-makeid="@Model.selectedFilters.MakeId" data-reviewstatus="@((ushort)Model.selectedFilters.ReviewStatus)" data-date="@(Model.selectedFilters.ReviewDate != default(DateTime) ? Model.selectedFilters.ReviewDate.ToString() : "")" data-modelid="@Model.selectedFilters.ModelId">
    <div class="col m10">
        @if (Model != null && Model.Reviews != null && Model.Reviews.Count() > 0)
        {
            <table id="tblReviews" class="bordered highlight z-depth-3 centered responsive-table">
                <tr>
                    <th>Review Id</th>
                    <th>Bike Name</th>
                    <th>Written By</th>
                    <th>Customer Email</th>
                    <th>Entry Date</th>
                    <th>View Details</th>
                </tr>
                @foreach (var m in Model.Reviews)
                {
                    <tr>
                        <td>@m.Id</td>
                        <td>@m.MakeName @m.ModelName</td>
                        <td>@m.WrittenBy</td>
                        <td>@m.CustomerEmail</td>
                        <td>@m.EntryDate</td>
                        <td><a id="btnViewDetails_@m.Id" href="#!" data-target="reviewdetails" data-bind="click : function(){ getUserReviewDetails(@m.Id); }" class="btn waves-effect waves-light cyan" type="button" name="ViewDetails" data-review-id="@m.Id">View Details</a></td>
                    </tr>
                }
            </table>
        }
        else
        {
            <div class="row">
                <div class="col s12 m4">
                    <div class="card-panel orange lighten-2">
                        <i class="material-icons">info_outline</i><span class="vertical-align-bottom margin-left5">No user reviews available...</span>
                    </div>
                </div>
            </div>
        }
    </div>

    @using (Html.BeginForm("Index", "UserReviews", FormMethod.Post))
    {
        <div id="addMakeContainer" class="col s2 m2">
            <ul class="collapsible" data-collapsible="accordion">
                <li>
                    <div class="collapsible-header"><strong>Filter Reviews</strong></div>
                    <div class="collapsible-body">
                        <div class="container">
                            <div class="input-field row s12">
                                <select name="MakeId" data-bind="event :  { change : function(d,e){ changeMake(d,e); } }">
                                    <option value="0" selected>Select Make</option>
                                    @foreach (var m in Model.Makes)
                                    {
                                        <option value="@m.MakeId">@m.MakeName</option>
                                    }
                                </select>
                            </div>
                            <div class="input-field row s12">
                                <select name="ModelId" data-bind="options : bikeModels,value : selectedModel,optionsValue : 'modelId',optionsText : 'modelName',optionsCaption: 'Select Model'"></select>
                            </div>
                            <div class="input-field row s12">
                                <input type="radio" id="chkPending" name="rdoReviewStatus" value="@((ushort)ReviewsStatus.Pending)" class="with-gap" data-bind="event : { change : function(d,e) { changeStatus(d,e); } }" @(Model.selectedFilters.ReviewStatus.Equals(ReviewsStatus.Pending) ? "checked" : "") />
                                <label for="chkPending">Pending</label>
                            </div>
                            <div class="input-field row s12">
                                <input type="radio" id="chkApproved" name="rdoReviewStatus" value="@((ushort)ReviewsStatus.Approved)" data-bind="event : { change : function(d,e) { changeStatus(d,e); } }" class="with-gap" @(Model.selectedFilters.ReviewStatus.Equals(ReviewsStatus.Approved) ? "checked" : "") />
                                <label for="chkApproved">Approved</label>
                            </div>
                            <div class="input-field row s12">
                                <input type="radio" id="chkDiscarded" name="rdoReviewStatus" value="@((ushort)ReviewsStatus.Discarded)" data-bind="event : { change : function(d,e) { changeStatus(d,e); } }" class="with-gap" @(Model.selectedFilters.ReviewStatus.Equals(ReviewsStatus.Discarded) ? "checked" : "") />
                                <label for="chkDiscarded">Discarded</label>
                            </div>
                            <div class="input-field row s12">
                                <i class="material-icons prefix margin-top15">date_range</i>
                                <input type="date" id="reviewDateEle"  class="datepicker margin-left5" value="" />
                                <input type="hidden" id="reviewDate" name="ReviewDate" value=""/>
                                <label for="reviewDateEle">Review Date</label>
                            </div>
                            <div class="input-field row s12">
                                <button id="btnAddMake" class="btn waves-effect waves-light" type="submit" name="action">
                                    Show Reviews
                                </button>
                                <input type="hidden" name="ReviewStatus" value="1" />
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    }
    <!-- ko if : reviewSummary  -->
    <div id="reviewdetails" class="modal modal-fixed-footer" data-bind="with : reviewSummary">
        <div class="modal-content">

            <h4 data-bind="text : make.makeName + ' ' + model.modelName + ' ' + 'User Review' "></h4>
            <div id="review-summary-card" class="container section-bottom-margin font14">
                <div class="grid-12">
                    <div class="content-box-shadow content-inner-block-20">
                        <div class="grid-8 alpha padding-right20 border-solid-right">
                            <div id="bike-rating-box">
                                <div class="circle-placeholder">
                                    <span class="bwsprite feedback-4"></span>
                                </div>
                                <div class="rating-placeholder">
                                    <h3 class="font20 font-bold" data-bind="text : overallRating.heading"></h3>
                                    <p class="margin-top5" data-bind="text : overallRating.description"></p>

                                    <ul class="item-rating-list answer-star-list no-float" data-bind="foreach: new Array(5)">
                                        <!-- ko if : $index() < $parent.overallRating.value -->
                                        <li class="bwsprite star-one"></li>
                                        <!-- /ko -->
                                        <!-- ko if : $index() >= $parent.overallRating.value -->
                                        <li class="bwsprite star-zero"></li>
                                        <!-- /ko -->
                                    </ul>
                                    <div class="clear"></div>

                                </div>
                            </div>


                            <div class="input-field col s12">
                                <input id="reviewTitle" type="text" class="validate" data-bind="textInput : $root.reviewTitle">
                                <label for="reviewTitle" data-bind="css : title ? 'active' : '' ">Title</label>
                            </div>
                            <div class="input-field col s12">
                                <textarea id="reviewDescription" class="materialize-textarea" data-bind="textInput : $root.reviewDescription"></textarea>
                                <label for="reviewDescription" data-bind="css : description ? 'active' : '' ">Description</label>
                            </div>

                        </div>

                        <div class="grid-4 padding-left20 omega">
                            <h3 class="font15 text-black margin-bottom20">You also rated</h3>
                            <!-- ko if : questions -->
                            <ul class="user-rated-list padding-bottom5 opacity-active" data-bind="foreach : questions">
                                <li class="list-item">
                                    <p class="category-label leftfloat" data-bind="text : heading"></p>

                                    <ul class="category-rating item-rating-list rating-size-sm rightfloat" data-bind="foreach: rating">
                                        <!-- ko if : $parent.qtype != 1 -->
                                            <!-- ko  foreach : new Array(5) -->
                                                <!-- ko if : $index() < $parent.ratingValue -->
                                                    <li class="bwsprite star-one"></li>
                                                <!-- /ko -->
                                                <!-- ko if : $index() >= $parent.ratingValue -->
                                                    <li class="bwsprite star-zero"></li>
                                                <!-- /ko -->
                                            <!-- /ko -->
                                        <!-- /ko -->
                                        <!-- ko if : $parent.qtype == 1 -->
                                        <li data-bind="text : ratingText && ratingText!='' ? ratingText : 'N/A' "></li>
                                        <!-- /ko -->
                                    </ul>
                                    <div class="clear"></div>
                                </li>
                               
                            </ul>
                            <!-- /ko -->
                            <div class="margin-bottom20 border-solid-bottom"></div>
                            <h3 class="font15 text-black margin-bottom10">Tips for prospective buyers</h3>
                            <div class="input-field col s12">
                                <textarea id="reviewTips" class="materialize-textarea" data-bind="textInput : $root.reviewTips"></textarea>
                                <label for="reviewTips" data-bind="css : tips ? 'active' : '' ">Tips</label>
                            </div>

                        </div>

                        <div class="clear"></div>

                    </div>
                </div>
                <div class="clear"></div>
            </div>
        </div>
        <div class="modal-footer row">
            <span >
                <input type="checkbox" class="filled-in" id="shortList" data-bind="checked: $root.shortListCheckBox" />
                <label class="margin-top10" for="shortList">ShortList review</label>
            </span>
            <a href="#!" class="modal-action btn waves-effect waves-light red lighten-2  modal-close " data-target="rejectionReason" data-bind="click : function(){ $('#reviewdetails').modal('close'); }">Reject</a>
            <a href="#!" class="modal-action btn waves-effect waves-light modal-close " data-bind="click : $root.approveReview " style="margin-right : 10px">Approve</a>

        </div>
    </div>
    <!-- /ko -->

    <div id="rejectionReason" class="modal">
        <div class="modal-content">
            <h4>Please provide disapproval reason</h4>
            <div class="list-type-radio">
                <p>
                    <input type="radio" name="disapprovalReason" id="reason1" value="1" />
                    <label for="reason1">Abusive/Foul Language</label>
                </p>
                <p>
                    <input type="radio" name="disapprovalReason" id="reason2" value="2" />
                    <label for="reason2">Language other than English</label>
                </p>
                <p>
                    <input type="radio" name="disapprovalReason" id="reason3" value="3" />
                    <label for="reason3">Irrelevant Content</label>
                </p>
                <p>
                    <input type="radio" name="disapprovalReason" id="reason4" value="4" />
                    <label for="reason4">Hatred/threat for a dealership</label>
                </p>
                <p>
                    <input type="radio" name="disapprovalReason" id="reason5" value="5" />
                    <label for="reason5">Fake Reviews</label>
                </p>
            </div>

        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-action btn waves-effect waves-light red lighten-2 " data-bind="click : $root.rejectReview">Reject</a>
        </div>

    </div>
</div>

<script src="/src/userreviews/manageuserreviews.js"></script>